(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{15:e=>{e.exports={mainTablet:"tablet_mainTablet__lcaTm",wrapper:"tablet_wrapper__l5DFW",tabletControls:"tablet_tabletControls__gIlci",listWrapper:"tablet_listWrapper__gzzrU",planetBar:"tablet_planetBar__Hq_f5",name:"tablet_name__Lk4E2",position:"tablet_position__L_vmV",id:"tablet_id__nHht7"}},700:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>ty});var n=a(5155),s=a(2115),r=a(2525),l=a.n(r),i=a(1990),o=a(3464);let c="http://45.141.76.253/planets",d="http://45.141.76.253/events",u=(0,i.zD)("planets/fetchPlanets",async()=>{let e=(await o.A.get(c)).data;return console.log("планеты запрошены:",e),e}),p=(0,i.zD)("planets/createPlanet",async e=>{let t=await o.A.post(c,e);return console.log("планета создана:",t.data),t.data}),m=(0,i.zD)("events/createEvent",async e=>{let t=await o.A.post(d,e);return console.log("ивент создан:",t.data),t.data}),g=(0,i.zD)("events/deleteEvent",async e=>{let t=await o.A.delete(d+"/"+e);return console.log("ивент удален:",t.data),t.data}),x=(0,i.zD)("planets/updatePlanet",async e=>{let{updatedPlanet:t,id:a}=e;console.log("получены данные планеты:",t);let n=await o.A.put("".concat(c,"/").concat(a),t);return console.log("планета обновлена:",n.data),n.data}),h=(0,i.zD)("planets/deletePlanet",async e=>(await o.A.delete("".concat(c,"/").concat(e)),console.log("планета удалена:",e),e)),{actions:f,reducer:v}=(0,i.Z0)({name:"planets",initialState:{planets:null,loading:!0,error:null},reducers:{getPlanet:(e,t)=>t.payload},extraReducers:e=>{e.addCase(u.pending,e=>{e.loading=!0,e.error=null}).addCase(u.fulfilled,(e,t)=>{e.loading=!1,e.planets=t.payload}).addCase(u.rejected,(e,t)=>{e.loading=!1,e.error=t.error.message||null}).addCase(p.pending,e=>{e.loading=!0,e.error=null}).addCase(p.fulfilled,(e,t)=>{e.loading=!1,e.planets?e.planets.push(t.payload):e.planets=[t.payload]}).addCase(p.rejected,(e,t)=>{e.loading=!1,e.error=t.error.message||"Ошибка при создании планеты"}).addCase(x.pending,e=>{e.loading=!0,e.error=null}).addCase(x.fulfilled,(e,t)=>{if(e.loading=!1,e.planets){let a=e.planets.findIndex(e=>e._id===t.payload._id);-1!==a&&(e.planets[a]=t.payload)}}).addCase(x.rejected,(e,t)=>{e.loading=!1,e.error=t.error.message||"Ошибка при обновлении планеты"}).addCase(h.pending,e=>{e.loading=!0,e.error=null}).addCase(h.fulfilled,(e,t)=>{e.loading=!1,e.planets&&(e.planets=e.planets.filter(e=>e._id!==t.payload))}).addCase(h.rejected,(e,t)=>{e.loading=!1,e.error=t.error.message||"Ошибка при удалении планеты"})}}),{getPlanet:j}=f;var b=a(4540);let _=b.wA.withTypes(),w=b.d4.withTypes();b.Pj.withTypes();let y="http://45.141.76.253/legions",N=(0,i.zD)("legions/fetchLegions",async()=>{let e=(await o.A.get(y)).data;return console.log("легионы запрошены:",e),e}),C=(0,i.zD)("legions/createLegion",async e=>{let t=await o.A.post(y,e);return console.log("легион создан:",t.data),t.data}),k=(0,i.zD)("legions/updateLegion",async e=>{let{updatedLegion:t,id:a}=e;console.log("получены данные лкгиона:",t);let n=await o.A.put("".concat(y,"/").concat(a),t);return console.log("планета обновлена:",n.data),n.data}),S=(0,i.zD)("legions/deleteLegion",async e=>(await o.A.delete("".concat(y,"/").concat(e)),console.log("легион удален:",e),e)),{actions:L,reducer:R}=(0,i.Z0)({name:"legions",initialState:{legions:null,loading:!1,error:null},reducers:{getLegion:(e,t)=>t.payload,clearError(e){e.error=null}},extraReducers:e=>{e.addCase(N.pending,e=>{e.loading=!0,e.error=null}).addCase(N.fulfilled,(e,t)=>{e.loading=!1,e.legions=t.payload}).addCase(N.rejected,(e,t)=>{e.loading=!1,e.error=t.error.message||"Ошибка при получении легионов"}).addCase(C.pending,e=>{e.loading=!0,e.error=null}).addCase(C.fulfilled,(e,t)=>{e.loading=!1,e.legions?e.legions.push(t.payload):e.legions=[t.payload]}).addCase(C.rejected,(e,t)=>{e.loading=!1,e.error=t.error.message||"Ошибка при создании легиона"}).addCase(k.pending,e=>{e.loading=!0,e.error=null}).addCase(k.fulfilled,(e,t)=>{if(e.loading=!1,e.legions){let a=e.legions.findIndex(e=>e._id===t.payload._id);-1!==a&&(e.legions[a]=t.payload)}}).addCase(k.rejected,(e,t)=>{e.loading=!1,e.error=t.error.message||"Ошибка при обновлении легиона"}).addCase(S.pending,e=>{e.loading=!0,e.error=null}).addCase(S.fulfilled,(e,t)=>{e.loading=!1,e.legions&&(e.legions=e.legions.filter(e=>e._id!==t.payload))}).addCase(S.rejected,(e,t)=>{e.loading=!1,e.error=t.error.message||"Ошибка при удалении легиона"})}}),{getLegion:z,clearError:E}=L,P=(0,s.createContext)(void 0),D=e=>{let{children:t}=e,a=_();(0,s.useEffect)(()=>{a(u()),a(N())},[a]);let[r,l]=(0,s.useState)([""]),[i,o]=(0,s.useState)(!0),[c,d]=(0,s.useState)(1),[p,m]=(0,s.useState)(0),[g,x]=(0,s.useState)(0),[h,f]=(0,s.useState)(!1),[v,j]=(0,s.useState)(null),b=(0,s.useRef)(null),w=(0,s.useRef)(null),y={width:2500},[C,k]=(0,s.useState)({x:1}),S=(0,s.useCallback)((e,t,a)=>{if(!b.current)return{clampedOffsetX:e,clampedOffsetY:t};let n=b.current.clientWidth,s=b.current.clientHeight,r=n*a,l=s*a,i=e,o=t;return i>0&&(i=0),o>0&&(o=0),l<=s?o=(s-l)/2:o+l<s&&(o=s-l),r<=n?i=(n-r)/2:i+r<n&&(i=n-r),{clampedOffsetX:i,clampedOffsetY:o}},[]),L=(0,s.useCallback)(()=>{if(w.current){let{width:e}=w.current.getBoundingClientRect();k({x:e/y.width})}},[]);(0,s.useEffect)(()=>{L();let e=()=>{L()};return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[L]);let R=(0,s.useCallback)(e=>({top:e.top*C.x,left:e.left*C.x}),[C.x]);return(0,n.jsx)(P.Provider,{value:{currentLegions:r,setCurrentLegions:l,isVisible:i,setIsVisible:o,currentPlanet:v,setCurrentPlanet:j,scale:c,offsetX:p,offsetY:g,setScale:d,setOffsetX:m,setOffsetY:x,isDragging:h,setIsDragging:f,viewerRef:b,spaceMapRef:w,clampOffsets:S,scaleFactor:C,getScaledPosition:R},children:t})},I=()=>{let e=(0,s.useContext)(P);if(void 0===e)throw Error("useMap must be used within a MapProvider");return e};var F=a(4778),M=a.n(F);let A=e=>{let{isVisible:t}=e;return(0,n.jsxs)("div",{className:M().container,children:[(0,n.jsx)("img",{className:[M().border,!t&&M().hidden].join(" "),src:"/assets/borders/borders.png"}),(0,n.jsx)("img",{className:[M().segment,M()["container-obscurus"],!t&&M().hidden].join(" "),src:"/assets/borders/segments_obscurus.png"}),(0,n.jsx)("img",{className:[M().segment,M()["container-pacificus"],!t&&M().hidden].join(" "),src:"/assets/borders/segments_pacificus.png"}),(0,n.jsx)("img",{className:[M().segment,M()["container-tempestus"],!t&&M().hidden].join(" "),src:"/assets/borders/segments_tempestus.png"}),(0,n.jsx)("img",{className:[M().segment,M()["container-ultima"],!t&&M().hidden].join(" "),src:"/assets/borders/segments_ultima.png"}),(0,n.jsx)("img",{className:[M().segment,M()["container-solar"],!t&&M().hidden].join(" "),src:"/assets/borders/solar.png"})]})};var T=a(4313),B=a.n(T);let O=e=>{let{planet:t}=e,{legions:a,loading:r}=w(e=>e.reducerLegions),{isVisible:l}=I(),i=e=>{if(a){let t=a.find(t=>t._id===e);return null==t?void 0:t.icon}},{scaleFactor:o,setCurrentPlanet:c,setCurrentLegions:d}=I(),[u,p]=(0,s.useState)(100),[m,g]=(0,s.useState)(1e3),[x,h]=(0,s.useState)(1e3),f=(0,s.useMemo)(()=>t.legions&&a?t.legions.map(e=>i(e)).filter(e=>void 0!==e):[],[t.legions,a]);return(0,s.useEffect)(()=>{t&&(p(t.size),h(t.top),g(t.left))},[t]),(0,n.jsxs)("div",{className:B().planet,style:{width:"".concat(u*o.x*1.5,"px"),aspectRatio:"1 / 1",left:"".concat(m*o.x-u*o.x/2,"px"),top:"".concat(x*o.x-u*o.x/2,"px")},onClick:()=>{d(f),c(t)},children:[(0,n.jsx)("img",{className:B()["planet-icon"],src:"".concat("http://45.141.76.253","/static/")+t.pic+".png",style:{width:"60%"},alt:"Planet ".concat(t.name)}),(0,n.jsxs)("div",{className:[1===t.name.split(" ").length?B().one:B().two,B()["planet-label"],"opacity-".concat(+!!l)].join(" "),children:[1===t.name.split(" ").length?(0,n.jsx)("div",{className:"translate-y-[-0.3em]",style:{fontSize:"".concat(u*o.x*.28,"px")},children:t.name}):(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center w-full padding-top-2",style:{fontSize:"".concat(u*o.x*.28,"px")},children:[(0,n.jsx)("p",{className:"leading-none translate-y-[0.2em]  text-center",children:t.name.split(" ")[0]}),(0,n.jsx)("p",{className:"leading-none translate-y-[-0.35em] text-center",children:t.name.split(" ")[1]})]}),(0,n.jsx)("div",{className:[B().wrapper,f.length>1?"justify-between":"justify-center"].join(" "),children:!r&&f.map((e,t)=>(0,n.jsx)("img",{src:"http://45.141.76.253/static/"+e+".png",style:{zIndex:1e3,height:"100%"},alt:"Legion icon ".concat(t+1)},t))})]})]})},W=()=>{let{isVisible:e,scale:t,offsetX:a,offsetY:r,setScale:i,setOffsetX:o,setOffsetY:c,isDragging:d,setIsDragging:u,viewerRef:p,spaceMapRef:m,clampOffsets:g}=I(),{planets:x,loading:h,error:f}=w(e=>e.reducerPlanets),v=(0,s.useRef)(0),j=(0,s.useRef)(0),b=(0,s.useRef)(0),_=(0,s.useRef)(0),y=(0,s.useCallback)(()=>{m.current&&(m.current.style.transform="translate(".concat(a,"px, ").concat(r,"px) scale(").concat(t,")"))},[m,a,r,t]);(0,s.useEffect)(()=>{y()},[y]);let N=(0,s.useCallback)(e=>{if(e.preventDefault(),!p.current)return;let n=p.current.getBoundingClientRect(),s=e.clientX-n.left,l=e.clientY-n.top,d=Math.max(1,Math.min(10,e.deltaY<0?1.2*t:t/1.2)),{clampedOffsetX:u,clampedOffsetY:m}=g(s-d/t*(s-a),l-d/t*(l-r),d);i(d),o(u),c(m)},[t,a,r,g,i,o,c,p]),C=(0,s.useCallback)(e=>{e.target instanceof HTMLElement&&e.target.classList.contains("icon"),u(!0),v.current=e.clientX,j.current=e.clientY,b.current=a,_.current=r,m.current&&(m.current.style.cursor="grabbing")},[a,r,u,m]),k=(0,s.useCallback)(e=>{if(d){let a=e.clientX-v.current,n=e.clientY-j.current,{clampedOffsetX:s,clampedOffsetY:r}=g(b.current+a,_.current+n,t);o(s),c(r)}},[d,t,g,o,c]),S=(0,s.useCallback)(()=>{u(!1),m.current&&(m.current.style.cursor="grab")},[u,m]);return(0,s.useEffect)(()=>{let e=p.current;return e&&(e.addEventListener("wheel",N,{passive:!1}),e.addEventListener("mousedown",C)),document.addEventListener("mousemove",k),document.addEventListener("mouseup",S),()=>{e&&(e.removeEventListener("wheel",N),e.removeEventListener("mousedown",C)),document.removeEventListener("mousemove",k),document.removeEventListener("mouseup",S)}},[N,C,k,S,p]),(0,n.jsxs)("div",{id:l()["viewer-container"],ref:p,children:[(0,n.jsxs)("div",{id:l()["space-map"],ref:m,children:[(0,n.jsx)(A,{isVisible:e}),!h&&x?x.map((e,t)=>(0,n.jsx)(O,{planet:e},t)):null]}),(0,n.jsxs)("div",{id:l()["zoom-level"],children:[" ",t.toFixed(2),"х"]})]})};var H=a(8271),J=a.n(H),K=a(1110),q=a.n(K),V=a(9137),$=a.n(V);let Q=e=>{let{size:t="medium",color:a="#4299e1",text:s,className:r=""}=e,l={small:"16px",medium:"32px",large:"48px"},i={width:l[t],height:l[t],border:"3px solid #f3f3f3",borderTop:"3px solid ".concat(a),borderRadius:"50%",animation:"spin 1s linear infinite"};return(0,n.jsxs)("div",{style:{textAlign:"center"},className:"jsx-ae1ebebb41df1f90 "+"loading-spinner-container ".concat(r),children:[(0,n.jsx)("div",{style:i,role:"status","aria-label":"Loading",className:"jsx-ae1ebebb41df1f90 loading-spinner"}),s&&(0,n.jsx)("p",{style:{marginTop:"8px",color:"#666",fontSize:"small"===t?"12px":"medium"===t?"14px":"16px"},className:"jsx-ae1ebebb41df1f90",children:s}),(0,n.jsx)($(),{id:"ae1ebebb41df1f90",children:"@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-moz-keyframes spin{0%{-moz-transform:rotate(0deg);transform:rotate(0deg)}100%{-moz-transform:rotate(360deg);transform:rotate(360deg)}}@-o-keyframes spin{0%{-o-transform:rotate(0deg);transform:rotate(0deg)}100%{-o-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spin{0%{-webkit-transform:rotate(0deg);-moz-transform:rotate(0deg);-o-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);-o-transform:rotate(360deg);transform:rotate(360deg)}}.loading-spinner-container.jsx-ae1ebebb41df1f90{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center}"})]})},Y=e=>{let{images:t}=e;return t&&0!==t.length?(0,n.jsx)("div",{className:"grid gap-2 w-[100%] ".concat(1===t.length?"grid-cols-1":"grid-cols-2"),children:t.map((e,t)=>(0,n.jsx)("img",{src:"".concat("http://45.141.76.253","/static/").concat(e,".jpg"),alt:"Снимок ".concat(t+1),className:"w-full h-32 object-cover rounded"},t))}):(0,n.jsx)("div",{children:"Нет изображений"})};var X=a(2760),U=a(6671);let Z=(e,t)=>e.length>t?e.substring(0,t)+"...":e,G=e=>{let{description:t,events:a,planetslinks:r,isLoading:l=!1}=e,{planets:i}=w(e=>e.reducerPlanets),{legions:o}=w(e=>e.reducerLegions),c=e=>{if(o){let t=o.find(t=>t._id===e);return null==t?void 0:t.icon}},d=e=>e&&e.legions&&o?e.legions.map(e=>c(e)).filter(e=>void 0!==e):[],[p,m]=(0,s.useState)([]),{currentPlanet:x,setCurrentPlanet:h,setCurrentLegions:f}=I();(0,s.useEffect)(()=>{i&&r?m(i.filter(e=>r.includes(e._id))):m([])},[i,r]);let{data:v,isPending:j}=X.yK.useSession(),[b,y]=(0,s.useState)(!1);(0,s.useEffect)(()=>{(null==v?void 0:v.user.role)==="ADMIN"?y(!0):y(!1)},[v]);let N=_(),C=async e=>{try{let t=await N(g(e));g.fulfilled.match(t)?(U.oR.success("ивент успешно удалена"),N(u())):U.oR.error("Ошибка при удалении ивента")}catch(e){U.oR.error("Произошла ошибка при удалении")}};return(0,n.jsxs)("div",{className:q().scrollWrapper,children:[t?(0,n.jsxs)("div",{className:q().description,children:[(0,n.jsx)("p",{className:q().descriptionTitle,style:{marginBottom:0},children:"описание"}),(0,n.jsx)("p",{className:"break-all",style:{marginBottom:0,marginTop:0},children:t})]}):(0,n.jsx)("div",{className:q().noData,children:(0,n.jsx)("p",{children:"данные описания отсутствуют"})}),(0,n.jsx)("div",{className:q().border}),l?(0,n.jsx)("div",{style:{padding:"20px"},children:(0,n.jsx)(Q,{size:"medium",text:"Загрузка событий...",color:"#4299e1"})}):p&&p.length>0?p.map((e,t)=>(0,n.jsx)("div",{className:q().planet,style:{width:"90%",height:"17%"},children:(0,n.jsxs)("div",{onClick:()=>{h(e),f(d(e))},className:"flex flex-row justify-evenly content-center h-[100%] border border-[#333] border-dashed border-[0.2vw]  ",children:[(0,n.jsxs)("div",{className:"flex flex-col ",children:[(0,n.jsx)("p",{className:[q().eventTitle,"self-center "].join(" "),children:Z(e.name,10)}),(0,n.jsx)("p",{className:[q().description,"self-center "].join(" "),children:e.ingamePosition})]}),(0,n.jsx)("img",{className:"h-[80%] transform hover:scale-110 transition self-center",src:"".concat("http://45.141.76.253","/static/").concat(e.pic,".png"),alt:""})]})},e._id||t)):(0,n.jsx)("div",{className:q().noData}),(0,n.jsx)("div",{className:q().border}),l?(0,n.jsx)("div",{style:{padding:"20px"},children:(0,n.jsx)(Q,{size:"medium",text:"Загрузка событий...",color:"#4299e1"})}):a&&a.length>0?a.map((e,t)=>(0,n.jsxs)("div",{className:q().event,style:{width:"100%"},children:[(0,n.jsx)("p",{className:q().eventTitle,style:{marginBottom:0},children:e.name}),(0,n.jsx)(Y,{images:null==e?void 0:e.shots}),(0,n.jsx)("p",{style:{marginBottom:0},children:e.description}),(0,n.jsx)("button",{className:"text-[#007acc]",onClick:()=>window.open(e.link,"_blank"),children:"смотреть в официальном канале"}),b&&(0,n.jsx)("div",{className:"text-red-600",onClick:()=>C(e._id),children:"удалить"}),(0,n.jsx)("div",{className:q().border})]},e._id||t)):(0,n.jsx)("div",{className:q().noData,children:(0,n.jsx)("p",{children:"данные о событиях отсутствуют"})})]})};var ee=a(6231),et=a.n(ee),ea=a(2714);let en=e=>{let{item:t}=e,{currentLegions:a}=I(),s=w(e=>e.reducerLegions.legions);if(!t)return(0,n.jsx)(n.Fragment,{});if(!function(e){return void 0!==e.pic&&void 0!==e.size}(t))return(0,n.jsxs)("div",{className:et().upperInfo,children:[(0,n.jsx)("div",{className:et().title,children:(0,n.jsx)("p",{className:et().nameLegion,children:t.name})}),(0,n.jsx)("div",{className:et().iconWrapper,children:(0,n.jsx)("img",{className:et().icon,src:"http://localhost:5000/static/"+t.icon+".png",alt:t.name})})]});let r=t.legions&&t.legions.length>0,l=e=>{if(!s)return"";let t=s.find(t=>t._id===e);return(null==t?void 0:t.name)||""};return(0,n.jsxs)("div",{className:et().upperInfo,children:[(0,n.jsxs)("div",{className:et().title,children:[(0,n.jsx)("p",{className:et().name,children:t.name}),(0,n.jsxs)("p",{className:et().ingamePosition,children:["координаты: ",t.ingamePosition||"Unknown"]})]}),(0,n.jsx)("div",{className:et().iconWrapper,children:(0,n.jsx)("img",{className:et().icon,src:"http://localhost:5000/static/"+t.pic+".png",alt:t.name})}),(0,n.jsx)("div",{className:et().imageContainer,children:r?a.map((e,a)=>{var s;return(0,n.jsxs)("div",{className:et().imageWrapper,children:[(0,n.jsx)("img",{src:"http://localhost:5000/static/"+e+".png",className:" object-cover h-full"}),(0,n.jsx)(ea.J,{className:et().imageLabel,children:l((null==(s=t.legions)?void 0:s[a])||"")})]},a)}):(0,n.jsx)("div",{})})]})},es=()=>{let{currentPlanet:e}=I();return null==e?(0,n.jsx)("div",{id:J().infoSidebar}):(e.planets,(0,n.jsxs)("div",{id:J().infoSidebar,children:[(0,n.jsx)(en,{item:e}),(0,n.jsx)(G,{description:e.description?e.description:null,events:e.events?e.events:null,planetslinks:e.planets||null})]}))};var er=a(5754),el=a.n(er),ei=a(6672),eo=a.n(ei);let ec=e=>{let{text:t}=e;return(0,n.jsx)("div",{className:eo().marquee,children:(0,n.jsxs)("div",{className:eo().track,children:[(0,n.jsx)("span",{className:eo().text,children:t}),(0,n.jsx)("span",{className:eo().text,children:t})]})})},ed=()=>(0,n.jsx)("div",{id:"upper-menu",className:el().upperMenu,children:(0,n.jsx)(ec,{text:"Тронный мир и столица Империума Человечества, родная планета человеческой расы, а также место рождения самого Императора Человечества. Это самое священное и почитаемое место среди всех миллионов миров, составляющих межзвёздную державу человечества."})}),eu={searchQuery:"",hasSearchQuery:!1,searchResults:[],selectedResult:null,searchHistory:[]},ep=(0,i.Z0)({name:"search",initialState:eu,reducers:{setSearchQuery:(e,t)=>{let a=t.payload.trim();e.searchQuery=a,e.hasSearchQuery=a.length>0,a&&!e.searchHistory.includes(a)&&(e.searchHistory.unshift(a),e.searchHistory.length>10&&(e.searchHistory=e.searchHistory.slice(0,10)))},setSearchResults:(e,t)=>{e.searchResults=t.payload},selectSearchResult:(e,t)=>{e.selectedResult=t.payload},clearSelectedResult:e=>{e.selectedResult=null},clearSearchResults:e=>{e.searchResults=[],e.selectedResult=null},clearSearchHistory:e=>{e.searchHistory=[]},removeFromSearchHistory:(e,t)=>{e.searchHistory=e.searchHistory.filter(e=>e!==t.payload)},resetSearchState:e=>eu}}),{setSearchQuery:em,setSearchResults:eg,selectSearchResult:ex,clearSelectedResult:eh,clearSearchResults:ef,clearSearchHistory:ev,removeFromSearchHistory:ej,resetSearchState:eb}=ep.actions,e_=ep.reducer,ew=()=>(0,i.U1)({reducer:{reducerPlanets:v,reducerLegions:R,search:e_}});function ey(e){let{children:t}=e,a=(0,s.useRef)(void 0);return a.current||(a.current=ew()),(0,n.jsx)(b.Kq,{store:a.current,children:t})}var eN=a(2513),eC=a.n(eN),ek=a(5695),eS=a(939),eL=function(e){return e.map="map",e.dashboard="dashboard",e}(eL||{});let eR=e=>{let{currentBlock:t,setCurrentBlock:a}=e,[r,l]=(0,s.useState)(!1),i=(0,ek.useRouter)(),{isVisible:o,setIsVisible:c}=I(),d=(0,s.useCallback)(e=>{try{"map"==e&&a("map"),"dashboard"==e&&a("dashboard")}catch(e){console.log(e)}},[t,a]),u=(0,s.useCallback)(e=>{try{i.push(e)}catch(t){console.error("Navigation error:",t);try{window.location.href=e}catch(e){console.error("Fallback navigation also failed:",e)}}},[i]),p=(0,s.useCallback)(()=>{l(!r)},[r]),m=(0,s.useCallback)(()=>{try{c(!o)}catch(e){console.error("Error toggling border visibility:",e)}},[o,c]),g=(0,s.useCallback)((e,t)=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),t())},[]),x=(0,eS.j)(()=>l(!1));return(0,n.jsxs)("div",{className:eC().menuContainer,ref:x,children:[(0,n.jsx)("button",{className:eC().menuButton,onClick:p,"aria-label":"Toggle navigation menu","aria-expanded":r,"aria-controls":"navigation-menu"}),(0,n.jsx)("div",{className:eC().wrapper,children:(0,n.jsx)("div",{id:"navigation-menu",className:"".concat(eC().menuContent," ").concat(r?eC().menuContentActive:""),role:"navigation","aria-label":"Main navigation",children:[{id:"home",label:"Navigate to home",path:"/",action:()=>d("map")},{id:"search",label:"Open search",path:"/search",action:()=>d("dashboard")},{id:"border",label:"Toggle border visibility",action:m},{id:"admin",label:"Navigate to login ",path:"/login",action:()=>u("/login")}].map(e=>(0,n.jsx)("a",{id:e.id,className:"".concat(eC().menuLink," ").concat(eC()["".concat(e.id,"Link")]),onClick:e.action,onKeyDown:t=>g(t,e.action),role:"button",tabIndex:0,"aria-label":e.label},e.id))})})]})};var ez=a(15),eE=a.n(ez);let eP=e=>{let{planet:t,onclick:a,ondelete:r,onCreateEvent:l}=e,{legions:i}=w(e=>e.reducerLegions),{data:o,isPending:c}=X.yK.useSession(),[d,u]=(0,s.useState)(!1);(0,s.useEffect)(()=>{(null==o?void 0:o.user.role)==="ADMIN"?u(!0):u(!1)},[o]);let p=e=>{if(i){let t=i.find(t=>t._id===e);return null==t?void 0:t.icon}},m=t.legions&&i?t.legions.map(e=>p(e)).filter(e=>void 0!==e):[],[g,x]=(0,s.useState)(t),{setCurrentLegions:h,setCurrentPlanet:f}=I();return(0,n.jsx)("div",{className:eE().planetBar,onClick:()=>{var e;return t._id,void(h(m),f(t))},children:(0,n.jsxs)("div",{className:"flex flex-row justify-around w-[100%] h-[100%]",children:[(0,n.jsxs)("div",{className:"flex flex-col ",children:[(0,n.jsx)("div",{className:eE().name,children:Z(g.name,12)}),(0,n.jsxs)("div",{className:[eE().position,"inline-block whitespace-nowrap"].join(" "),children:["-расположение ---",g.ingamePosition]})]}),(0,n.jsx)("div",{className:"flex flex-row  justify-evenly h-full ",children:m&&m.length>0?m.map((e,t)=>(0,n.jsx)("img",{src:"http://45.141.76.253/static/"+e+".png",alt:"Легион ".concat(t),className:"h-[100%] object-contain rounded"},e)):(0,n.jsx)("div",{children:"легионы не найдены."})}),d&&(0,n.jsxs)("div",{className:"flex flex-col  ",children:[(0,n.jsx)("button",{className:eE().id,onClick:()=>a(t),children:"Редактировать"}),(0,n.jsx)("button",{className:eE().id,onClick:()=>r(t._id),children:"Удалить"}),(0,n.jsx)("button",{className:eE().id,onClick:()=>{l&&l(t._id)},children:"Создать ивент"})]})]})},t._id)},eD=e=>{var t;let{legion:a,onclick:r,ondelete:l}=e,{data:i,isPending:o}=X.yK.useSession(),[c,d]=(0,s.useState)(!1);(0,s.useEffect)(()=>{(null==i?void 0:i.user.role)==="ADMIN"?d(!0):d(!1)},[i]);let{setCurrentPlanet:u}=I(),p=e=>{u(e)};return(0,n.jsx)("div",{className:eE().planetBar,onClick:()=>p(a),children:(0,n.jsxs)("div",{className:"flex flex-row justify-around w-full h-[100%]",children:[(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("p",{className:eE().name,children:a.name}),(0,n.jsxs)("p",{className:eE().name,children:["обьектов-",null==(t=a.planets)?void 0:t.length]})]}),a.icon?(0,n.jsx)("img",{src:"".concat("http://45.141.76.253","/static/").concat(a.icon,".png"),alt:a.name,className:"h-[100%] object-contain "}):(0,n.jsx)("div",{children:"иконка не найдена"}),c&&(0,n.jsxs)("div",{className:"flex flex-col gap-2 mt-2",children:[(0,n.jsx)("button",{className:eE().id,onClick:()=>r(a),children:"Редактировать"}),(0,n.jsx)("button",{className:eE().id,onClick:()=>l(a._id),children:"Удалить"})]})]})},a._id)};var eI=a(9474),eF=a(3999);function eM(e){let{...t}=e;return(0,n.jsx)(eI._s.Root,{"data-slot":"drawer",...t})}function eA(e){let{...t}=e;return(0,n.jsx)(eI._s.Trigger,{"data-slot":"drawer-trigger",...t})}function eT(e){let{...t}=e;return(0,n.jsx)(eI._s.Portal,{"data-slot":"drawer-portal",...t})}function eB(e){let{...t}=e;return(0,n.jsx)(eI._s.Close,{"data-slot":"drawer-close",...t})}function eO(e){let{className:t,...a}=e;return(0,n.jsx)(eI._s.Overlay,{"data-slot":"drawer-overlay",className:(0,eF.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function eW(e){let{className:t,children:a,...s}=e;return(0,n.jsxs)(eT,{"data-slot":"drawer-portal",children:[(0,n.jsx)(eO,{}),(0,n.jsxs)(eI._s.Content,{"data-slot":"drawer-content",className:(0,eF.cn)("group/drawer-content bg-background fixed z-50 flex h-auto flex-col","data-[vaul-drawer-direction=top]:inset-x-0 data-[vaul-drawer-direction=top]:top-0 data-[vaul-drawer-direction=top]:mb-24 data-[vaul-drawer-direction=top]:max-h-[80vh] data-[vaul-drawer-direction=top]:rounded-b-lg data-[vaul-drawer-direction=top]:border-b","data-[vaul-drawer-direction=bottom]:inset-x-0 data-[vaul-drawer-direction=bottom]:bottom-0 data-[vaul-drawer-direction=bottom]:mt-24 data-[vaul-drawer-direction=bottom]:max-h-[80vh] data-[vaul-drawer-direction=bottom]:rounded-t-lg data-[vaul-drawer-direction=bottom]:border-t","data-[vaul-drawer-direction=right]:inset-y-0 data-[vaul-drawer-direction=right]:right-0 data-[vaul-drawer-direction=right]:w-3/4 data-[vaul-drawer-direction=right]:border-l data-[vaul-drawer-direction=right]:sm:max-w-sm","data-[vaul-drawer-direction=left]:inset-y-0 data-[vaul-drawer-direction=left]:left-0 data-[vaul-drawer-direction=left]:w-3/4 data-[vaul-drawer-direction=left]:border-r data-[vaul-drawer-direction=left]:sm:max-w-sm",t),...s,children:[(0,n.jsx)("div",{className:"bg-muted mx-auto mt-4 hidden h-2 w-[100px] shrink-0 rounded-full group-data-[vaul-drawer-direction=bottom]/drawer-content:block"}),a]})]})}function eH(e){let{className:t,...a}=e;return(0,n.jsx)("div",{"data-slot":"drawer-header",className:(0,eF.cn)("flex flex-col gap-0.5 p-4 group-data-[vaul-drawer-direction=bottom]/drawer-content:text-center group-data-[vaul-drawer-direction=top]/drawer-content:text-center md:gap-1.5 md:text-left",t),...a})}function eJ(e){let{className:t,...a}=e;return(0,n.jsx)("div",{"data-slot":"drawer-footer",className:(0,eF.cn)("mt-auto flex flex-col gap-2 p-4",t),...a})}function eK(e){let{className:t,...a}=e;return(0,n.jsx)(eI._s.Title,{"data-slot":"drawer-title",className:(0,eF.cn)("text-foreground font-semibold",t),...a})}function eq(e){let{className:t,...a}=e;return(0,n.jsx)(eI._s.Description,{"data-slot":"drawer-description",className:(0,eF.cn)("text-muted-foreground text-sm",t),...a})}var eV=a(7168),e$=a(9852);let eQ=e=>{let{values:t,onChange:a}=e,{legions:s,loading:r,error:l}=w(e=>e.reducerLegions);return null==s?null:(0,n.jsxs)("div",{className:"grid gap-4",children:[(0,n.jsxs)("div",{className:"grid gap-3",children:[(0,n.jsx)(ea.J,{htmlFor:"name",children:"Имя"}),(0,n.jsx)(e$.p,{id:"name",name:"name",value:t.name,onChange:a})]}),(0,n.jsxs)("div",{className:"grid gap-3",children:[(0,n.jsx)(ea.J,{htmlFor:"ingamePosition",children:"Корды в игре"}),(0,n.jsx)(e$.p,{id:"ingamePosition",name:"ingamePosition",value:t.ingamePosition,onChange:a})]}),(0,n.jsxs)("div",{className:"grid gap-3",children:[(0,n.jsx)(ea.J,{htmlFor:"description",children:"Описание"}),(0,n.jsx)(e$.p,{id:"description",name:"description",value:t.description,onChange:a})]}),(0,n.jsxs)("div",{className:"grid gap-3",children:[(0,n.jsx)(ea.J,{htmlFor:"left",children:"Растояние по х"}),(0,n.jsx)(e$.p,{id:"left",name:"left",value:t.left,onChange:a})]}),(0,n.jsxs)("div",{className:"grid gap-3",children:[(0,n.jsx)(ea.J,{htmlFor:"top",children:"Растояние по у"}),(0,n.jsx)(e$.p,{id:"top",name:"top",value:t.top,onChange:a})]}),(0,n.jsxs)("div",{className:"grid gap-3",children:[(0,n.jsx)(ea.J,{htmlFor:"size",children:"Размер"}),(0,n.jsx)(e$.p,{id:"size",name:"size",value:t.size,onChange:a})]}),(0,n.jsxs)("div",{className:"grid gap-3",children:[(0,n.jsx)(ea.J,{htmlFor:"pic",children:"Иконка"}),(0,n.jsx)(e$.p,{type:"file",id:"pic",name:"pic",value:void 0,onChange:a,accept:"image/*"})]}),(0,n.jsxs)("div",{className:"grid gap-3",children:[(0,n.jsx)(ea.J,{htmlFor:"legion1",children:"Легион 1"}),(0,n.jsxs)("select",{id:"legion1",name:"legion1",onChange:a,children:[t.legion1&&(0,n.jsx)("option",{value:t.legion1,children:"без изменения"}),(0,n.jsx)("option",{value:"",children:"без легиона"}),s.map(e=>(0,n.jsx)("option",{value:e._id,children:e.name},e._id))]})]}),(0,n.jsxs)("div",{className:"grid gap-3",children:[(0,n.jsx)(ea.J,{htmlFor:"legion2",children:"Легион 2"}),(0,n.jsxs)("select",{id:"legion2",name:"legion2",onChange:a,children:[t.legion2&&(0,n.jsx)("option",{value:t.legion2,children:"без изменения "}),(0,n.jsx)("option",{value:"",children:"без легиона"}),s.map(e=>(0,n.jsx)("option",{value:e._id,children:e.name},e._id))]})]})]})},eY=e=>{let{initialValues:t,onSubmit:a}=e,[r,l]=(0,s.useState)(t);return(0,n.jsxs)("form",{onSubmit:e=>{e.preventDefault();let t=new FormData;for(let e in r){let a=r[e];a instanceof File?t.append(e,a):Array.isArray(a)?a.forEach(a=>{a instanceof File&&t.append(e,a)}):null!=a&&t.append(e,String(a))}a(t)},className:"space-y-6",children:[(0,n.jsx)(eQ,{values:r,onChange:e=>{let{name:t,value:a}=e.target,n=e.target.files;l(e=>({...e,[t]:n&&n.length>0?n[0]:a}))}}),(0,n.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,n.jsx)(eV.$,{type:"button",variant:"outline",onClick:()=>{l(t)},children:"Сбросить"}),(0,n.jsx)(eV.$,{type:"submit",children:"Сохранить"})]})]})},eX=e=>{let{initialData:t,isOpen:a,onClose:r,onSave:l}=e,[i,o]=(0,s.useState)(t);return((0,s.useEffect)(()=>{o(t)},[t]),i)?(0,n.jsx)(eM,{open:a,onOpenChange:e=>!e&&r(),children:(0,n.jsxs)(eW,{className:"flex flex-col h-full max-w-xl",children:[(0,n.jsxs)(eH,{children:[(0,n.jsx)(eK,{children:"Редактировать планету"}),(0,n.jsx)(eq,{children:"Измените данные планеты и сохраните"})]}),(0,n.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:(0,n.jsx)(eY,{initialValues:i,onSubmit:e=>{l(e,i.id||""),r()}})}),(0,n.jsx)(eJ,{className:"flex-shrink-0",children:(0,n.jsx)(eB,{asChild:!0,children:(0,n.jsx)(eV.$,{onClick:r,children:"Закрыть"})})})]})}):null};var eU=a(3470),eZ=a(4416);function eG(e){let{...t}=e;return(0,n.jsx)(eU.bL,{"data-slot":"dialog",...t})}function e0(e){let{...t}=e;return(0,n.jsx)(eU.ZL,{"data-slot":"dialog-portal",...t})}function e1(e){let{...t}=e;return(0,n.jsx)(eU.bm,{"data-slot":"dialog-close",...t})}function e2(e){let{className:t,...a}=e;return(0,n.jsx)(eU.hJ,{"data-slot":"dialog-overlay",className:(0,eF.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function e5(e){let{className:t,children:a,showCloseButton:s=!0,...r}=e;return(0,n.jsxs)(e0,{"data-slot":"dialog-portal",children:[(0,n.jsx)(e2,{}),(0,n.jsxs)(eU.UC,{"data-slot":"dialog-content",className:(0,eF.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...r,children:[a,s&&(0,n.jsxs)(eU.bm,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,n.jsx)(eZ.A,{}),(0,n.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function e3(e){let{className:t,...a}=e;return(0,n.jsx)("div",{"data-slot":"dialog-header",className:(0,eF.cn)("flex flex-col gap-2 text-center sm:text-left",t),...a})}function e4(e){let{className:t,...a}=e;return(0,n.jsx)("div",{"data-slot":"dialog-footer",className:(0,eF.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...a})}function e6(e){let{className:t,...a}=e;return(0,n.jsx)(eU.hE,{"data-slot":"dialog-title",className:(0,eF.cn)("text-lg leading-none font-semibold",t),...a})}function e9(e){let{className:t,...a}=e;return(0,n.jsx)(eU.VY,{"data-slot":"dialog-description",className:(0,eF.cn)("text-muted-foreground text-sm",t),...a})}let e7=e=>{let{planetId:t,isOpen:a,onClose:s,onDelete:r}=e;return(0,n.jsx)(eG,{open:a,onOpenChange:e=>!e&&s(),children:(0,n.jsxs)(e5,{children:[(0,n.jsxs)(e3,{children:[(0,n.jsx)(e6,{children:"Подтверждение удаления"}),(0,n.jsx)(e9,{children:"Вы уверены, что хотите удалить эту планету? Это действие невозможно отменить."})]}),(0,n.jsxs)(e4,{children:[(0,n.jsx)(e1,{asChild:!0,children:(0,n.jsx)(eV.$,{variant:"outline",children:"Отмена"})}),(0,n.jsx)(eV.$,{variant:"destructive",onClick:()=>{t&&(r(t),s())},children:"Удалить"})]})]})})},e8=e=>{let{values:t,onChange:a}=e;return(0,n.jsxs)("div",{className:"grid gap-4",children:[(0,n.jsxs)("div",{className:"grid gap-3",children:[(0,n.jsx)(ea.J,{htmlFor:"name",children:"Имя"}),(0,n.jsx)(e$.p,{id:"name",name:"name",value:t.name,onChange:a})]}),(0,n.jsxs)("div",{className:"grid gap-3",children:[(0,n.jsx)(ea.J,{htmlFor:"description",children:"Описание"}),(0,n.jsx)(e$.p,{id:"description",name:"description",value:t.description,onChange:a})]}),(0,n.jsxs)("div",{className:"grid gap-3",children:[(0,n.jsx)(ea.J,{htmlFor:"icon",children:"Иконка"}),(0,n.jsx)(e$.p,{type:"file",id:"icon",name:"icon",onChange:a,accept:"image/*"})]})]})},te=e=>{let{initialValues:t,onSubmit:a}=e,[r,l]=(0,s.useState)(t);return(0,n.jsxs)("form",{onSubmit:e=>{e.preventDefault();let t=new FormData;for(let e in r){let a=r[e];null!=a&&(a instanceof File?t.append(e,a):t.append(e,String(a)))}a(t)},className:"space-y-6",children:[(0,n.jsx)(e8,{values:r,onChange:e=>{let{name:t,value:a,files:n}=e.target;l(e=>({...e,[t]:n?n[0]:a}))}}),(0,n.jsx)("div",{className:"flex justify-end gap-2",children:(0,n.jsx)(eV.$,{type:"submit",children:"Сохранить"})})]})},tt=e=>{let{initialData:t,isOpen:a,onClose:r,onSave:l}=e,[i,o]=(0,s.useState)(t);return((0,s.useEffect)(()=>{o(t)},[t]),i)?(0,n.jsx)(eM,{open:a,onOpenChange:e=>!e&&r(),children:(0,n.jsxs)(eW,{className:"flex flex-col h-full max-w-xl",children:[(0,n.jsxs)(eH,{children:[(0,n.jsx)(eK,{children:"Редактировать планету"}),(0,n.jsx)(eq,{children:"Измените данные планеты и сохраните"})]}),(0,n.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:(0,n.jsx)(te,{initialValues:i,onSubmit:e=>{l(e,i.id||""),r()}})}),(0,n.jsx)(eJ,{className:"flex-shrink-0",children:(0,n.jsx)(eB,{asChild:!0,children:(0,n.jsx)(eV.$,{onClick:r,children:"Закрыть"})})})]})}):null},ta=e=>{let{legionId:t,isOpen:a,onClose:s,onDelete:r}=e;return(0,n.jsx)(eG,{open:a,onOpenChange:e=>!e&&s(),children:(0,n.jsxs)(e5,{children:[(0,n.jsxs)(e3,{children:[(0,n.jsx)(e6,{children:"Подтверждение удаления"}),(0,n.jsx)(e9,{children:"Вы уверены, что хотите удалить этот легион? Это действие невозможно отменить."})]}),(0,n.jsxs)(e4,{children:[(0,n.jsx)(e1,{asChild:!0,children:(0,n.jsx)(eV.$,{variant:"outline",children:"Отмена"})}),(0,n.jsx)(eV.$,{variant:"destructive",onClick:()=>{t&&(r(t),s())},children:"Удалить"})]})]})})};function tn(e){let{isOpen:t,onClose:a,onSave:r,planetId:l}=e,[i,o]=(0,s.useState)(""),[c,d]=(0,s.useState)(""),[u,p]=(0,s.useState)(""),[m,g]=(0,s.useState)([]);return(0,n.jsx)(eG,{open:t,onOpenChange:e=>!e&&a(),children:(0,n.jsxs)(e5,{children:[(0,n.jsxs)(e3,{children:[(0,n.jsx)(e6,{children:"Подтверждение удаления"}),(0,n.jsx)(e9,{children:"Вы уверены, что хотите удалить этот легион? Это действие невозможно отменить."})]}),(0,n.jsx)("input",{placeholder:"Название",value:i,onChange:e=>o(e.target.value)}),(0,n.jsx)("input",{placeholder:"Описание",value:c,onChange:e=>d(e.target.value)}),(0,n.jsx)("input",{placeholder:"Ссылка",value:u,onChange:e=>p(e.target.value)}),(0,n.jsx)("input",{type:"file",multiple:!0,accept:"image/*",onChange:e=>{if(!e.target.files)return;let t=Array.from(e.target.files).slice(0,4);g(t),console.log("Выбранные файлы:",t)}}),(0,n.jsxs)(e4,{children:[(0,n.jsx)(e1,{asChild:!0,children:(0,n.jsx)(eV.$,{variant:"outline",children:"Отмена"})}),(0,n.jsx)(eV.$,{variant:"destructive",onClick:()=>{if(!l)return void alert("Не выбрана планета");let e=new FormData;e.append("name",i),e.append("description",c),e.append("link",u),e.append("place",l),m.forEach(t=>e.append("shots",t)),console.log(m),r(e)},children:"сохранить"})]})]})})}function ts(e){let{planets:t}=e,{data:a,isPending:r}=X.yK.useSession(),[l,i]=(0,s.useState)(!1);(0,s.useEffect)(()=>{(null==a?void 0:a.user.role)==="ADMIN"?i(!0):i(!1)},[a]);let o=_(),[c,d]=(0,s.useState)(null),[p,g]=(0,s.useState)(!1),[f,v]=s.useState(null),[j,b]=s.useState(!1),w=e=>{v(e),b(!0)},y=()=>{v(null),b(!1)},N=async e=>{try{let t=await o(h(e));h.fulfilled.match(t)?(U.oR.success("Планета успешно удалена"),o(u())):U.oR.error("Ошибка при удалении планеты")}catch(e){U.oR.error("Произошла ошибка при удалении")}},C=e=>{y(),w(e)},k=e=>({id:e._id,name:e.name,ingamePosition:e.ingamePosition||"",description:e.description,left:e.left.toString(),top:e.top.toString(),size:e.size.toString(),pic:null,legion1:e.legions?e.legions[0]:void 0,legion2:e.legions?e.legions[1]:void 0}),S=e=>{d(k(e)),g(!0)},L=()=>{d(null),g(!1)},R=async(e,t)=>{try{L();let a=await o(x({updatedPlanet:e,id:t}));x.fulfilled.match(a)?(U.oR.success("Планета успешно обновлена"),o(u())):U.oR.error("Ошибка при обновлении планеты")}catch(e){U.oR.error("Произошла ошибка")}console.log("Сохранить данные:",e)},[z,E]=(0,s.useState)(!1),[P,D]=(0,s.useState)(null),I=e=>{D(e),E(!0),console.log(z)},F=()=>{D(null),E(!1),console.log(z)},M=async e=>{try{F();let t=await o(m(e));m.fulfilled.match(t)?(U.oR.success("Ивент успешно создан"),o(u())):U.oR.error("Ошибка при создании ивента")}catch(e){U.oR.error("Произошла ошибка")}};return(0,n.jsxs)(n.Fragment,{children:[t&&t.length>0?t.map((e,t)=>(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(eP,{onCreateEvent:I,ondelete:C,onclick:S,planet:e},e._id||t)})):(0,n.jsx)("div",{children:"планеты не найдены."}),l&&(0,n.jsx)(eX,{initialData:c,isOpen:p,onClose:L,onSave:R}),l&&(0,n.jsx)(e7,{planetId:f,isOpen:j,onClose:y,onDelete:N}),l&&(0,n.jsx)(tn,{isOpen:z,onClose:F,onSave:M,planetId:P})]})}function tr(e){let{legions:t}=e,{data:a,isPending:r}=X.yK.useSession(),[l,i]=(0,s.useState)(!1);(0,s.useEffect)(()=>{(null==a?void 0:a.user.role)==="ADMIN"?i(!0):i(!1)},[a]);let o=_(),[c,d]=(0,s.useState)(null),[u,p]=(0,s.useState)(!1),[m,g]=(0,s.useState)(null),[x,h]=(0,s.useState)(!1),f=e=>{g(e),h(!0)},v=()=>{g(null),h(!1)},j=async e=>{try{let t=await o(S(e));S.fulfilled.match(t)?(U.oR.success("Легион успешно удалён"),o(N())):U.oR.error("Ошибка при удалении легиона")}catch(e){U.oR.error("Произошла ошибка при удалении")}},b=e=>{v(),f(e)},w=e=>({id:e._id,name:e.name,description:e.description||"",icon:null}),y=e=>{d(w(e)),p(!0)},C=()=>{d(null),p(!1)},L=async(e,t)=>{try{C();let a=await o(k({updatedLegion:e,id:t}));k.fulfilled.match(a)?(U.oR.success("Легион успешно обновлен"),o(N())):U.oR.error("Ошибка при обновлении легиона")}catch(e){U.oR.error("Произошла ошибка")}console.log("Сохранить данные:",e)};return(0,n.jsxs)(n.Fragment,{children:[t&&t.length>0?t.map((e,t)=>(0,n.jsx)(eD,{legion:e,onclick:y,ondelete:b},e._id||t)):(0,n.jsx)("div",{children:"легионы не найдены."}),l&&(0,n.jsx)(tt,{initialData:c,isOpen:u,onClose:C,onSave:L}),l&&(0,n.jsx)(ta,{legionId:m,isOpen:x,onClose:v,onDelete:j})]})}var tl=a(7313),ti=a.n(tl);function to(e){let{setActiveTab:t,countPlanets:a=0,countLegions:s=0,activeTab:r}=e,l=e=>{null==t||t(e)};return(0,n.jsxs)("div",{className:ti().tabSwitcher,children:[(0,n.jsxs)("div",{className:"".concat(ti().tabButton," ").concat(r===tb.planets?ti().active:""),onClick:()=>l(tb.planets),children:["(",a,")"]}),(0,n.jsxs)("div",{className:"".concat(ti().tabButton," ").concat(r===tb.legions?ti().active:""),onClick:()=>l(tb.legions),children:["(",s,")"]})]})}function tc(e){let{placeholder:t="Поиск планет и легионов...",className:a="",activeTab:r,setActiveTab:l,countLegions:i=0,countPlanets:o=0}=e,c=_(),{planets:d,loading:u}=w(e=>e.reducerPlanets),{legions:p,loading:m}=w(e=>e.reducerLegions),{searchQuery:g,hasSearchQuery:x,searchResults:h}=w(e=>e.search),f=(0,s.useMemo)(()=>{if(!g.trim())return[];let e=g.toLowerCase().trim(),t=[];return d&&d.forEach(a=>{a.name.toLowerCase().includes(e)&&t.push({id:a._id,name:a.name,type:tb.planets,data:a})}),p&&p.forEach(a=>{a.name.toLowerCase().includes(e)&&t.push({id:a._id||"",name:a.name,type:tb.legions,data:a})}),t.sort((t,a)=>{let n=t.name.toLowerCase()===e,s=a.name.toLowerCase()===e;return n&&!s?-1:!n&&s?1:t.name.localeCompare(a.name)})},[g,d,p]);(0,s.useEffect)(()=>{c(eg(f))},[f,c]);let v=()=>{console.log("Поиск выполнен:",g,f)};return(0,n.jsx)("div",{className:"".concat(ti().searchContainer," ").concat(a),children:(0,n.jsxs)("div",{className:ti().searchInputWrapper,children:[(0,n.jsx)("input",{type:"text",value:g,onChange:e=>{c(em(e.target.value))},onKeyPress:e=>{"Enter"===e.key&&v()},placeholder:t,className:ti().searchInput}),x&&!(u||m)&&(0,n.jsxs)("div",{className:ti().resultsCounter,children:["Найдено:",h.length]}),(0,n.jsx)(to,{setActiveTab:l,countLegions:i,countPlanets:o,activeTab:r})]})})}var td=a(888);function tu(e){let{className:t,...a}=e;return(0,n.jsx)(td.bL,{"data-slot":"tabs",className:(0,eF.cn)("flex flex-col gap-2",t),...a})}function tp(e){let{className:t,...a}=e;return(0,n.jsx)(td.B8,{"data-slot":"tabs-list",className:(0,eF.cn)("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",t),...a})}function tm(e){let{className:t,...a}=e;return(0,n.jsx)(td.l9,{"data-slot":"tabs-trigger",className:(0,eF.cn)("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...a})}function tg(e){let{className:t,...a}=e;return(0,n.jsx)(td.UC,{"data-slot":"tabs-content",className:(0,eF.cn)("flex-1 outline-none",t),...a})}let tx={name:"планета",ingamePosition:"в-0000",description:"алипов, пере .ю ю .,пщкенгукшцуп.щывсбчпи,ьсмтиттмьсд",left:"1000",top:"1000",size:"100",pic:null},th={name:"легион",description:"апапрвпа цукенгшщ мпирто мить дж ыва ывакеп вапе мит ю",icon:null};function tf(){let e=_(),[t,a]=(0,s.useState)(!1),r=async t=>{try{let n=await e(p(t));p.fulfilled.match(n)?(U.oR.success("Планета успешно создана"),e(u()),a(!1)):U.oR.error("Ошибка при создании планеты")}catch(e){U.oR.error("Произошла ошибка сервера при создании ")}},l=async t=>{try{let n=await e(C(t));C.fulfilled.match(n)?(U.oR.success("Ордос успешно создана"),e(N()),a(!1)):U.oR.error("Ошибка при создании ордоса")}catch(e){U.oR.error("Произошла ошибка сервера при создании ")}};return(0,n.jsxs)(eM,{open:t,onOpenChange:a,children:[(0,n.jsx)(eA,{className:" bg-[url('/assets/tablet/buttons/adding_button.png')] bg-contain bg-center bg-no-repeat  w-[3.5vw] h-full custom-width"}),(0,n.jsxs)(eW,{className:"flex flex-col h-full",children:[(0,n.jsxs)(eH,{children:[(0,n.jsx)(eK,{children:"Создать объект"}),(0,n.jsx)(eq,{children:"Выберите тип объекта и заполните форму"})]}),(0,n.jsx)("div",{className:"flex-1 min-h-0",children:(0,n.jsxs)(tu,{defaultValue:"legion",className:"flex h-full",children:[(0,n.jsxs)(tp,{className:"flex flex-col ",children:[(0,n.jsx)(tm,{value:"planet",className:"text-left",children:"Планета"}),(0,n.jsx)(tm,{value:"legion",className:"text-left",children:"Ордос"})]}),(0,n.jsxs)("div",{className:"flex-1 flex justify-center items-start overflow-y-auto p-6 min-h-0",children:[(0,n.jsx)(tg,{value:"planet",className:"w-full  max-w-xl",children:(0,n.jsx)(eY,{initialValues:tx,onSubmit:r})}),(0,n.jsx)(tg,{value:"legion",className:"w-full max-w-xl",children:(0,n.jsx)(te,{initialValues:th,onSubmit:l})})]})]})}),(0,n.jsx)(eJ,{className:"flex-shrink-0",children:(0,n.jsx)(eB,{asChild:!0,children:(0,n.jsx)(eV.$,{children:"Закрыть"})})})]})]})}function tv(){let e=(0,ek.useRouter)(),[t,a]=(0,s.useState)(!1),r=async()=>{if(!t){a(!0);try{await X.yK.signOut(),e.push("/login")}catch(e){a(!1)}}};return(0,n.jsx)("div",{className:"h-full w-[3.5vw] bg-[url('/assets/tablet/buttons/logout.png')] bg-contain bg-center bg-no-repeat flex justify-center align-center custom-width ",children:(0,n.jsx)("button",{className:"w-full",onClick:r,disabled:t})})}function tj(e){let{activeTab:t,setActiveTab:a,countPlanets:r,countLegions:l}=e,{data:i,isPending:o}=X.yK.useSession(),[c,d]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{(null==i?void 0:i.user.role)==="ADMIN"?d(!0):d(!1)},[i]),(0,n.jsxs)("div",{className:eE().tabletControls,children:[(0,n.jsx)(tc,{placeholder:"Поиск...",activeTab:t,setActiveTab:a,countPlanets:r,countLegions:l}),c&&(0,n.jsx)("div",{className:"right-0 z-10",children:(0,n.jsx)(tf,{})}),i&&(0,n.jsx)("div",{className:"right-0 z-10",children:(0,n.jsx)(tv,{})})]})}var tb=function(e){return e.planets="planets",e.legions="legions",e}({});function t_(){var e,t,a,r,l,i;let[o,c]=(0,s.useState)("planets"),{searchQuery:d,hasSearchQuery:u,searchResults:p}=w(e=>e.search),{planets:m}=w(e=>e.reducerPlanets),{legions:g}=w(e=>e.reducerLegions),[x,h]=(0,s.useState)({planets:[],legions:[]});return(0,s.useEffect)(()=>{if(u&&p.length>0){let e=[],t=[];p.forEach(a=>{"planets"===a.type&&a.data?e.push(a.data):"legions"===a.type&&a.data&&t.push(a.data)}),h({planets:e.length>0?e:null,legions:t.length>0?t:null})}},[d,u,p]),(0,n.jsx)("div",{className:eE().mainTablet,children:(0,n.jsxs)("div",{className:eE().wrapper,children:[(0,n.jsx)(tj,{activeTab:o,setActiveTab:c,countPlanets:u?null!=(a=null==(e=x.planets)?void 0:e.length)?a:0:null!=(r=null==m?void 0:m.length)?r:0,countLegions:u?null!=(l=null==(t=x.legions)?void 0:t.length)?l:0:null!=(i=null==g?void 0:g.length)?i:0}),(0,n.jsxs)("div",{className:eE().listWrapper,children:[u&&(0,n.jsxs)(n.Fragment,{children:["planets"==o&&(0,n.jsx)(n.Fragment,{children:x.planets&&x.planets.length>0?(0,n.jsx)(ts,{planets:x.planets}):(0,n.jsx)("div",{className:eE().noResults,children:(0,n.jsx)("p",{children:"Планеты не найдены"})})}),"legions"==o&&(0,n.jsx)(n.Fragment,{children:x.legions&&x.legions.length>0?(0,n.jsx)(tr,{legions:x.legions}):(0,n.jsx)("div",{className:eE().noResults,children:(0,n.jsx)("p",{children:"Легионы не найдены"})})})]}),"planets"==o&&!d&&(0,n.jsx)(ts,{planets:m}),"legions"==o&&!d&&(0,n.jsx)(tr,{legions:g})]})]})})}var tw=function(e){return e.map="map",e.dashboard="dashboard",e}(tw||{});function ty(){let[e,t]=(0,s.useState)("map");return(0,n.jsxs)("div",{className:"outer-container",children:[(0,n.jsx)(ed,{}),(0,n.jsx)(ey,{children:(0,n.jsx)(D,{children:(0,n.jsxs)("div",{className:"inner-container",children:[(0,n.jsxs)("div",{className:"squire-area",children:[(0,n.jsx)("div",{className:" flex absolute top-1 left-4 z-index-10",children:(0,n.jsx)(eR,{currentBlock:e,setCurrentBlock:t})}),"map"==e&&(0,n.jsx)(W,{}),"dashboard"==e&&(0,n.jsx)(t_,{})]}),(0,n.jsx)("div",{className:"rectangular-area",children:(0,n.jsx)(es,{})})]})})})]})}},939:(e,t,a)=>{"use strict";a.d(t,{j:()=>s});var n=a(2115);let s=e=>{let t=(0,n.useRef)(null);return(0,n.useEffect)(()=>{function a(a){t.current&&!t.current.contains(a.target)&&e()}return document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[e]),t}},1110:e=>{e.exports={scrollWrapper:"scrolable_scrollWrapper__RtAwC",descriptionTitle:"scrolable_descriptionTitle__Wjgk4",eventTitle:"scrolable_eventTitle__cp1Am",border:"scrolable_border__wQ6Fx",link:"scrolable_link__GIHou",planet:"scrolable_planet__We9V6",description:"scrolable_description__YqaA7",event:"scrolable_event__jN96E",noData:"scrolable_noData__Po_y2"}},2513:e=>{e.exports={menuContainer:"burgerMenu_menuContainer__4Fa9Q",menuButton:"burgerMenu_menuButton__gLkqv",wrapper:"burgerMenu_wrapper__G2fhK",menuContent:"burgerMenu_menuContent__lbd0c",menuContentActive:"burgerMenu_menuContentActive__zFs13",menuLink:"burgerMenu_menuLink__QR3AI",homeLink:"burgerMenu_homeLink__MRnms",searchLink:"burgerMenu_searchLink__ddOd3",borderLink:"burgerMenu_borderLink___n68n",adminLink:"burgerMenu_adminLink__K8r2L"}},2525:e=>{e.exports={"viewer-container":"map_viewer-container__VRReZ","space-map":"map_space-map__wFTxq","zoom-level":"map_zoom-level__qH6FE"}},2714:(e,t,a)=>{"use strict";a.d(t,{J:()=>l});var n=a(5155);a(2115);var s=a(968),r=a(3999);function l(e){let{className:t,...a}=e;return(0,n.jsx)(s.b,{"data-slot":"label",className:(0,r.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...a})}},2760:(e,t,a)=>{"use strict";a.d(t,{yK:()=>r});var n=a(9366),s=a(2063);let r=(0,n.MB)({plugins:[(0,s.Zn)(),(0,s.px)()]})},3999:(e,t,a)=>{"use strict";a.d(t,{cn:()=>r});var n=a(2596),s=a(9688);function r(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.QP)((0,n.$)(t))}},4313:e=>{e.exports={planet:"planet_planet__a9kGU","planet-icon":"planet_planet-icon__MApbN","planet-label":"planet_planet-label__QKxlA",wrapper:"planet_wrapper__wAfBV",one:"planet_one__T10A0",two:"planet_two__jtxru"}},4778:e=>{e.exports={container:"borders_container__Dig67",border:"borders_border__W_iWX",hidden:"borders_hidden__xF_0G",segment:"borders_segment__keFSG","container-solar":"borders_container-solar__P7Du2","container-obscurus":"borders_container-obscurus__fl29I","container-pacificus":"borders_container-pacificus__7NNPV","container-tempestus":"borders_container-tempestus__1JZMO","container-ultima":"borders_container-ultima__Pv_r_"}},5754:e=>{e.exports={upperMenu:"upperMenu_upperMenu__5PUpB"}},6231:e=>{e.exports={upperInfo:"upperInfo_upperInfo__j6URX",title:"upperInfo_title__fiClH",name:"upperInfo_name__klcbc",nameLegion:"upperInfo_nameLegion__cIKKF",ingamePosition:"upperInfo_ingamePosition__VVQpq",ingamePositionLegion:"upperInfo_ingamePositionLegion__Ubaie",iconWrapper:"upperInfo_iconWrapper__a_DdK",icon:"upperInfo_icon__E8pB9",imageContainer:"upperInfo_imageContainer__1ExkZ",imageWrapper:"upperInfo_imageWrapper__F7EYh",imageLabel:"upperInfo_imageLabel__RyRLm"}},6672:e=>{e.exports={marquee:"RunningMarquee_marquee__DBbXo",track:"RunningMarquee_track__TIicZ",scrollLeft:"RunningMarquee_scrollLeft__YRVzi",text:"RunningMarquee_text__JQMJm"}},7168:(e,t,a)=>{"use strict";a.d(t,{$:()=>o});var n=a(5155);a(2115);var s=a(9708),r=a(2085),l=a(3999);let i=(0,r.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function o(e){let{className:t,variant:a,size:r,asChild:o=!1,...c}=e,d=o?s.DX:"button";return(0,n.jsx)(d,{"data-slot":"button",className:(0,l.cn)(i({variant:a,size:r,className:t})),...c})}},7313:e=>{e.exports={searchContainer:"searchLine_searchContainer__HQ0YH",searchInputWrapper:"searchLine_searchInputWrapper__ofT3X",searchInput:"searchLine_searchInput__E7eOj",tabSwitcher:"searchLine_tabSwitcher__w8mPv",tabButton:"searchLine_tabButton__0YoFt",active:"searchLine_active__oT4zx",resultsCounter:"searchLine_resultsCounter__g4Mlq"}},8271:e=>{e.exports={infoSidebar:"infoSidebar_infoSidebar__wDWJT"}},9446:(e,t,a)=>{Promise.resolve().then(a.bind(a,700))},9852:(e,t,a)=>{"use strict";a.d(t,{p:()=>r});var n=a(5155);a(2115);var s=a(3999);function r(e){let{className:t,type:a,...r}=e;return(0,n.jsx)("input",{type:a,"data-slot":"input",className:(0,s.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...r})}}},e=>{var t=t=>e(e.s=t);e.O(0,[78,671,88,612,441,684,358],()=>t(9446)),_N_E=e.O()}]);