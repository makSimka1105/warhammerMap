(()=>{var e={};e.id=302,e.ids=[302],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1098:()=>{throw Error("Module build failed (from ./node_modules/next/dist/build/webpack/loaders/next-swc-loader.js):\nError:   \x1b[31mx\x1b[0m Expected ',', got ')'\n    ,-[\x1b[36;1;4m/home/maksibon/map-app/warhammerMap/client/lib/auth.ts\x1b[0m:74:1]\n \x1b[2m71\x1b[0m |             adminRoles: [\"ADMIN\"],\n \x1b[2m72\x1b[0m |         }),\n \x1b[2m73\x1b[0m |     ],\n \x1b[2m74\x1b[0m | });\n    : \x1b[35;1m ^\x1b[0m\n    `----\n\n\nCaused by:\n    Syntax Error")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5395:(e,t,r)=>{"use strict";r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{patchFetch:()=>l,routeModule:()=>d,serverHooks:()=>f,workAsyncStorage:()=>u,workUnitAsyncStorage:()=>p});var o=r(6559),i=r(8088),s=r(7719),a=r(7867),c=e([a]);a=(c.then?(await c)():c)[0];let d=new o.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/auth/[...all]/route",pathname:"/api/auth/[...all]",filename:"route",bundlePath:"app/api/auth/[...all]/route"},resolvedPagePath:"/home/maksibon/map-app/warhammerMap/client/app/api/auth/[...all]/route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:u,workUnitAsyncStorage:p,serverHooks:f}=d;function l(){return(0,s.patchFetch)({workAsyncStorage:u,workUnitAsyncStorage:p})}n()}catch(e){n(e)}})},5877:(e,t,r)=>{"use strict";let n;r.d(t,{O:()=>aS});let o=Object.create(null),i=e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?o:globalThis);new Proxy(o,{get:(e,t)=>i()[t]??o[t],has:(e,t)=>t in i()||t in o,set:(e,t,r)=>(i(!0)[t]=r,!0),deleteProperty(e,t){if(!t)return!1;let r=i(!0);return delete r[t],!0},ownKeys:()=>Object.keys(i(!0))});let s="undefined"!=typeof process&&process.env&&"production"||"",a="dev"===s||"development"===s;function c(e){return e?"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}function l(e,t,r){let n="",o=0,i=0;for(let r of e)for(o=o<<8|r,i+=8;i>=6;)i-=6,n+=t[o>>i&63];if(i>0&&(n+=t[o<<6-i&63]),r){let e=(4-n.length%4)%4;n+="=".repeat(e)}return n}function d(e,t){let r=new Map;for(let e=0;e<t.length;e++)r.set(t[e],e);let n=[],o=0,i=0;for(let t of e){if("="===t)break;let e=r.get(t);if(void 0===e)throw Error(`Invalid Base64 character: ${t}`);o=o<<6|e,(i+=6)>=8&&(i-=8,n.push(o>>i&255))}return Uint8Array.from(n)}let u={encode(e,t={}){let r=c(!1);return l("string"==typeof e?new TextEncoder().encode(e):new Uint8Array(e),r,t.padding??!0)},decode(e){"string"!=typeof e&&(e=new TextDecoder().decode(e));let t=c(e.includes("-")||e.includes("_"));return d(e,t)}},p={encode(e,t={}){let r=c(!0);return l("string"==typeof e?new TextEncoder().encode(e):new Uint8Array(e),r,t.padding??!0)},decode(e){let t=c(e.includes("-")||e.includes("_"));return d(e,t)}},f=require("node:crypto");var h,m,y=r.t(f,2);let g=f.webcrypto?.subtle||{},w=e=>f.webcrypto.getRandomValues(e),b={encode:e=>{if("string"==typeof e&&(e=new TextEncoder().encode(e)),0===e.byteLength)return"";let t=new Uint8Array(e),r="";for(let e of t)r+=e.toString(16).padStart(2,"0");return r},decode:e=>{if(!e)return"";if("string"==typeof e){if(e.length%2!=0||!RegExp("^[0123456789abcdef]+$").test(e))throw Error("Invalid hexadecimal string");let t=new Uint8Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=parseInt(e.slice(r,r+2),16);return new TextDecoder().decode(t)}return new TextDecoder().decode(e)}},v=(e="SHA-256",t="none")=>{let r={importKey:async(t,r)=>g.importKey("raw","string"==typeof t?new TextEncoder().encode(t):t,{name:"HMAC",hash:{name:e}},!1,[r]),sign:async(e,n)=>{"string"==typeof e&&(e=await r.importKey(e,"sign"));let o=await g.sign("HMAC",e,"string"==typeof n?new TextEncoder().encode(n):n);return"hex"===t?b.encode(o):"base64"===t||"base64url"===t||"base64urlnopad"===t?p.encode(o,{padding:"base64urlnopad"!==t}):o},verify:async(e,n,o)=>("string"==typeof e&&(e=await r.importKey(e,"verify")),"hex"===t&&(o=b.decode(o)),("base64"===t||"base64url"===t||"base64urlnopad"===t)&&(o=await u.decode(o)),g.verify("HMAC",e,"string"==typeof o?new TextEncoder().encode(o):o,"string"==typeof n?new TextEncoder().encode(n):n))};return r},_=new Map,E={decode:(e,t="utf-8")=>(_.has(t)||_.set(t,new TextDecoder(t)),_.get(t).decode(e)),encode:new TextEncoder().encode};class k extends Error{constructor(e,t){super(e),this.name="BetterAuthError",this.message=e,this.cause=t,this.stack=""}}let A=(e,t="ms")=>new Date(Date.now()+("sec"===t?1e3*e:e));function T(e){try{return new URL(e).origin}catch(e){return null}}function x(e){try{return new URL(e).protocol}catch(e){return null}}function S(e){try{return new URL(e).host}catch(t){return e}}let R=(e,t)=>{let r={t:`${e}${t}`,value:e,tFormat:t,toMilliseconds:()=>{switch(t){case"ms":return e;case"s":return 1e3*e;case"m":return 1e3*e*60;case"h":return 1e3*e*3600;case"d":return 1e3*e*86400;case"w":return 1e3*e*604800;case"y":return 1e3*e*31536e3}},toSeconds:()=>r.toMilliseconds()/1e3,toMinutes:()=>r.toSeconds()/60,toHours:()=>r.toMinutes()/60,toDays:()=>r.toHours()/24,toWeeks:()=>r.toDays()/7,toYears:()=>r.toDays()/365,getDate:()=>new Date(Date.now()+r.toMilliseconds()),add:e=>{let t="string"==typeof e?I(e).toMilliseconds():e.toMilliseconds();return R(r.toMilliseconds()+t,"ms")},subtract:e=>{let t="string"==typeof e?I(e).toMilliseconds():e.toMilliseconds();return R(r.toMilliseconds()-t,"ms")},multiply:e=>R(r.toMilliseconds()*e,"ms"),divide:e=>R(r.toMilliseconds()/e,"ms"),equals:e=>{let t="string"==typeof e?I(e).toMilliseconds():e.toMilliseconds();return r.toMilliseconds()===t},lessThan:e=>{let t="string"==typeof e?I(e).toMilliseconds():e.toMilliseconds();return r.toMilliseconds()<t},greaterThan:e=>{let t="string"==typeof e?I(e).toMilliseconds():e.toMilliseconds();return r.toMilliseconds()>t},format:e=>{let t=r.getDate();return e.replace(/YYYY|MM|DD|HH|mm|ss/g,e=>{switch(e){case"YYYY":return t.getFullYear().toString();case"MM":return(t.getMonth()+1).toString().padStart(2,"0");case"DD":return t.getDate().toString().padStart(2,"0");case"HH":return t.getHours().toString().padStart(2,"0");case"mm":return t.getMinutes().toString().padStart(2,"0");case"ss":return t.getSeconds().toString().padStart(2,"0");default:return e}})},fromNow:()=>{let e=r.toMilliseconds();return e<0?r.ago():e<1e3?"in a few seconds":e<6e4?`in ${Math.round(e/1e3)} seconds`:e<36e5?`in ${Math.round(e/6e4)} minutes`:e<864e5?`in ${Math.round(e/36e5)} hours`:e<6048e5?`in ${Math.round(e/864e5)} days`:e<26298e5?`in ${Math.round(e/6048e5)} weeks`:e<315576e5?`in ${Math.round(e/26298e5)} months`:`in ${Math.round(e/315576e5)} years`},ago:()=>{let e=-r.toMilliseconds();return e<0?r.fromNow():e<1e3?"a few seconds ago":e<6e4?`${Math.round(e/1e3)} seconds ago`:e<36e5?`${Math.round(e/6e4)} minutes ago`:e<864e5?`${Math.round(e/36e5)} hours ago`:e<6048e5?`${Math.round(e/864e5)} days ago`:e<26298e5?`${Math.round(e/6048e5)} weeks ago`:e<315576e5?`${Math.round(e/26298e5)} months ago`:`${Math.round(e/315576e5)} years ago`}};return r},I=e=>{let t=e.match(/^(\d+)(ms|s|m|h|d|w|y)$/);if(!t)throw Error("Invalid time format");return R(parseInt(t[1]),t[2])};async function O(e,t){if(e.context.options.session?.cookieCache?.enabled){let r={session:Object.entries(t.session).reduce((t,[r,n])=>{let o=e.context.options.session?.additionalFields?.[r];return o&&!1===o.returned||(t[r]=n),t},{}),user:t.user},n=A(e.context.authCookies.sessionData.options.maxAge||60,"sec").getTime(),o=p.encode(JSON.stringify({session:r,expiresAt:n,signature:await v("SHA-256","base64urlnopad").sign(e.context.secret,JSON.stringify({...r,expiresAt:n}))}),{padding:!1});if(o.length>4093)throw new k("Session data is too large to store in the cookie. Please disable session cookie caching or reduce the size of the session data");e.setCookie(e.context.authCookies.sessionData.name,o,e.context.authCookies.sessionData.options)}}async function U(e,t,r,n){let o=await e.getSignedCookie(e.context.authCookies.dontRememberToken.name,e.context.secret);r=void 0!==r?r:!!o;let i=e.context.authCookies.sessionToken.options,s=r?void 0:e.context.sessionConfig.expiresIn;await e.setSignedCookie(e.context.authCookies.sessionToken.name,t.session.token,e.context.secret,{...i,maxAge:s,...n}),r&&await e.setSignedCookie(e.context.authCookies.dontRememberToken.name,"true",e.context.secret,e.context.authCookies.dontRememberToken.options),await O(e,t),e.context.setNewSession(t),e.context.options.secondaryStorage&&await e.context.secondaryStorage?.set(t.session.token,JSON.stringify({user:t.user,session:t.session}),Math.floor((new Date(t.session.expiresAt).getTime()-Date.now())/1e3))}function N(e,t){e.setCookie(e.context.authCookies.sessionToken.name,"",{...e.context.authCookies.sessionToken.options,maxAge:0}),e.setCookie(e.context.authCookies.sessionData.name,"",{...e.context.authCookies.sessionData.options,maxAge:0}),t||e.setCookie(e.context.authCookies.dontRememberToken.name,"",{...e.context.authCookies.dontRememberToken.options,maxAge:0})}var P=Object.defineProperty,D={OK:200,CREATED:201,ACCEPTED:202,NO_CONTENT:204,MULTIPLE_CHOICES:300,MOVED_PERMANENTLY:301,FOUND:302,SEE_OTHER:303,NOT_MODIFIED:304,TEMPORARY_REDIRECT:307,BAD_REQUEST:400,UNAUTHORIZED:401,PAYMENT_REQUIRED:402,FORBIDDEN:403,NOT_FOUND:404,METHOD_NOT_ALLOWED:405,NOT_ACCEPTABLE:406,PROXY_AUTHENTICATION_REQUIRED:407,REQUEST_TIMEOUT:408,CONFLICT:409,GONE:410,LENGTH_REQUIRED:411,PRECONDITION_FAILED:412,PAYLOAD_TOO_LARGE:413,URI_TOO_LONG:414,UNSUPPORTED_MEDIA_TYPE:415,RANGE_NOT_SATISFIABLE:416,EXPECTATION_FAILED:417,"I'M_A_TEAPOT":418,MISDIRECTED_REQUEST:421,UNPROCESSABLE_ENTITY:422,LOCKED:423,FAILED_DEPENDENCY:424,TOO_EARLY:425,UPGRADE_REQUIRED:426,PRECONDITION_REQUIRED:428,TOO_MANY_REQUESTS:429,REQUEST_HEADER_FIELDS_TOO_LARGE:431,UNAVAILABLE_FOR_LEGAL_REASONS:451,INTERNAL_SERVER_ERROR:500,NOT_IMPLEMENTED:501,BAD_GATEWAY:502,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504,HTTP_VERSION_NOT_SUPPORTED:505,VARIANT_ALSO_NEGOTIATES:506,INSUFFICIENT_STORAGE:507,LOOP_DETECTED:508,NOT_EXTENDED:510,NETWORK_AUTHENTICATION_REQUIRED:511},$=class extends Error{constructor(e="INTERNAL_SERVER_ERROR",t,r={},n="number"==typeof e?e:D[e]){super(t?.message),this.status=e,this.body=t,this.headers=r,this.statusCode=n,this.name="APIError",this.status=e,this.headers=r,this.statusCode=n,this.body=t?{code:t?.message?.toUpperCase().replace(/ /g,"_").replace(/[^A-Z0-9_]/g,""),...t}:void 0,this.stack=""}};function z(e){return e instanceof $||e?.name==="APIError"}async function j(e,t={}){let r={body:t.body,query:t.query};if(e.body){let n=await e.body["~standard"].validate(t.body);if(n.issues)return{data:null,error:L(n.issues,"body")};r.body=n.value}if(e.query){let n=await e.query["~standard"].validate(t.query);if(n.issues)return{data:null,error:L(n.issues,"query")};r.query=n.value}return e.requireHeaders&&!t.headers?{data:null,error:{message:"Headers is required"}}:e.requireRequest&&!t.request?{data:null,error:{message:"Request is required"}}:{data:r,error:null}}function L(e,t){let r=[];for(let t of e){let e=t.message;r.push(e)}return{message:`Invalid ${t} parameters`}}var C={name:"HMAC",hash:"SHA-256"},V=async e=>{let t="string"==typeof e?new TextEncoder().encode(e):e;return await g.importKey("raw",t,C,!1,["sign","verify"])},q=async(e,t,r)=>{try{let n=atob(e),o=new Uint8Array(n.length);for(let e=0,t=n.length;e<t;e++)o[e]=n.charCodeAt(e);return await g.verify(C,r,o,new TextEncoder().encode(t))}catch(e){return!1}},M=async(e,t)=>{let r=await V(t);return btoa(String.fromCharCode(...new Uint8Array(await g.sign(C.name,r,new TextEncoder().encode(e)))))},Z=async(e,t)=>{let r=await M(e,t);return e=encodeURIComponent(e=`${e}.${r}`)},H=(e,t)=>{let r=e;if(t)if("secure"===t)r="__Secure-"+e;else{if("host"!==t)return;r="__Host-"+e}return r},F=(e,t,r={})=>{let n;if(n=r?.prefix==="secure"?`__Secure-${e}=${t}`:r?.prefix==="host"?`__Host-${e}=${t}`:`${e}=${t}`,e.startsWith("__Secure-")&&!r.secure&&(r.secure=!0),e.startsWith("__Host-")&&(r.secure||(r.secure=!0),"/"!==r.path&&(r.path="/"),r.domain&&(r.domain=void 0)),r&&"number"==typeof r.maxAge&&r.maxAge>=0){if(r.maxAge>3456e4)throw Error("Cookies Max-Age SHOULD NOT be greater than 400 days (34560000 seconds) in duration.");n+=`; Max-Age=${Math.floor(r.maxAge)}`}if(r.domain&&"host"!==r.prefix&&(n+=`; Domain=${r.domain}`),r.path&&(n+=`; Path=${r.path}`),r.expires){if(r.expires.getTime()-Date.now()>3456e7)throw Error("Cookies Expires SHOULD NOT be greater than 400 days (34560000 seconds) in the future.");n+=`; Expires=${r.expires.toUTCString()}`}return r.httpOnly&&(n+="; HttpOnly"),r.secure&&(n+="; Secure"),r.sameSite&&(n+=`; SameSite=${r.sameSite.charAt(0).toUpperCase()+r.sameSite.slice(1)}`),r.partitioned&&(r.secure||(r.secure=!0),n+="; Partitioned"),n},K=(e,t,r)=>F(e,t=encodeURIComponent(t),r),W=async(e,t,r,n)=>F(e,t=await Z(t,r),n),B=async(e,{options:t,path:r})=>{let n=new Headers,{data:o,error:i}=await j(t,e);if(i)throw new $(400,{message:i.message,code:"VALIDATION_ERROR"});let s="headers"in e?e.headers instanceof Headers?e.headers:new Headers(e.headers):"request"in e&&e.request instanceof Request?e.request.headers:null,a=s?.get("cookie"),c=a?function(e){if("string"!=typeof e)throw TypeError("argument str must be a string");let t=new Map,r=0;for(;r<e.length;){let n=e.indexOf("=",r);if(-1===n)break;let o=e.indexOf(";",r);if(-1===o)o=e.length;else if(o<n){r=e.lastIndexOf(";",n-1)+1;continue}let i=e.slice(r,n).trim();if(!t.has(i)){let r=e.slice(n+1,o).trim();34===r.codePointAt(0)&&(r=r.slice(1,-1)),t.set(i,function(e){try{return e.includes("%")?decodeURIComponent(e):e}catch{return e}}(r))}r=o+1}return t}(a):void 0,l={...e,body:o.body,query:o.query,path:e.path||r,context:"context"in e&&e.context?e.context:{},returned:void 0,headers:e?.headers,request:e?.request,params:"params"in e?e.params:void 0,method:e.method,setHeader:(e,t)=>{n.set(e,t)},getHeader:e=>s?s.get(e):null,getCookie:(e,t)=>{let r=H(e,t);return r&&c?.get(r)||null},getSignedCookie:async(e,t,r)=>{let n=H(e,r);if(!n)return null;let o=c?.get(n);if(!o)return null;let i=o.lastIndexOf(".");if(i<1)return null;let s=o.substring(0,i),a=o.substring(i+1);if(44!==a.length||!a.endsWith("="))return null;let l=await V(t);return!!await q(a,s,l)&&s},setCookie:(e,t,r)=>{let o=K(e,t,r);return n.append("set-cookie",o),o},setSignedCookie:async(e,t,r,o)=>{let i=await W(e,t,r,o);return n.append("set-cookie",i),i},redirect:e=>(n.set("location",e),new $("FOUND",void 0,n)),error:(e,t,r)=>new $(e,t,r),json:(t,r)=>e.asResponse?{body:r?.body||t,routerResponse:r,_flag:"json"}:t,responseHeaders:n};for(let e of t.use||[]){let t=await e({...l,returnHeaders:!0,asResponse:!1});t.response&&Object.assign(l.context,t.response),t.headers&&t.headers.forEach((e,t)=>{l.responseHeaders.set(t,e)})}return l};function J(e,t){let r=async r=>{let n="function"==typeof e?e:t,o=await B(r,{options:"function"==typeof e?{}:e,path:"/"});if(!n)throw Error("handler must be defined");let i=await n(o),s=o.responseHeaders;return r.returnHeaders?{headers:s,response:i}:i};return r.options="function"==typeof e?{}:e,r}J.create=e=>function(t,r){if("function"==typeof t)return J({use:e?.use},t);if(!r)throw Error("Middleware handler is required");return J({...t,method:"*",use:[...e?.use||[],...t.use||[]]},r)};var G=(e,t,r)=>{let n=async(...n)=>{let o=n[0]||{},i=await B(o,{options:t,path:e}),s=await r(i).catch(async e=>{if(z(e)){let r=t.onAPIError;if(r&&await r(e),o.asResponse)return e}throw e}),a=i.responseHeaders;return o.asResponse?function e(t,r){if(t instanceof Response)return r?.headers instanceof Headers&&r.headers.forEach((e,r)=>{t.headers.set(r,e)}),t;if(t&&"object"==typeof t&&"_flag"in t&&"json"===t._flag){let e=t.body,n=t.routerResponse;if(n instanceof Response)return n;let o=new Headers({...n?.headers,...t.headers,...r?.headers,"Content-Type":"application/json"});return new Response(JSON.stringify(e),{...n,headers:o,status:t.status??r?.status??n?.status,statusText:r?.statusText??n?.statusText})}if(z(t))return e(t.body,{status:r?.status??t.statusCode,statusText:t.status.toString(),headers:r?.headers||t.headers});let n=t,o=new Headers(r?.headers);return t?"string"==typeof t?(n=t,o.set("Content-Type","text/plain")):t instanceof ArrayBuffer||ArrayBuffer.isView(t)?(n=t,o.set("Content-Type","application/octet-stream")):t instanceof Blob?(n=t,o.set("Content-Type",t.type||"application/octet-stream")):t instanceof FormData?n=t:t instanceof URLSearchParams?(n=t,o.set("Content-Type","application/x-www-form-urlencoded")):t instanceof ReadableStream?(n=t,o.set("Content-Type","application/octet-stream")):function(e){if(void 0===e)return!1;let t=typeof e;return"string"===t||"number"===t||"boolean"===t||null===t||"object"===t&&(!!Array.isArray(e)||!e.buffer&&(e.constructor&&"Object"===e.constructor.name||"function"==typeof e.toJSON))}(t)&&(n=function(e,t,r){let n=0,o=new WeakMap;return JSON.stringify(e,(e,t)=>{if("bigint"==typeof t)return t.toString();if("object"==typeof t&&null!==t){if(o.has(t))return`[Circular ref-${o.get(t)}]`;o.set(t,n++)}return t},void 0)}(t),o.set("Content-Type","application/json")):(null===t&&(n=JSON.stringify(null)),o.set("content-type","application/json")),new Response(n,{...r,headers:o})}(s,{headers:a}):o.returnHeaders?{headers:a,response:s}:s};return n.options=t,n.path=e,n};function Q(e,t,r){function n(r,n){var o;for(let i in Object.defineProperty(r,"_zod",{value:r._zod??{},enumerable:!1}),(o=r._zod).traits??(o.traits=new Set),r._zod.traits.add(e),t(r,n),s.prototype)i in r||Object.defineProperty(r,i,{value:s.prototype[i].bind(r)});r._zod.constr=s,r._zod.def=n}let o=r?.Parent??Object;class i extends o{}function s(e){var t;let o=r?.Parent?new i:this;for(let r of(n(o,e),(t=o._zod).deferred??(t.deferred=[]),o._zod.deferred))r();return o}return Object.defineProperty(i,"name",{value:e}),Object.defineProperty(s,"init",{value:n}),Object.defineProperty(s,Symbol.hasInstance,{value:t=>!!r?.Parent&&t instanceof r.Parent||t?._zod?.traits?.has(e)}),Object.defineProperty(s,"name",{value:e}),s}G.create=e=>(t,r,n)=>G(t,{...r,use:[...r?.use||[],...e?.use||[]]},n),Object.freeze({status:"aborted"}),Symbol("zod_brand");var Y={};function X(e){return e}function ee(e){return e}function et(e){}function er(e){throw Error()}function en(e){}function eo(e){let t=Object.values(e).filter(e=>"number"==typeof e);return Object.entries(e).filter(([e,r])=>-1===t.indexOf(+e)).map(([e,t])=>t)}function ei(e,t="|"){return e.map(e=>eI(e)).join(t)}function es(e,t){return"bigint"==typeof t?t.toString():t}function ea(e){return{get value(){{let t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function ec(e){return null==e}function el(e){let t=+!!e.startsWith("^"),r=e.endsWith("$")?e.length-1:e.length;return e.slice(t,r)}function ed(e,t){let r=(e.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,o=r>n?r:n;return Number.parseInt(e.toFixed(o).replace(".",""))%Number.parseInt(t.toFixed(o).replace(".",""))/10**o}function eu(e,t,r){Object.defineProperty(e,t,{get(){{let n=r();return e[t]=n,n}},set(r){Object.defineProperty(e,t,{value:r})},configurable:!0})}function ep(e,t,r){Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0})}function ef(e,t){return t?t.reduce((e,t)=>e?.[t],e):e}function eh(e){let t=Object.keys(e);return Promise.all(t.map(t=>e[t])).then(e=>{let r={};for(let n=0;n<t.length;n++)r[t[n]]=e[n];return r})}function em(e=10){let t="abcdefghijklmnopqrstuvwxyz",r="";for(let n=0;n<e;n++)r+=t[Math.floor(Math.random()*t.length)];return r}function ey(e){return JSON.stringify(e)}((e,t)=>{for(var r in t)P(e,r,{get:t[r],enumerable:!0})})({},{BIGINT_FORMAT_RANGES:()=>eN,Class:()=>eW,NUMBER_FORMAT_RANGES:()=>eU,aborted:()=>eC,allowsEval:()=>eb,assert:()=>en,assertEqual:()=>X,assertIs:()=>et,assertNever:()=>er,assertNotEqual:()=>ee,assignProp:()=>ep,cached:()=>ea,captureStackTrace:()=>eg,cleanEnum:()=>eK,cleanRegex:()=>el,clone:()=>ex,createTransparentProxy:()=>eR,defineLazy:()=>eu,esc:()=>ey,escapeRegex:()=>eT,extend:()=>e$,finalizeIssue:()=>eM,floatSafeRemainder:()=>ed,getElementAtPath:()=>ef,getEnumValues:()=>eo,getLengthableOrigin:()=>eH,getParsedType:()=>eE,getSizableOrigin:()=>eZ,isObject:()=>ew,isPlainObject:()=>ev,issue:()=>eF,joinValues:()=>ei,jsonStringifyReplacer:()=>es,merge:()=>ez,normalizeParams:()=>eS,nullish:()=>ec,numKeys:()=>e_,omit:()=>eD,optionalKeys:()=>eO,partial:()=>ej,pick:()=>eP,prefixIssues:()=>eV,primitiveTypes:()=>eA,promiseAllObject:()=>eh,propertyKeyTypes:()=>ek,randomString:()=>em,required:()=>eL,stringifyPrimitive:()=>eI,unwrapMessage:()=>eq});var eg=Error.captureStackTrace?Error.captureStackTrace:(...e)=>{};function ew(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}var eb=ea(()=>{if("undefined"!=typeof navigator&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{return Function(""),!0}catch(e){return!1}});function ev(e){if(!1===ew(e))return!1;let t=e.constructor;if(void 0===t)return!0;let r=t.prototype;return!1!==ew(r)&&!1!==Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")}function e_(e){let t=0;for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}var eE=e=>{let t=typeof e;switch(t){case"undefined":return"undefined";case"string":return"string";case"number":return Number.isNaN(e)?"nan":"number";case"boolean":return"boolean";case"function":return"function";case"bigint":return"bigint";case"symbol":return"symbol";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return"promise";if("undefined"!=typeof Map&&e instanceof Map)return"map";if("undefined"!=typeof Set&&e instanceof Set)return"set";if("undefined"!=typeof Date&&e instanceof Date)return"date";if("undefined"!=typeof File&&e instanceof File)return"file";return"object";default:throw Error(`Unknown data type: ${t}`)}},ek=new Set(["string","number","symbol"]),eA=new Set(["string","number","bigint","boolean","symbol","undefined"]);function eT(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function ex(e,t,r){let n=new e._zod.constr(t??e._zod.def);return(!t||r?.parent)&&(n._zod.parent=e),n}function eS(e){if(!e)return{};if("string"==typeof e)return{error:()=>e};if(e?.message!==void 0){if(e?.error!==void 0)throw Error("Cannot specify both `message` and `error` params");e.error=e.message}return(delete e.message,"string"==typeof e.error)?{...e,error:()=>e.error}:e}function eR(e){let t;return new Proxy({},{get:(r,n,o)=>(t??(t=e()),Reflect.get(t,n,o)),set:(r,n,o,i)=>(t??(t=e()),Reflect.set(t,n,o,i)),has:(r,n)=>(t??(t=e()),Reflect.has(t,n)),deleteProperty:(r,n)=>(t??(t=e()),Reflect.deleteProperty(t,n)),ownKeys:r=>(t??(t=e()),Reflect.ownKeys(t)),getOwnPropertyDescriptor:(r,n)=>(t??(t=e()),Reflect.getOwnPropertyDescriptor(t,n)),defineProperty:(r,n,o)=>(t??(t=e()),Reflect.defineProperty(t,n,o))})}function eI(e){return"bigint"==typeof e?e.toString()+"n":"string"==typeof e?`"${e}"`:`${e}`}function eO(e){return Object.keys(e).filter(t=>"optional"===e[t]._zod.optin&&"optional"===e[t]._zod.optout)}var eU={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-0x80000000,0x7fffffff],uint32:[0,0xffffffff],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},eN={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};function eP(e,t){let r={},n=e._zod.def;for(let e in t){if(!(e in n.shape))throw Error(`Unrecognized key: "${e}"`);t[e]&&(r[e]=n.shape[e])}return ex(e,{...e._zod.def,shape:r,checks:[]})}function eD(e,t){let r={...e._zod.def.shape},n=e._zod.def;for(let e in t){if(!(e in n.shape))throw Error(`Unrecognized key: "${e}"`);t[e]&&delete r[e]}return ex(e,{...e._zod.def,shape:r,checks:[]})}function e$(e,t){if(!ev(t))throw Error("Invalid input to extend: expected a plain object");let r={...e._zod.def,get shape(){let r={...e._zod.def.shape,...t};return ep(this,"shape",r),r},checks:[]};return ex(e,r)}function ez(e,t){return ex(e,{...e._zod.def,get shape(){let r={...e._zod.def.shape,...t._zod.def.shape};return ep(this,"shape",r),r},catchall:t._zod.def.catchall,checks:[]})}function ej(e,t,r){let n=t._zod.def.shape,o={...n};if(r)for(let t in r){if(!(t in n))throw Error(`Unrecognized key: "${t}"`);r[t]&&(o[t]=e?new e({type:"optional",innerType:n[t]}):n[t])}else for(let t in n)o[t]=e?new e({type:"optional",innerType:n[t]}):n[t];return ex(t,{...t._zod.def,shape:o,checks:[]})}function eL(e,t,r){let n=t._zod.def.shape,o={...n};if(r)for(let t in r){if(!(t in o))throw Error(`Unrecognized key: "${t}"`);r[t]&&(o[t]=new e({type:"nonoptional",innerType:n[t]}))}else for(let t in n)o[t]=new e({type:"nonoptional",innerType:n[t]});return ex(t,{...t._zod.def,shape:o,checks:[]})}function eC(e,t=0){for(let r=t;r<e.issues.length;r++)if(e.issues[r]?.continue!==!0)return!0;return!1}function eV(e,t){return t.map(t=>(t.path??(t.path=[]),t.path.unshift(e),t))}function eq(e){return"string"==typeof e?e:e?.message}function eM(e,t,r){let n={...e,path:e.path??[]};return e.message||(n.message=eq(e.inst?._zod.def?.error?.(e))??eq(t?.error?.(e))??eq(r.customError?.(e))??eq(r.localeError?.(e))??"Invalid input"),delete n.inst,delete n.continue,t?.reportInput||delete n.input,n}function eZ(e){return e instanceof Set?"set":e instanceof Map?"map":e instanceof File?"file":"unknown"}function eH(e){return Array.isArray(e)?"array":"string"==typeof e?"string":"unknown"}function eF(...e){let[t,r,n]=e;return"string"==typeof t?{message:t,code:"custom",input:r,inst:n}:{...t}}function eK(e){return Object.entries(e).filter(([e,t])=>Number.isNaN(Number.parseInt(e,10))).map(e=>e[1])}var eW=class{constructor(...e){}},eB=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),Object.defineProperty(e,"message",{get:()=>JSON.stringify(t,es,2),enumerable:!0}),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},eJ=Q("$ZodError",eB);Q("$ZodError",eB,{Parent:Error}),Symbol("ZodOutput"),Symbol("ZodInput");var eG=(e,t)=>{eJ.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:t=>(function(e,t){let r=t||function(e){return e.message},n={_errors:[]},o=e=>{for(let t of e.issues)if("invalid_union"===t.code&&t.errors.length)t.errors.map(e=>o({issues:e}));else if("invalid_key"===t.code)o({issues:t.issues});else if("invalid_element"===t.code)o({issues:t.issues});else if(0===t.path.length)n._errors.push(r(t));else{let e=n,o=0;for(;o<t.path.length;){let n=t.path[o];o===t.path.length-1?(e[n]=e[n]||{_errors:[]},e[n]._errors.push(r(t))):e[n]=e[n]||{_errors:[]},e=e[n],o++}}};return o(e),n})(e,t)},flatten:{value:t=>(function(e,t=e=>e.message){let r={},n=[];for(let o of e.issues)o.path.length>0?(r[o.path[0]]=r[o.path[0]]||[],r[o.path[0]].push(t(o))):n.push(t(o));return{formErrors:n,fieldErrors:r}})(e,t)},addIssue:{value:t=>e.issues.push(t)},addIssues:{value:t=>e.issues.push(...t)},isEmpty:{get:()=>0===e.issues.length}})};Q("ZodError",eG),Q("ZodError",eG,{Parent:Error});var eQ={};function eY(e){switch(e.constructor.name){case"ZodString":default:return"string";case"ZodNumber":return"number";case"ZodBoolean":return"boolean";case"ZodObject":return"object";case"ZodArray":return"array"}}function eX(e){let t=[];return e.metadata?.openapi?.parameters?t.push(...e.metadata.openapi.parameters):e.query instanceof null&&Object.entries(e.query.shape).forEach(([e,r])=>{r instanceof null&&t.push({name:e,in:"query",schema:{type:eY(r),..."minLength"in r&&r.minLength?{minLength:r.minLength}:{},description:r.description}})}),t}function e0(e){return{400:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}},required:["message"]}}},description:"Bad Request. Usually due to missing parameters, or invalid parameters."},401:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}},required:["message"]}}},description:"Unauthorized. Due to missing or invalid authentication."},403:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Forbidden. You do not have permission to access this resource or to perform this action."},404:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Not Found. The requested resource was not found."},429:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Too Many Requests. You have exceeded the rate limit. Try again later."},500:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Internal Server Error. This is a problem with the server that you cannot fix."},...e}}function e1(e,t,r){function n(r,n){var o;for(let i in Object.defineProperty(r,"_zod",{value:r._zod??{},enumerable:!1}),(o=r._zod).traits??(o.traits=new Set),r._zod.traits.add(e),t(r,n),s.prototype)i in r||Object.defineProperty(r,i,{value:s.prototype[i].bind(r)});r._zod.constr=s,r._zod.def=n}let o=r?.Parent??Object;class i extends o{}function s(e){var t;let o=r?.Parent?new i:this;for(let r of(n(o,e),(t=o._zod).deferred??(t.deferred=[]),o._zod.deferred))r();return o}return Object.defineProperty(i,"name",{value:e}),Object.defineProperty(s,"init",{value:n}),Object.defineProperty(s,Symbol.hasInstance,{value:t=>!!r?.Parent&&t instanceof r.Parent||t?._zod?.traits?.has(e)}),Object.defineProperty(s,"name",{value:e}),s}Object.freeze({status:"aborted"}),Symbol("zod_brand");class e2 extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}let e5={};function e6(e){return e&&Object.assign(e5,e),e5}let e4=/^[cC][^\s-]{8,}$/,e8=/^[0-9a-z]+$/,e3=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,e9=/^[0-9a-vA-V]{20}$/,e7=/^[A-Za-z0-9]{27}$/,te=/^[a-zA-Z0-9_-]{21}$/,tt=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,tr=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,tn=e=>e?RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/,to=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,ti=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ts=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,ta=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,tc=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,tl=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,td=/^[A-Za-z0-9_-]*$/,tu=/^(?=.{1,253}\.?$)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[-0-9a-zA-Z]{0,61}[0-9a-zA-Z])?)*\.?$/,tp=/^\+(?:[0-9]){6,14}[0-9]$/,tf="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",th=RegExp(`^${tf}$`);function tm(e){let t="(?:[01]\\d|2[0-3]):[0-5]\\d";return"number"==typeof e.precision?-1===e.precision?`${t}`:0===e.precision?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}let ty=e=>{let t=e?`[\\s\\S]{${e?.minimum??0},${e?.maximum??""}}`:"[\\s\\S]*";return RegExp(`^${t}$`)},tg=/^\d+$/,tw=/^-?\d+(?:\.\d+)?/i,tb=/true|false/i,tv=/^[^A-Z]*$/,t_=/^[^a-z]*$/;function tE(e,t){return"bigint"==typeof t?t.toString():t}function tk(e){return{get value(){{let t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function tA(e){let t=+!!e.startsWith("^"),r=e.endsWith("$")?e.length-1:e.length;return e.slice(t,r)}let tT=Symbol("evaluating");function tx(e,t,r){let n;Object.defineProperty(e,t,{get(){if(n!==tT)return void 0===n&&(n=tT,n=r()),n},set(r){Object.defineProperty(e,t,{value:r})},configurable:!0})}function tS(e,t,r){Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0})}function tR(...e){let t={};for(let r of e)Object.assign(t,Object.getOwnPropertyDescriptors(r));return Object.defineProperties({},t)}function tI(e){return JSON.stringify(e)}let tO="captureStackTrace"in Error?Error.captureStackTrace:(...e)=>{};function tU(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}let tN=tk(()=>{if("undefined"!=typeof navigator&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{return Function(""),!0}catch(e){return!1}});function tP(e){if(!1===tU(e))return!1;let t=e.constructor;if(void 0===t)return!0;let r=t.prototype;return!1!==tU(r)&&!1!==Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")}function tD(e){return tP(e)?{...e}:e}let t$=new Set(["string","number","symbol"]);function tz(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function tj(e,t,r){let n=new e._zod.constr(t??e._zod.def);return(!t||r?.parent)&&(n._zod.parent=e),n}function tL(e){if(!e)return{};if("string"==typeof e)return{error:()=>e};if(e?.message!==void 0){if(e?.error!==void 0)throw Error("Cannot specify both `message` and `error` params");e.error=e.message}return(delete e.message,"string"==typeof e.error)?{...e,error:()=>e.error}:e}let tC={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-0x80000000,0x7fffffff],uint32:[0,0xffffffff],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function tV(e,t=0){for(let r=t;r<e.issues.length;r++)if(e.issues[r]?.continue!==!0)return!0;return!1}function tq(e,t){return t.map(t=>(t.path??(t.path=[]),t.path.unshift(e),t))}function tM(e){return"string"==typeof e?e:e?.message}function tZ(e,t,r){let n={...e,path:e.path??[]};return e.message||(n.message=tM(e.inst?._zod.def?.error?.(e))??tM(t?.error?.(e))??tM(r.customError?.(e))??tM(r.localeError?.(e))??"Invalid input"),delete n.inst,delete n.continue,t?.reportInput||delete n.input,n}function tH(e){return Array.isArray(e)?"array":"string"==typeof e?"string":"unknown"}function tF(...e){let[t,r,n]=e;return"string"==typeof t?{message:t,code:"custom",input:r,inst:n}:{...t}}let tK=e1("$ZodCheck",(e,t)=>{var r;e._zod??(e._zod={}),e._zod.def=t,(r=e._zod).onattach??(r.onattach=[])}),tW={number:"number",bigint:"bigint",object:"date"},tB=e1("$ZodCheckLessThan",(e,t)=>{tK.init(e,t);let r=tW[typeof t.value];e._zod.onattach.push(e=>{let r=e._zod.bag,n=(t.inclusive?r.maximum:r.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<n&&(t.inclusive?r.maximum=t.value:r.exclusiveMaximum=t.value)}),e._zod.check=n=>{(t.inclusive?n.value<=t.value:n.value<t.value)||n.issues.push({origin:r,code:"too_big",maximum:t.value,input:n.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),tJ=e1("$ZodCheckGreaterThan",(e,t)=>{tK.init(e,t);let r=tW[typeof t.value];e._zod.onattach.push(e=>{let r=e._zod.bag,n=(t.inclusive?r.minimum:r.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>n&&(t.inclusive?r.minimum=t.value:r.exclusiveMinimum=t.value)}),e._zod.check=n=>{(t.inclusive?n.value>=t.value:n.value>t.value)||n.issues.push({origin:r,code:"too_small",minimum:t.value,input:n.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),tG=e1("$ZodCheckMultipleOf",(e,t)=>{tK.init(e,t),e._zod.onattach.push(e=>{var r;(r=e._zod.bag).multipleOf??(r.multipleOf=t.value)}),e._zod.check=r=>{if(typeof r.value!=typeof t.value)throw Error("Cannot mix number and bigint in multiple_of check.");("bigint"==typeof r.value?r.value%t.value===BigInt(0):0===function(e,t){let r=(e.toString().split(".")[1]||"").length,n=t.toString(),o=(n.split(".")[1]||"").length;if(0===o&&/\d?e-\d?/.test(n)){let e=n.match(/\d?e-(\d?)/);e?.[1]&&(o=Number.parseInt(e[1]))}let i=r>o?r:o;return Number.parseInt(e.toFixed(i).replace(".",""))%Number.parseInt(t.toFixed(i).replace(".",""))/10**i}(r.value,t.value))||r.issues.push({origin:typeof r.value,code:"not_multiple_of",divisor:t.value,input:r.value,inst:e,continue:!t.abort})}}),tQ=e1("$ZodCheckNumberFormat",(e,t)=>{tK.init(e,t),t.format=t.format||"float64";let r=t.format?.includes("int"),n=r?"int":"number",[o,i]=tC[t.format];e._zod.onattach.push(e=>{let n=e._zod.bag;n.format=t.format,n.minimum=o,n.maximum=i,r&&(n.pattern=tg)}),e._zod.check=s=>{let a=s.value;if(r){if(!Number.isInteger(a))return void s.issues.push({expected:n,format:t.format,code:"invalid_type",continue:!1,input:a,inst:e});if(!Number.isSafeInteger(a))return void(a>0?s.issues.push({input:a,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:n,continue:!t.abort}):s.issues.push({input:a,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:n,continue:!t.abort}))}a<o&&s.issues.push({origin:"number",input:a,code:"too_small",minimum:o,inclusive:!0,inst:e,continue:!t.abort}),a>i&&s.issues.push({origin:"number",input:a,code:"too_big",maximum:i,inst:e})}}),tY=e1("$ZodCheckMaxLength",(e,t)=>{var r;tK.init(e,t),(r=e._zod.def).when??(r.when=e=>{let t=e.value;return null!=t&&void 0!==t.length}),e._zod.onattach.push(e=>{let r=e._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<r&&(e._zod.bag.maximum=t.maximum)}),e._zod.check=r=>{let n=r.value;if(n.length<=t.maximum)return;let o=tH(n);r.issues.push({origin:o,code:"too_big",maximum:t.maximum,inclusive:!0,input:n,inst:e,continue:!t.abort})}}),tX=e1("$ZodCheckMinLength",(e,t)=>{var r;tK.init(e,t),(r=e._zod.def).when??(r.when=e=>{let t=e.value;return null!=t&&void 0!==t.length}),e._zod.onattach.push(e=>{let r=e._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>r&&(e._zod.bag.minimum=t.minimum)}),e._zod.check=r=>{let n=r.value;if(n.length>=t.minimum)return;let o=tH(n);r.issues.push({origin:o,code:"too_small",minimum:t.minimum,inclusive:!0,input:n,inst:e,continue:!t.abort})}}),t0=e1("$ZodCheckLengthEquals",(e,t)=>{var r;tK.init(e,t),(r=e._zod.def).when??(r.when=e=>{let t=e.value;return null!=t&&void 0!==t.length}),e._zod.onattach.push(e=>{let r=e._zod.bag;r.minimum=t.length,r.maximum=t.length,r.length=t.length}),e._zod.check=r=>{let n=r.value,o=n.length;if(o===t.length)return;let i=tH(n),s=o>t.length;r.issues.push({origin:i,...s?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:r.value,inst:e,continue:!t.abort})}}),t1=e1("$ZodCheckStringFormat",(e,t)=>{var r,n;tK.init(e,t),e._zod.onattach.push(e=>{let r=e._zod.bag;r.format=t.format,t.pattern&&(r.patterns??(r.patterns=new Set),r.patterns.add(t.pattern))}),t.pattern?(r=e._zod).check??(r.check=r=>{t.pattern.lastIndex=0,t.pattern.test(r.value)||r.issues.push({origin:"string",code:"invalid_format",format:t.format,input:r.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(n=e._zod).check??(n.check=()=>{})}),t2=e1("$ZodCheckRegex",(e,t)=>{t1.init(e,t),e._zod.check=r=>{t.pattern.lastIndex=0,t.pattern.test(r.value)||r.issues.push({origin:"string",code:"invalid_format",format:"regex",input:r.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),t5=e1("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=tv),t1.init(e,t)}),t6=e1("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=t_),t1.init(e,t)}),t4=e1("$ZodCheckIncludes",(e,t)=>{tK.init(e,t);let r=tz(t.includes),n=new RegExp("number"==typeof t.position?`^.{${t.position}}${r}`:r);t.pattern=n,e._zod.onattach.push(e=>{let t=e._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(n)}),e._zod.check=r=>{r.value.includes(t.includes,t.position)||r.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:r.value,inst:e,continue:!t.abort})}}),t8=e1("$ZodCheckStartsWith",(e,t)=>{tK.init(e,t);let r=RegExp(`^${tz(t.prefix)}.*`);t.pattern??(t.pattern=r),e._zod.onattach.push(e=>{let t=e._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(r)}),e._zod.check=r=>{r.value.startsWith(t.prefix)||r.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:r.value,inst:e,continue:!t.abort})}}),t3=e1("$ZodCheckEndsWith",(e,t)=>{tK.init(e,t);let r=RegExp(`.*${tz(t.suffix)}$`);t.pattern??(t.pattern=r),e._zod.onattach.push(e=>{let t=e._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(r)}),e._zod.check=r=>{r.value.endsWith(t.suffix)||r.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:r.value,inst:e,continue:!t.abort})}}),t9=e1("$ZodCheckOverwrite",(e,t)=>{tK.init(e,t),e._zod.check=e=>{e.value=t.tx(e.value)}});class t7{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if("function"==typeof e){e(this,{execution:"sync"}),e(this,{execution:"async"});return}let t=e.split("\n").filter(e=>e),r=Math.min(...t.map(e=>e.length-e.trimStart().length));for(let e of t.map(e=>e.slice(r)).map(e=>" ".repeat(2*this.indent)+e))this.content.push(e)}compile(){return Function(...this?.args,[...(this?.content??[""]).map(e=>`  ${e}`)].join("\n"))}}let re=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),e.message=JSON.stringify(t,tE,2),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},rt=e1("$ZodError",re),rr=e1("$ZodError",re,{Parent:Error}),rn=e=>(t,r,n)=>{let o=n?{...n,async:!1}:{async:!1},i=t._zod.run({value:r,issues:[]},o);if(i instanceof Promise)throw new e2;return i.issues.length?{success:!1,error:new(e??rt)(i.issues.map(e=>tZ(e,o,e6())))}:{success:!0,data:i.value}},ro=rn(rr),ri=e=>async(t,r,n)=>{let o=n?Object.assign(n,{async:!0}):{async:!0},i=t._zod.run({value:r,issues:[]},o);return i instanceof Promise&&(i=await i),i.issues.length?{success:!1,error:new e(i.issues.map(e=>tZ(e,o,e6())))}:{success:!0,data:i.value}},rs=ri(rr),ra={major:4,minor:0,patch:17},rc=e1("$ZodType",(e,t)=>{var r;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=ra;let n=[...e._zod.def.checks??[]];for(let t of(e._zod.traits.has("$ZodCheck")&&n.unshift(e),n))for(let r of t._zod.onattach)r(e);if(0===n.length)(r=e._zod).deferred??(r.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{let t=(e,t,r)=>{let n,o=tV(e);for(let i of t){if(i._zod.def.when){if(!i._zod.def.when(e))continue}else if(o)continue;let t=e.issues.length,s=i._zod.check(e);if(s instanceof Promise&&r?.async===!1)throw new e2;if(n||s instanceof Promise)n=(n??Promise.resolve()).then(async()=>{await s,e.issues.length!==t&&(o||(o=tV(e,t)))});else{if(e.issues.length===t)continue;o||(o=tV(e,t))}}return n?n.then(()=>e):e};e._zod.run=(r,o)=>{let i=e._zod.parse(r,o);if(i instanceof Promise){if(!1===o.async)throw new e2;return i.then(e=>t(e,n,o))}return t(i,n,o)}}e["~standard"]={validate:t=>{try{let r=ro(e,t);return r.success?{value:r.data}:{issues:r.error?.issues}}catch(r){return rs(e,t).then(e=>e.success?{value:e.data}:{issues:e.error?.issues})}},vendor:"zod",version:1}}),rl=e1("$ZodString",(e,t)=>{rc.init(e,t),e._zod.pattern=[...e?._zod.bag?.patterns??[]].pop()??ty(e._zod.bag),e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=String(r.value)}catch(e){}return"string"==typeof r.value||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:e}),r}}),rd=e1("$ZodStringFormat",(e,t)=>{t1.init(e,t),rl.init(e,t)}),ru=e1("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=tr),rd.init(e,t)}),rp=e1("$ZodUUID",(e,t)=>{if(t.version){let e={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(void 0===e)throw Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=tn(e))}else t.pattern??(t.pattern=tn());rd.init(e,t)}),rf=e1("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=to),rd.init(e,t)}),rh=e1("$ZodURL",(e,t)=>{rd.init(e,t),e._zod.check=r=>{try{let n=r.value.trim(),o=new URL(n);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(o.hostname)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:tu.source,input:r.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(o.protocol.endsWith(":")?o.protocol.slice(0,-1):o.protocol)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:r.value,inst:e,continue:!t.abort})),t.normalize?r.value=o.href:r.value=n;return}catch(n){r.issues.push({code:"invalid_format",format:"url",input:r.value,inst:e,continue:!t.abort})}}}),rm=e1("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),rd.init(e,t)}),ry=e1("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=te),rd.init(e,t)}),rg=e1("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=e4),rd.init(e,t)}),rw=e1("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=e8),rd.init(e,t)}),rb=e1("$ZodULID",(e,t)=>{t.pattern??(t.pattern=e3),rd.init(e,t)}),rv=e1("$ZodXID",(e,t)=>{t.pattern??(t.pattern=e9),rd.init(e,t)}),r_=e1("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=e7),rd.init(e,t)}),rE=e1("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=function(e){let t=tm({precision:e.precision}),r=["Z"];e.local&&r.push(""),e.offset&&r.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");let n=`${t}(?:${r.join("|")})`;return RegExp(`^${tf}T(?:${n})$`)}(t)),rd.init(e,t)}),rk=e1("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=th),rd.init(e,t)}),rA=e1("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=RegExp(`^${tm(t)}$`)),rd.init(e,t)}),rT=e1("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=tt),rd.init(e,t)}),rx=e1("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=ti),rd.init(e,t),e._zod.onattach.push(e=>{e._zod.bag.format="ipv4"})}),rS=e1("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=ts),rd.init(e,t),e._zod.onattach.push(e=>{e._zod.bag.format="ipv6"}),e._zod.check=r=>{try{new URL(`http://[${r.value}]`)}catch{r.issues.push({code:"invalid_format",format:"ipv6",input:r.value,inst:e,continue:!t.abort})}}}),rR=e1("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=ta),rd.init(e,t)}),rI=e1("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=tc),rd.init(e,t),e._zod.check=r=>{let[n,o]=r.value.split("/");try{if(!o)throw Error();let e=Number(o);if(`${e}`!==o||e<0||e>128)throw Error();new URL(`http://[${n}]`)}catch{r.issues.push({code:"invalid_format",format:"cidrv6",input:r.value,inst:e,continue:!t.abort})}}});function rO(e){if(""===e)return!0;if(e.length%4!=0)return!1;try{return atob(e),!0}catch{return!1}}let rU=e1("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=tl),rd.init(e,t),e._zod.onattach.push(e=>{e._zod.bag.contentEncoding="base64"}),e._zod.check=r=>{rO(r.value)||r.issues.push({code:"invalid_format",format:"base64",input:r.value,inst:e,continue:!t.abort})}}),rN=e1("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=td),rd.init(e,t),e._zod.onattach.push(e=>{e._zod.bag.contentEncoding="base64url"}),e._zod.check=r=>{!function(e){if(!td.test(e))return!1;let t=e.replace(/[-_]/g,e=>"-"===e?"+":"/");return rO(t.padEnd(4*Math.ceil(t.length/4),"="))}(r.value)&&r.issues.push({code:"invalid_format",format:"base64url",input:r.value,inst:e,continue:!t.abort})}}),rP=e1("$ZodE164",(e,t)=>{t.pattern??(t.pattern=tp),rd.init(e,t)}),rD=e1("$ZodJWT",(e,t)=>{rd.init(e,t),e._zod.check=r=>{!function(e,t=null){try{let r=e.split(".");if(3!==r.length)return!1;let[n]=r;if(!n)return!1;let o=JSON.parse(atob(n));if("typ"in o&&o?.typ!=="JWT"||!o.alg||t&&(!("alg"in o)||o.alg!==t))return!1;return!0}catch{return!1}}(r.value,t.alg)&&r.issues.push({code:"invalid_format",format:"jwt",input:r.value,inst:e,continue:!t.abort})}}),r$=e1("$ZodNumber",(e,t)=>{rc.init(e,t),e._zod.pattern=e._zod.bag.pattern??tw,e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=Number(r.value)}catch(e){}let o=r.value;if("number"==typeof o&&!Number.isNaN(o)&&Number.isFinite(o))return r;let i="number"==typeof o?Number.isNaN(o)?"NaN":Number.isFinite(o)?void 0:"Infinity":void 0;return r.issues.push({expected:"number",code:"invalid_type",input:o,inst:e,...i?{received:i}:{}}),r}}),rz=e1("$ZodNumber",(e,t)=>{tQ.init(e,t),r$.init(e,t)}),rj=e1("$ZodBoolean",(e,t)=>{rc.init(e,t),e._zod.pattern=tb,e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=!!r.value}catch(e){}let o=r.value;return"boolean"==typeof o||r.issues.push({expected:"boolean",code:"invalid_type",input:o,inst:e}),r}}),rL=e1("$ZodUnknown",(e,t)=>{rc.init(e,t),e._zod.parse=e=>e}),rC=e1("$ZodNever",(e,t)=>{rc.init(e,t),e._zod.parse=(t,r)=>(t.issues.push({expected:"never",code:"invalid_type",input:t.value,inst:e}),t)}),rV=e1("$ZodDate",(e,t)=>{rc.init(e,t),e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=new Date(r.value)}catch(e){}let o=r.value,i=o instanceof Date;return i&&!Number.isNaN(o.getTime())||r.issues.push({expected:"date",code:"invalid_type",input:o,...i?{received:"Invalid Date"}:{},inst:e}),r}});function rq(e,t,r){e.issues.length&&t.issues.push(...tq(r,e.issues)),t.value[r]=e.value}let rM=e1("$ZodArray",(e,t)=>{rc.init(e,t),e._zod.parse=(r,n)=>{let o=r.value;if(!Array.isArray(o))return r.issues.push({expected:"array",code:"invalid_type",input:o,inst:e}),r;r.value=Array(o.length);let i=[];for(let e=0;e<o.length;e++){let s=o[e],a=t.element._zod.run({value:s,issues:[]},n);a instanceof Promise?i.push(a.then(t=>rq(t,r,e))):rq(a,r,e)}return i.length?Promise.all(i).then(()=>r):r}});function rZ(e,t,r,n){e.issues.length&&t.issues.push(...tq(r,e.issues)),void 0===e.value?r in n&&(t.value[r]=void 0):t.value[r]=e.value}let rH=e1("$ZodObject",(e,t)=>{let r,n;rc.init(e,t);let o=tk(()=>{let e=Object.keys(t.shape);for(let r of e)if(!t.shape[r]._zod.traits.has("$ZodType"))throw Error(`Invalid element at key "${r}": expected a Zod schema`);let r=function(e){return Object.keys(e).filter(t=>"optional"===e[t]._zod.optin&&"optional"===e[t]._zod.optout)}(t.shape);return{shape:t.shape,keys:e,keySet:new Set(e),numKeys:e.length,optionalKeys:new Set(r)}});tx(e._zod,"propValues",()=>{let e=t.shape,r={};for(let t in e){let n=e[t]._zod;if(n.values)for(let e of(r[t]??(r[t]=new Set),n.values))r[t].add(e)}return r});let i=e=>{let t=new t7(["shape","payload","ctx"]),r=o.value,n=e=>{let t=tI(e);return`shape[${t}]._zod.run({ value: input[${t}], issues: [] }, ctx)`};t.write("const input = payload.value;");let i=Object.create(null),s=0;for(let e of r.keys)i[e]=`key_${s++}`;for(let e of(t.write("const newResult = {}"),r.keys)){let r=i[e],o=tI(e);t.write(`const ${r} = ${n(e)};`),t.write(`
        if (${r}.issues.length) {
          payload.issues = payload.issues.concat(${r}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${o}, ...iss.path] : [${o}]
          })));
        }
        
        if (${r}.value === undefined) {
          if (${o} in input) {
            newResult[${o}] = undefined;
          }
        } else {
          newResult[${o}] = ${r}.value;
        }
      `)}t.write("payload.value = newResult;"),t.write("return payload;");let a=t.compile();return(t,r)=>a(e,t,r)},s=!e5.jitless,a=s&&tN.value,c=t.catchall;e._zod.parse=(l,d)=>{n??(n=o.value);let u=l.value;if(!tU(u))return l.issues.push({expected:"object",code:"invalid_type",input:u,inst:e}),l;let p=[];if(s&&a&&d?.async===!1&&!0!==d.jitless)r||(r=i(t.shape)),l=r(l,d);else{l.value={};let e=n.shape;for(let t of n.keys){let r=e[t]._zod.run({value:u[t],issues:[]},d);r instanceof Promise?p.push(r.then(e=>rZ(e,l,t,u))):rZ(r,l,t,u)}}if(!c)return p.length?Promise.all(p).then(()=>l):l;let f=[],h=n.keySet,m=c._zod,y=m.def.type;for(let e of Object.keys(u)){if(h.has(e))continue;if("never"===y){f.push(e);continue}let t=m.run({value:u[e],issues:[]},d);t instanceof Promise?p.push(t.then(t=>rZ(t,l,e,u))):rZ(t,l,e,u)}return(f.length&&l.issues.push({code:"unrecognized_keys",keys:f,input:u,inst:e}),p.length)?Promise.all(p).then(()=>l):l}});function rF(e,t,r,n){for(let r of e)if(0===r.issues.length)return t.value=r.value,t;let o=e.filter(e=>!tV(e));return 1===o.length?(t.value=o[0].value,o[0]):(t.issues.push({code:"invalid_union",input:t.value,inst:r,errors:e.map(e=>e.issues.map(e=>tZ(e,n,e6())))}),t)}let rK=e1("$ZodUnion",(e,t)=>{rc.init(e,t),tx(e._zod,"optin",()=>t.options.some(e=>"optional"===e._zod.optin)?"optional":void 0),tx(e._zod,"optout",()=>t.options.some(e=>"optional"===e._zod.optout)?"optional":void 0),tx(e._zod,"values",()=>{if(t.options.every(e=>e._zod.values))return new Set(t.options.flatMap(e=>Array.from(e._zod.values)))}),tx(e._zod,"pattern",()=>{if(t.options.every(e=>e._zod.pattern)){let e=t.options.map(e=>e._zod.pattern);return RegExp(`^(${e.map(e=>tA(e.source)).join("|")})$`)}});let r=1===t.options.length,n=t.options[0]._zod.run;e._zod.parse=(o,i)=>{if(r)return n(o,i);let s=!1,a=[];for(let e of t.options){let t=e._zod.run({value:o.value,issues:[]},i);if(t instanceof Promise)a.push(t),s=!0;else{if(0===t.issues.length)return t;a.push(t)}}return s?Promise.all(a).then(t=>rF(t,o,e,i)):rF(a,o,e,i)}}),rW=e1("$ZodIntersection",(e,t)=>{rc.init(e,t),e._zod.parse=(e,r)=>{let n=e.value,o=t.left._zod.run({value:n,issues:[]},r),i=t.right._zod.run({value:n,issues:[]},r);return o instanceof Promise||i instanceof Promise?Promise.all([o,i]).then(([t,r])=>rB(e,t,r)):rB(e,o,i)}});function rB(e,t,r){if(t.issues.length&&e.issues.push(...t.issues),r.issues.length&&e.issues.push(...r.issues),tV(e))return e;let n=function e(t,r){if(t===r||t instanceof Date&&r instanceof Date&&+t==+r)return{valid:!0,data:t};if(tP(t)&&tP(r)){let n=Object.keys(r),o=Object.keys(t).filter(e=>-1!==n.indexOf(e)),i={...t,...r};for(let n of o){let o=e(t[n],r[n]);if(!o.valid)return{valid:!1,mergeErrorPath:[n,...o.mergeErrorPath]};i[n]=o.data}return{valid:!0,data:i}}if(Array.isArray(t)&&Array.isArray(r)){if(t.length!==r.length)return{valid:!1,mergeErrorPath:[]};let n=[];for(let o=0;o<t.length;o++){let i=e(t[o],r[o]);if(!i.valid)return{valid:!1,mergeErrorPath:[o,...i.mergeErrorPath]};n.push(i.data)}return{valid:!0,data:n}}return{valid:!1,mergeErrorPath:[]}}(t.value,r.value);if(!n.valid)throw Error(`Unmergable intersection. Error path: ${JSON.stringify(n.mergeErrorPath)}`);return e.value=n.data,e}let rJ=e1("$ZodRecord",(e,t)=>{rc.init(e,t),e._zod.parse=(r,n)=>{let o=r.value;if(!tP(o))return r.issues.push({expected:"record",code:"invalid_type",input:o,inst:e}),r;let i=[];if(t.keyType._zod.values){let s,a=t.keyType._zod.values;for(let e of(r.value={},a))if("string"==typeof e||"number"==typeof e||"symbol"==typeof e){let s=t.valueType._zod.run({value:o[e],issues:[]},n);s instanceof Promise?i.push(s.then(t=>{t.issues.length&&r.issues.push(...tq(e,t.issues)),r.value[e]=t.value})):(s.issues.length&&r.issues.push(...tq(e,s.issues)),r.value[e]=s.value)}for(let e in o)a.has(e)||(s=s??[]).push(e);s&&s.length>0&&r.issues.push({code:"unrecognized_keys",input:o,inst:e,keys:s})}else for(let s of(r.value={},Reflect.ownKeys(o))){if("__proto__"===s)continue;let a=t.keyType._zod.run({value:s,issues:[]},n);if(a instanceof Promise)throw Error("Async schemas not supported in object keys currently");if(a.issues.length){r.issues.push({code:"invalid_key",origin:"record",issues:a.issues.map(e=>tZ(e,n,e6())),input:s,path:[s],inst:e}),r.value[a.value]=a.value;continue}let c=t.valueType._zod.run({value:o[s],issues:[]},n);c instanceof Promise?i.push(c.then(e=>{e.issues.length&&r.issues.push(...tq(s,e.issues)),r.value[a.value]=e.value})):(c.issues.length&&r.issues.push(...tq(s,c.issues)),r.value[a.value]=c.value)}return i.length?Promise.all(i).then(()=>r):r}}),rG=e1("$ZodEnum",(e,t)=>{rc.init(e,t);let r=function(e){let t=Object.values(e).filter(e=>"number"==typeof e);return Object.entries(e).filter(([e,r])=>-1===t.indexOf(+e)).map(([e,t])=>t)}(t.entries),n=new Set(r);e._zod.values=n,e._zod.pattern=RegExp(`^(${r.filter(e=>t$.has(typeof e)).map(e=>"string"==typeof e?tz(e):e.toString()).join("|")})$`),e._zod.parse=(t,o)=>{let i=t.value;return n.has(i)||t.issues.push({code:"invalid_value",values:r,input:i,inst:e}),t}}),rQ=e1("$ZodTransform",(e,t)=>{rc.init(e,t),e._zod.parse=(e,r)=>{let n=t.transform(e.value,e);if(r.async)return(n instanceof Promise?n:Promise.resolve(n)).then(t=>(e.value=t,e));if(n instanceof Promise)throw new e2;return e.value=n,e}});function rY(e,t){return e.issues.length&&void 0===t?{issues:[],value:void 0}:e}let rX=e1("$ZodOptional",(e,t)=>{rc.init(e,t),e._zod.optin="optional",e._zod.optout="optional",tx(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),tx(e._zod,"pattern",()=>{let e=t.innerType._zod.pattern;return e?RegExp(`^(${tA(e.source)})?$`):void 0}),e._zod.parse=(e,r)=>{if("optional"===t.innerType._zod.optin){let n=t.innerType._zod.run(e,r);return n instanceof Promise?n.then(t=>rY(t,e.value)):rY(n,e.value)}return void 0===e.value?e:t.innerType._zod.run(e,r)}}),r0=e1("$ZodNullable",(e,t)=>{rc.init(e,t),tx(e._zod,"optin",()=>t.innerType._zod.optin),tx(e._zod,"optout",()=>t.innerType._zod.optout),tx(e._zod,"pattern",()=>{let e=t.innerType._zod.pattern;return e?RegExp(`^(${tA(e.source)}|null)$`):void 0}),tx(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(e,r)=>null===e.value?e:t.innerType._zod.run(e,r)}),r1=e1("$ZodDefault",(e,t)=>{rc.init(e,t),e._zod.optin="optional",tx(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(e,r)=>{if(void 0===e.value)return e.value=t.defaultValue,e;let n=t.innerType._zod.run(e,r);return n instanceof Promise?n.then(e=>r2(e,t)):r2(n,t)}});function r2(e,t){return void 0===e.value&&(e.value=t.defaultValue),e}let r5=e1("$ZodPrefault",(e,t)=>{rc.init(e,t),e._zod.optin="optional",tx(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(e,r)=>(void 0===e.value&&(e.value=t.defaultValue),t.innerType._zod.run(e,r))}),r6=e1("$ZodNonOptional",(e,t)=>{rc.init(e,t),tx(e._zod,"values",()=>{let e=t.innerType._zod.values;return e?new Set([...e].filter(e=>void 0!==e)):void 0}),e._zod.parse=(r,n)=>{let o=t.innerType._zod.run(r,n);return o instanceof Promise?o.then(t=>r4(t,e)):r4(o,e)}});function r4(e,t){return e.issues.length||void 0!==e.value||e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}let r8=e1("$ZodCatch",(e,t)=>{rc.init(e,t),tx(e._zod,"optin",()=>t.innerType._zod.optin),tx(e._zod,"optout",()=>t.innerType._zod.optout),tx(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(e,r)=>{let n=t.innerType._zod.run(e,r);return n instanceof Promise?n.then(n=>(e.value=n.value,n.issues.length&&(e.value=t.catchValue({...e,error:{issues:n.issues.map(e=>tZ(e,r,e6()))},input:e.value}),e.issues=[]),e)):(e.value=n.value,n.issues.length&&(e.value=t.catchValue({...e,error:{issues:n.issues.map(e=>tZ(e,r,e6()))},input:e.value}),e.issues=[]),e)}}),r3=e1("$ZodPipe",(e,t)=>{rc.init(e,t),tx(e._zod,"values",()=>t.in._zod.values),tx(e._zod,"optin",()=>t.in._zod.optin),tx(e._zod,"optout",()=>t.out._zod.optout),tx(e._zod,"propValues",()=>t.in._zod.propValues),e._zod.parse=(e,r)=>{let n=t.in._zod.run(e,r);return n instanceof Promise?n.then(e=>r9(e,t,r)):r9(n,t,r)}});function r9(e,t,r){return e.issues.length?e:t.out._zod.run({value:e.value,issues:e.issues},r)}let r7=e1("$ZodReadonly",(e,t)=>{rc.init(e,t),tx(e._zod,"propValues",()=>t.innerType._zod.propValues),tx(e._zod,"values",()=>t.innerType._zod.values),tx(e._zod,"optin",()=>t.innerType._zod.optin),tx(e._zod,"optout",()=>t.innerType._zod.optout),e._zod.parse=(e,r)=>{let n=t.innerType._zod.run(e,r);return n instanceof Promise?n.then(ne):ne(n)}});function ne(e){return e.value=Object.freeze(e.value),e}let nt=e1("$ZodCustom",(e,t)=>{tK.init(e,t),rc.init(e,t),e._zod.parse=(e,t)=>e,e._zod.check=r=>{let n=r.value,o=t.fn(n);if(o instanceof Promise)return o.then(t=>nr(t,r,n,e));nr(o,r,n,e)}});function nr(e,t,r,n){if(!e){let e={code:"custom",input:r,inst:n,path:[...n._zod.def.path??[]],continue:!n._zod.def.abort};n._zod.def.params&&(e.params=n._zod.def.params),t.issues.push(tF(e))}}Symbol("ZodOutput"),Symbol("ZodInput");class nn{constructor(){this._map=new Map,this._idmap=new Map}add(e,...t){let r=t[0];if(this._map.set(e,r),r&&"object"==typeof r&&"id"in r){if(this._idmap.has(r.id))throw Error(`ID ${r.id} already exists in the registry`);this._idmap.set(r.id,e)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(e){let t=this._map.get(e);return t&&"object"==typeof t&&"id"in t&&this._idmap.delete(t.id),this._map.delete(e),this}get(e){let t=e._zod.parent;if(t){let r={...this.get(t)??{}};delete r.id;let n={...r,...this._map.get(e)};return Object.keys(n).length?n:void 0}return this._map.get(e)}has(e){return this._map.has(e)}}let no=new nn;function ni(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...tL(t)})}function ns(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...tL(t)})}function na(e,t){return new tB({check:"less_than",...tL(t),value:e,inclusive:!1})}function nc(e,t){return new tB({check:"less_than",...tL(t),value:e,inclusive:!0})}function nl(e,t){return new tJ({check:"greater_than",...tL(t),value:e,inclusive:!1})}function nd(e,t){return new tJ({check:"greater_than",...tL(t),value:e,inclusive:!0})}function nu(e,t){return new tG({check:"multiple_of",...tL(t),value:e})}function np(e,t){return new tY({check:"max_length",...tL(t),maximum:e})}function nf(e,t){return new tX({check:"min_length",...tL(t),minimum:e})}function nh(e,t){return new t0({check:"length_equals",...tL(t),length:e})}function nm(e){return new t9({check:"overwrite",tx:e})}let ny=e1("ZodISODateTime",(e,t)=>{rE.init(e,t),nO.init(e,t)}),ng=e1("ZodISODate",(e,t)=>{rk.init(e,t),nO.init(e,t)}),nw=e1("ZodISOTime",(e,t)=>{rA.init(e,t),nO.init(e,t)}),nb=e1("ZodISODuration",(e,t)=>{rT.init(e,t),nO.init(e,t)}),nv=(e,t)=>{rt.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:t=>(function(e,t){let r=t||function(e){return e.message},n={_errors:[]},o=e=>{for(let t of e.issues)if("invalid_union"===t.code&&t.errors.length)t.errors.map(e=>o({issues:e}));else if("invalid_key"===t.code)o({issues:t.issues});else if("invalid_element"===t.code)o({issues:t.issues});else if(0===t.path.length)n._errors.push(r(t));else{let e=n,o=0;for(;o<t.path.length;){let n=t.path[o];o===t.path.length-1?(e[n]=e[n]||{_errors:[]},e[n]._errors.push(r(t))):e[n]=e[n]||{_errors:[]},e=e[n],o++}}};return o(e),n})(e,t)},flatten:{value:t=>(function(e,t=e=>e.message){let r={},n=[];for(let o of e.issues)o.path.length>0?(r[o.path[0]]=r[o.path[0]]||[],r[o.path[0]].push(t(o))):n.push(t(o));return{formErrors:n,fieldErrors:r}})(e,t)},addIssue:{value:t=>{e.issues.push(t),e.message=JSON.stringify(e.issues,tE,2)}},addIssues:{value:t=>{e.issues.push(...t),e.message=JSON.stringify(e.issues,tE,2)}},isEmpty:{get:()=>0===e.issues.length}})};e1("ZodError",nv);let n_=e1("ZodError",nv,{Parent:Error}),nE=(e,t,r,n)=>{let o=r?Object.assign(r,{async:!1}):{async:!1},i=e._zod.run({value:t,issues:[]},o);if(i instanceof Promise)throw new e2;if(i.issues.length){let e=new(n?.Err??n_)(i.issues.map(e=>tZ(e,o,e6())));throw tO(e,n?.callee),e}return i.value},nk=async(e,t,r,n)=>{let o=r?Object.assign(r,{async:!0}):{async:!0},i=e._zod.run({value:t,issues:[]},o);if(i instanceof Promise&&(i=await i),i.issues.length){let e=new(n?.Err??n_)(i.issues.map(e=>tZ(e,o,e6())));throw tO(e,n?.callee),e}return i.value},nA=rn(n_),nT=ri(n_),nx=e1("ZodType",(e,t)=>(rc.init(e,t),e.def=t,Object.defineProperty(e,"_def",{value:t}),e.check=(...r)=>e.clone({...t,checks:[...t.checks??[],...r.map(e=>"function"==typeof e?{_zod:{check:e,def:{check:"custom"},onattach:[]}}:e)]}),e.clone=(t,r)=>tj(e,t,r),e.brand=()=>e,e.register=(t,r)=>(t.add(e,r),e),e.parse=(t,r)=>nE(e,t,r,{callee:e.parse}),e.safeParse=(t,r)=>nA(e,t,r),e.parseAsync=async(t,r)=>nk(e,t,r,{callee:e.parseAsync}),e.safeParseAsync=async(t,r)=>nT(e,t,r),e.spa=e.safeParseAsync,e.refine=(t,r)=>e.check(function(e,t={}){return new ob({type:"custom",check:"custom",fn:e,...tL(t)})}(t,r)),e.superRefine=t=>e.check(function(e){let t=function(e,t){let r=new tK({check:"custom",...tL(void 0)});return r._zod.check=e,r}(r=>(r.addIssue=e=>{"string"==typeof e?r.issues.push(tF(e,r.value,t._zod.def)):(e.fatal&&(e.continue=!1),e.code??(e.code="custom"),e.input??(e.input=r.value),e.inst??(e.inst=t),e.continue??(e.continue=!t._zod.def.abort),r.issues.push(tF(e)))},e(r.value,r)));return t}(t)),e.overwrite=t=>e.check(nm(t)),e.optional=()=>ol(e),e.nullable=()=>ou(e),e.nullish=()=>ol(ou(e)),e.nonoptional=t=>new oh({type:"nonoptional",innerType:e,...tL(t)}),e.array=()=>n9(e),e.or=t=>or([e,t]),e.and=t=>new on({type:"intersection",left:e,right:t}),e.transform=t=>og(e,function(e){return new oa({type:"transform",transform:e})}(t)),e.default=t=>(function(e,t){return new op({type:"default",innerType:e,get defaultValue(){return"function"==typeof t?t():tD(t)}})})(e,t),e.prefault=t=>(function(e,t){return new of({type:"prefault",innerType:e,get defaultValue(){return"function"==typeof t?t():tD(t)}})})(e,t),e.catch=t=>(function(e,t){return new om({type:"catch",innerType:e,catchValue:"function"==typeof t?t:()=>t})})(e,t),e.pipe=t=>og(e,t),e.readonly=()=>new ow({type:"readonly",innerType:e}),e.describe=t=>{let r=e.clone();return no.add(r,{description:t}),r},Object.defineProperty(e,"description",{get:()=>no.get(e)?.description,configurable:!0}),e.meta=(...t)=>{if(0===t.length)return no.get(e);let r=e.clone();return no.add(r,t[0]),r},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),nS=e1("_ZodString",(e,t)=>{rl.init(e,t),nx.init(e,t);let r=e._zod.bag;e.format=r.format??null,e.minLength=r.minimum??null,e.maxLength=r.maximum??null,e.regex=(...t)=>e.check(function(e,t){return new t2({check:"string_format",format:"regex",...tL(t),pattern:e})}(...t)),e.includes=(...t)=>e.check(function(e,t){return new t4({check:"string_format",format:"includes",...tL(t),includes:e})}(...t)),e.startsWith=(...t)=>e.check(function(e,t){return new t8({check:"string_format",format:"starts_with",...tL(t),prefix:e})}(...t)),e.endsWith=(...t)=>e.check(function(e,t){return new t3({check:"string_format",format:"ends_with",...tL(t),suffix:e})}(...t)),e.min=(...t)=>e.check(nf(...t)),e.max=(...t)=>e.check(np(...t)),e.length=(...t)=>e.check(nh(...t)),e.nonempty=(...t)=>e.check(nf(1,...t)),e.lowercase=t=>e.check(new t5({check:"string_format",format:"lowercase",...tL(t)})),e.uppercase=t=>e.check(new t6({check:"string_format",format:"uppercase",...tL(t)})),e.trim=()=>e.check(nm(e=>e.trim())),e.normalize=(...t)=>e.check(function(e){return nm(t=>t.normalize(e))}(...t)),e.toLowerCase=()=>e.check(nm(e=>e.toLowerCase())),e.toUpperCase=()=>e.check(nm(e=>e.toUpperCase()))}),nR=e1("ZodString",(e,t)=>{rl.init(e,t),nS.init(e,t),e.email=t=>e.check(ni(nU,t)),e.url=t=>e.check(new nD({type:"string",format:"url",check:"string_format",abort:!1,...tL(t)})),e.jwt=t=>e.check(new nJ({type:"string",format:"jwt",check:"string_format",abort:!1,...tL(t)})),e.emoji=t=>e.check(new n$({type:"string",format:"emoji",check:"string_format",abort:!1,...tL(t)})),e.guid=t=>e.check(ns(nN,t)),e.uuid=t=>e.check(new nP({type:"string",format:"uuid",check:"string_format",abort:!1,...tL(t)})),e.uuidv4=t=>e.check(new nP({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...tL(t)})),e.uuidv6=t=>e.check(new nP({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...tL(t)})),e.uuidv7=t=>e.check(new nP({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...tL(t)})),e.nanoid=t=>e.check(new nz({type:"string",format:"nanoid",check:"string_format",abort:!1,...tL(t)})),e.guid=t=>e.check(ns(nN,t)),e.cuid=t=>e.check(new nj({type:"string",format:"cuid",check:"string_format",abort:!1,...tL(t)})),e.cuid2=t=>e.check(new nL({type:"string",format:"cuid2",check:"string_format",abort:!1,...tL(t)})),e.ulid=t=>e.check(new nC({type:"string",format:"ulid",check:"string_format",abort:!1,...tL(t)})),e.base64=t=>e.check(new nK({type:"string",format:"base64",check:"string_format",abort:!1,...tL(t)})),e.base64url=t=>e.check(new nW({type:"string",format:"base64url",check:"string_format",abort:!1,...tL(t)})),e.xid=t=>e.check(new nV({type:"string",format:"xid",check:"string_format",abort:!1,...tL(t)})),e.ksuid=t=>e.check(new nq({type:"string",format:"ksuid",check:"string_format",abort:!1,...tL(t)})),e.ipv4=t=>e.check(new nM({type:"string",format:"ipv4",check:"string_format",abort:!1,...tL(t)})),e.ipv6=t=>e.check(new nZ({type:"string",format:"ipv6",check:"string_format",abort:!1,...tL(t)})),e.cidrv4=t=>e.check(new nH({type:"string",format:"cidrv4",check:"string_format",abort:!1,...tL(t)})),e.cidrv6=t=>e.check(new nF({type:"string",format:"cidrv6",check:"string_format",abort:!1,...tL(t)})),e.e164=t=>e.check(new nB({type:"string",format:"e164",check:"string_format",abort:!1,...tL(t)})),e.datetime=t=>e.check(new ny({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...tL(t)})),e.date=t=>e.check(new ng({type:"string",format:"date",check:"string_format",...tL(t)})),e.time=t=>e.check(new nw({type:"string",format:"time",check:"string_format",precision:null,...tL(t)})),e.duration=t=>e.check(new nb({type:"string",format:"duration",check:"string_format",...tL(t)}))});function nI(e){return new nR({type:"string",...tL(e)})}let nO=e1("ZodStringFormat",(e,t)=>{rd.init(e,t),nS.init(e,t)}),nU=e1("ZodEmail",(e,t)=>{rf.init(e,t),nO.init(e,t)}),nN=e1("ZodGUID",(e,t)=>{ru.init(e,t),nO.init(e,t)}),nP=e1("ZodUUID",(e,t)=>{rp.init(e,t),nO.init(e,t)}),nD=e1("ZodURL",(e,t)=>{rh.init(e,t),nO.init(e,t)}),n$=e1("ZodEmoji",(e,t)=>{rm.init(e,t),nO.init(e,t)}),nz=e1("ZodNanoID",(e,t)=>{ry.init(e,t),nO.init(e,t)}),nj=e1("ZodCUID",(e,t)=>{rg.init(e,t),nO.init(e,t)}),nL=e1("ZodCUID2",(e,t)=>{rw.init(e,t),nO.init(e,t)}),nC=e1("ZodULID",(e,t)=>{rb.init(e,t),nO.init(e,t)}),nV=e1("ZodXID",(e,t)=>{rv.init(e,t),nO.init(e,t)}),nq=e1("ZodKSUID",(e,t)=>{r_.init(e,t),nO.init(e,t)}),nM=e1("ZodIPv4",(e,t)=>{rx.init(e,t),nO.init(e,t)}),nZ=e1("ZodIPv6",(e,t)=>{rS.init(e,t),nO.init(e,t)}),nH=e1("ZodCIDRv4",(e,t)=>{rR.init(e,t),nO.init(e,t)}),nF=e1("ZodCIDRv6",(e,t)=>{rI.init(e,t),nO.init(e,t)}),nK=e1("ZodBase64",(e,t)=>{rU.init(e,t),nO.init(e,t)}),nW=e1("ZodBase64URL",(e,t)=>{rN.init(e,t),nO.init(e,t)}),nB=e1("ZodE164",(e,t)=>{rP.init(e,t),nO.init(e,t)}),nJ=e1("ZodJWT",(e,t)=>{rD.init(e,t),nO.init(e,t)}),nG=e1("ZodNumber",(e,t)=>{r$.init(e,t),nx.init(e,t),e.gt=(t,r)=>e.check(nl(t,r)),e.gte=(t,r)=>e.check(nd(t,r)),e.min=(t,r)=>e.check(nd(t,r)),e.lt=(t,r)=>e.check(na(t,r)),e.lte=(t,r)=>e.check(nc(t,r)),e.max=(t,r)=>e.check(nc(t,r)),e.int=t=>e.check(nX(t)),e.safe=t=>e.check(nX(t)),e.positive=t=>e.check(nl(0,t)),e.nonnegative=t=>e.check(nd(0,t)),e.negative=t=>e.check(na(0,t)),e.nonpositive=t=>e.check(nc(0,t)),e.multipleOf=(t,r)=>e.check(nu(t,r)),e.step=(t,r)=>e.check(nu(t,r)),e.finite=()=>e;let r=e._zod.bag;e.minValue=Math.max(r.minimum??Number.NEGATIVE_INFINITY,r.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(r.maximum??Number.POSITIVE_INFINITY,r.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(r.format??"").includes("int")||Number.isSafeInteger(r.multipleOf??.5),e.isFinite=!0,e.format=r.format??null});function nQ(e){return new nG({type:"number",checks:[],...tL(e)})}let nY=e1("ZodNumberFormat",(e,t)=>{rz.init(e,t),nG.init(e,t)});function nX(e){return new nY({type:"number",check:"number_format",abort:!1,format:"safeint",...tL(e)})}let n0=e1("ZodBoolean",(e,t)=>{rj.init(e,t),nx.init(e,t)});function n1(e){return new n0({type:"boolean",...tL(e)})}let n2=e1("ZodUnknown",(e,t)=>{rL.init(e,t),nx.init(e,t)});function n5(){return new n2({type:"unknown"})}let n6=e1("ZodNever",(e,t)=>{rC.init(e,t),nx.init(e,t)}),n4=e1("ZodDate",(e,t)=>{rV.init(e,t),nx.init(e,t),e.min=(t,r)=>e.check(nd(t,r)),e.max=(t,r)=>e.check(nc(t,r));let r=e._zod.bag;e.minDate=r.minimum?new Date(r.minimum):null,e.maxDate=r.maximum?new Date(r.maximum):null});function n8(e){return new n4({type:"date",...tL(e)})}let n3=e1("ZodArray",(e,t)=>{rM.init(e,t),nx.init(e,t),e.element=t.element,e.min=(t,r)=>e.check(nf(t,r)),e.nonempty=t=>e.check(nf(1,t)),e.max=(t,r)=>e.check(np(t,r)),e.length=(t,r)=>e.check(nh(t,r)),e.unwrap=()=>e.element});function n9(e,t){return new n3({type:"array",element:e,...tL(t)})}let n7=e1("ZodObject",(e,t)=>{rH.init(e,t),nx.init(e,t),tx(e,"shape",()=>t.shape),e.keyof=()=>os(Object.keys(e._zod.def.shape)),e.catchall=t=>e.clone({...e._zod.def,catchall:t}),e.passthrough=()=>e.clone({...e._zod.def,catchall:n5()}),e.loose=()=>e.clone({...e._zod.def,catchall:n5()}),e.strict=()=>{var t;return e.clone({...e._zod.def,catchall:new n6({type:"never",...tL(void 0)})})},e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=t=>(function(e,t){if(!tP(t))throw Error("Invalid input to extend: expected a plain object");let r=tR(e._zod.def,{get shape(){let r={...e._zod.def.shape,...t};return tS(this,"shape",r),r},checks:[]});return tj(e,r)})(e,t),e.merge=t=>(function(e,t){let r=tR(e._zod.def,{get shape(){let r={...e._zod.def.shape,...t._zod.def.shape};return tS(this,"shape",r),r},get catchall(){return t._zod.def.catchall},checks:[]});return tj(e,r)})(e,t),e.pick=t=>(function(e,t){let r=e._zod.def,n=tR(e._zod.def,{get shape(){let e={};for(let n in t){if(!(n in r.shape))throw Error(`Unrecognized key: "${n}"`);t[n]&&(e[n]=r.shape[n])}return tS(this,"shape",e),e},checks:[]});return tj(e,n)})(e,t),e.omit=t=>(function(e,t){let r=e._zod.def,n=tR(e._zod.def,{get shape(){let n={...e._zod.def.shape};for(let e in t){if(!(e in r.shape))throw Error(`Unrecognized key: "${e}"`);t[e]&&delete n[e]}return tS(this,"shape",n),n},checks:[]});return tj(e,n)})(e,t),e.partial=(...t)=>(function(e,t,r){let n=tR(t._zod.def,{get shape(){let n=t._zod.def.shape,o={...n};if(r)for(let t in r){if(!(t in n))throw Error(`Unrecognized key: "${t}"`);r[t]&&(o[t]=e?new e({type:"optional",innerType:n[t]}):n[t])}else for(let t in n)o[t]=e?new e({type:"optional",innerType:n[t]}):n[t];return tS(this,"shape",o),o},checks:[]});return tj(t,n)})(oc,e,t[0]),e.required=(...t)=>(function(e,t,r){let n=tR(t._zod.def,{get shape(){let n=t._zod.def.shape,o={...n};if(r)for(let t in r){if(!(t in o))throw Error(`Unrecognized key: "${t}"`);r[t]&&(o[t]=new e({type:"nonoptional",innerType:n[t]}))}else for(let t in n)o[t]=new e({type:"nonoptional",innerType:n[t]});return tS(this,"shape",o),o},checks:[]});return tj(t,n)})(oh,e,t[0])});function oe(e,t){return new n7({type:"object",get shape(){return tS(this,"shape",e?Object.create(Object.getPrototypeOf(e),Object.getOwnPropertyDescriptors(e)):{}),this.shape},...tL(t)})}let ot=e1("ZodUnion",(e,t)=>{rK.init(e,t),nx.init(e,t),e.options=t.options});function or(e,t){return new ot({type:"union",options:e,...tL(t)})}let on=e1("ZodIntersection",(e,t)=>{rW.init(e,t),nx.init(e,t)}),oo=e1("ZodRecord",(e,t)=>{rJ.init(e,t),nx.init(e,t),e.keyType=t.keyType,e.valueType=t.valueType}),oi=e1("ZodEnum",(e,t)=>{rG.init(e,t),nx.init(e,t),e.enum=t.entries,e.options=Object.values(t.entries);let r=new Set(Object.keys(t.entries));e.extract=(e,n)=>{let o={};for(let n of e)if(r.has(n))o[n]=t.entries[n];else throw Error(`Key ${n} not found in enum`);return new oi({...t,checks:[],...tL(n),entries:o})},e.exclude=(e,n)=>{let o={...t.entries};for(let t of e)if(r.has(t))delete o[t];else throw Error(`Key ${t} not found in enum`);return new oi({...t,checks:[],...tL(n),entries:o})}});function os(e,t){return new oi({type:"enum",entries:Array.isArray(e)?Object.fromEntries(e.map(e=>[e,e])):e,...tL(t)})}let oa=e1("ZodTransform",(e,t)=>{rQ.init(e,t),nx.init(e,t),e._zod.parse=(r,n)=>{r.addIssue=n=>{"string"==typeof n?r.issues.push(tF(n,r.value,t)):(n.fatal&&(n.continue=!1),n.code??(n.code="custom"),n.input??(n.input=r.value),n.inst??(n.inst=e),r.issues.push(tF(n)))};let o=t.transform(r.value,r);return o instanceof Promise?o.then(e=>(r.value=e,r)):(r.value=o,r)}}),oc=e1("ZodOptional",(e,t)=>{rX.init(e,t),nx.init(e,t),e.unwrap=()=>e._zod.def.innerType});function ol(e){return new oc({type:"optional",innerType:e})}let od=e1("ZodNullable",(e,t)=>{r0.init(e,t),nx.init(e,t),e.unwrap=()=>e._zod.def.innerType});function ou(e){return new od({type:"nullable",innerType:e})}let op=e1("ZodDefault",(e,t)=>{r1.init(e,t),nx.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap}),of=e1("ZodPrefault",(e,t)=>{r5.init(e,t),nx.init(e,t),e.unwrap=()=>e._zod.def.innerType}),oh=e1("ZodNonOptional",(e,t)=>{r6.init(e,t),nx.init(e,t),e.unwrap=()=>e._zod.def.innerType}),om=e1("ZodCatch",(e,t)=>{r8.init(e,t),nx.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap}),oy=e1("ZodPipe",(e,t)=>{r3.init(e,t),nx.init(e,t),e.in=t.in,e.out=t.out});function og(e,t){return new oy({type:"pipe",in:e,out:t})}let ow=e1("ZodReadonly",(e,t)=>{r7.init(e,t),nx.init(e,t),e.unwrap=()=>e._zod.def.innerType}),ob=e1("ZodCustom",(e,t)=>{nt.init(e,t),nx.init(e,t)});function ov(e){return new nR({type:"string",coerce:!0,...tL(e)})}function o_(e){return new n0({type:"boolean",coerce:!0,...tL(e)})}function oE(e,t){return{digest:async r=>{let n=new TextEncoder,o="string"==typeof r?n.encode(r):r,i=await g.digest(e,o);return"hex"===t?Array.from(new Uint8Array(i)).map(e=>e.toString(16).padStart(2,"0")).join(""):"base64"===t||"base64url"===t||"base64urlnopad"===t?t.includes("url")?p.encode(i,{padding:"base64urlnopad"!==t}):u.encode(i):i}}}function ok(e){if(!Number.isSafeInteger(e)||e<0)throw Error(`positive integer expected, not ${e}`)}function oA(e){if("boolean"!=typeof e)throw Error(`boolean expected, not ${e}`)}function oT(e){return e instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name}function ox(e,...t){if(!oT(e))throw Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}function oS(e,t=!0){if(e.destroyed)throw Error("Hash instance has been destroyed");if(t&&e.finished)throw Error("Hash#digest() has already been called")}let oR=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),oI=e=>new DataView(e.buffer,e.byteOffset,e.byteLength);if(68!==new Uint8Array(new Uint32Array([0x11223344]).buffer)[0])throw Error("Non little-endian hardware is not supported");let oO=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0")),oU={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function oN(e){return e>=oU._0&&e<=oU._9?e-oU._0:e>=oU._A&&e<=oU._F?e-(oU._A-10):e>=oU._a&&e<=oU._f?e-(oU._a-10):void 0}function oP(e){if("string"!=typeof e)throw Error(`string expected, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function oD(e){if("string"==typeof e)e=oP(e);else if(oT(e))e=oz(e);else throw Error(`Uint8Array expected, got ${typeof e}`);return e}function o$(e,t,r,n){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,n);let o=BigInt(32),i=BigInt(0xffffffff),s=Number(r>>o&i),a=Number(r&i),c=4*!!n,l=4*!n;e.setUint32(t+c,s,n),e.setUint32(t+l,a,n)}function oz(e){return Uint8Array.from(e)}function oj(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}let oL=e=>Uint8Array.from(e.split("").map(e=>e.charCodeAt(0))),oC=oL("expand 16-byte k"),oV=oL("expand 32-byte k"),oq=oR(oC),oM=oR(oV);function oZ(e,t){return e<<t|e>>>32-t}function oH(e){return e.byteOffset%4==0}oM.slice();let oF=0x100000000-1,oK=new Uint32Array;function oW(e,t){let{allowShortKeys:r,extendNonceFn:n,counterLength:o,counterRight:i,rounds:s}=function(e,t){if(null==t||"object"!=typeof t)throw Error("options must be defined");return Object.assign(e,t)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if("function"!=typeof e)throw Error("core must be a function");return ok(o),ok(s),oA(i),oA(r),(t,a,c,l,d=0)=>{ox(t),ox(a),ox(c);let u=c.length;if(void 0===l&&(l=new Uint8Array(u)),ox(l),ok(d),d<0||d>=oF)throw Error("arx: counter overflow");if(l.length<u)throw Error(`arx: output (${l.length}) is shorter than data (${u})`);let p=[],f=t.length,h,m;if(32===f)p.push(h=oz(t)),m=oM;else if(16===f&&r)(h=new Uint8Array(32)).set(t),h.set(t,16),m=oq,p.push(h);else throw Error(`arx: invalid 32-byte key, got length=${f}`);oH(a)||p.push(a=oz(a));let y=oR(h);if(n){if(24!==a.length)throw Error("arx: extended nonce must be 24 bytes");n(m,y,oR(a.subarray(0,16)),y),a=a.subarray(16)}let g=16-o;if(g!==a.length)throw Error(`arx: nonce must be ${g} or 16 bytes`);if(12!==g){let e=new Uint8Array(12);e.set(a,i?0:12-a.length),a=e,p.push(a)}return!function(e,t,r,n,o,i,s,a){let c=o.length,l=new Uint8Array(64),d=oR(l),u=oH(o)&&oH(i),p=u?oR(o):oK,f=u?oR(i):oK;for(let h=0;h<c;s++){if(e(t,r,n,d,s,a),s>=oF)throw Error("arx: counter overflow");let m=Math.min(64,c-h);if(u&&64===m){let e=h/4;if(h%4!=0)throw Error("arx: invalid block position");for(let t=0,r;t<16;t++)f[r=e+t]=p[r]^d[t];h+=64;continue}for(let e=0,t;e<m;e++)i[t=h+e]=o[t]^l[e];h+=m}}(e,m,y,oR(a),c,l,d,s),oj(...p),l}}let oB=(e,t)=>255&e[t++]|(255&e[t++])<<8;class oJ{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,ox(e=oD(e),32);let t=oB(e,0),r=oB(e,2),n=oB(e,4),o=oB(e,6),i=oB(e,8),s=oB(e,10),a=oB(e,12),c=oB(e,14);this.r[0]=8191&t,this.r[1]=(t>>>13|r<<3)&8191,this.r[2]=(r>>>10|n<<6)&7939,this.r[3]=(n>>>7|o<<9)&8191,this.r[4]=(o>>>4|i<<12)&255,this.r[5]=i>>>1&8190,this.r[6]=(i>>>14|s<<2)&8191,this.r[7]=(s>>>11|a<<5)&8065,this.r[8]=(a>>>8|c<<8)&8191,this.r[9]=c>>>5&127;for(let t=0;t<8;t++)this.pad[t]=oB(e,16+2*t)}process(e,t,r=!1){let{h:n,r:o}=this,i=o[0],s=o[1],a=o[2],c=o[3],l=o[4],d=o[5],u=o[6],p=o[7],f=o[8],h=o[9],m=oB(e,t+0),y=oB(e,t+2),g=oB(e,t+4),w=oB(e,t+6),b=oB(e,t+8),v=oB(e,t+10),_=oB(e,t+12),E=oB(e,t+14),k=n[0]+(8191&m),A=n[1]+((m>>>13|y<<3)&8191),T=n[2]+((y>>>10|g<<6)&8191),x=n[3]+((g>>>7|w<<9)&8191),S=n[4]+((w>>>4|b<<12)&8191),R=n[5]+(b>>>1&8191),I=n[6]+((b>>>14|v<<2)&8191),O=n[7]+((v>>>11|_<<5)&8191),U=n[8]+((_>>>8|E<<8)&8191),N=n[9]+(E>>>5|2048*!r),P=0,D=0+k*i+5*h*A+5*f*T+5*p*x+5*u*S;P=D>>>13,D&=8191,D+=5*d*R+5*l*I+5*c*O+5*a*U+5*s*N,P+=D>>>13,D&=8191;let $=P+k*s+A*i+5*h*T+5*f*x+5*p*S;P=$>>>13,$&=8191,$+=5*u*R+5*d*I+5*l*O+5*c*U+5*a*N,P+=$>>>13,$&=8191;let z=P+k*a+A*s+T*i+5*h*x+5*f*S;P=z>>>13,z&=8191,z+=5*p*R+5*u*I+5*d*O+5*l*U+5*c*N,P+=z>>>13,z&=8191;let j=P+k*c+A*a+T*s+x*i+5*h*S;P=j>>>13,j&=8191,j+=5*f*R+5*p*I+5*u*O+5*d*U+5*l*N,P+=j>>>13,j&=8191;let L=P+k*l+A*c+T*a+x*s+S*i;P=L>>>13,L&=8191,L+=5*h*R+5*f*I+5*p*O+5*u*U+5*d*N,P+=L>>>13,L&=8191;let C=P+k*d+A*l+T*c+x*a+S*s;P=C>>>13,C&=8191,C+=R*i+5*h*I+5*f*O+5*p*U+5*u*N,P+=C>>>13,C&=8191;let V=P+k*u+A*d+T*l+x*c+S*a;P=V>>>13,V&=8191,V+=R*s+I*i+5*h*O+5*f*U+5*p*N,P+=V>>>13,V&=8191;let q=P+k*p+A*u+T*d+x*l+S*c;P=q>>>13,q&=8191,q+=R*a+I*s+O*i+5*h*U+5*f*N,P+=q>>>13,q&=8191;let M=P+k*f+A*p+T*u+x*d+S*l;P=M>>>13,M&=8191,M+=R*c+I*a+O*s+U*i+5*h*N,P+=M>>>13,M&=8191;let Z=P+k*h+A*f+T*p+x*u+S*d;P=Z>>>13,Z&=8191,Z+=R*l+I*c+O*a+U*s+N*i,P+=Z>>>13,Z&=8191,D=8191&(P=(P=(P<<2)+P|0)+D|0),P>>>=13,$+=P,n[0]=D,n[1]=$,n[2]=z,n[3]=j,n[4]=L,n[5]=C,n[6]=V,n[7]=q,n[8]=M,n[9]=Z}finalize(){let{h:e,pad:t}=this,r=new Uint16Array(10),n=e[1]>>>13;e[1]&=8191;for(let t=2;t<10;t++)e[t]+=n,n=e[t]>>>13,e[t]&=8191;e[0]+=5*n,n=e[0]>>>13,e[0]&=8191,e[1]+=n,n=e[1]>>>13,e[1]&=8191,e[2]+=n,r[0]=e[0]+5,n=r[0]>>>13,r[0]&=8191;for(let t=1;t<10;t++)r[t]=e[t]+n,n=r[t]>>>13,r[t]&=8191;r[9]-=8192;let o=(1^n)-1;for(let e=0;e<10;e++)r[e]&=o;o=~o;for(let t=0;t<10;t++)e[t]=e[t]&o|r[t];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let i=e[0]+t[0];e[0]=65535&i;for(let r=1;r<8;r++)i=(e[r]+t[r]|0)+(i>>>16)|0,e[r]=65535&i;oj(r)}update(e){oS(this);let{buffer:t,blockLen:r}=this,n=(e=oD(e)).length;for(let o=0;o<n;){let i=Math.min(r-this.pos,n-o);if(i===r){for(;r<=n-o;o+=r)this.process(e,o);continue}t.set(e.subarray(o,o+i),this.pos),this.pos+=i,o+=i,this.pos===r&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){oj(this.h,this.r,this.buffer,this.pad)}digestInto(e){oS(this);ox(e);let t=this.outputLen;if(e.length<t)throw Error(`digestInto() expects output buffer of length at least ${t}`);this.finished=!0;let{buffer:r,h:n}=this,{pos:o}=this;if(o){for(r[o++]=1;o<16;o++)r[o]=0;this.process(r,0,!0)}this.finalize();let i=0;for(let t=0;t<8;t++)e[i++]=n[t]>>>0,e[i++]=n[t]>>>8;return e}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let r=e.slice(0,t);return this.destroy(),r}}let oG=function(e){let t=(t,r)=>e(r).update(oD(t)).digest(),r=e(new Uint8Array(32));return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=t=>e(t),t}(e=>new oJ(e));function oQ(e,t,r,n,o,i=20){let s=e[0],a=e[1],c=e[2],l=e[3],d=t[0],u=t[1],p=t[2],f=t[3],h=t[4],m=t[5],y=t[6],g=t[7],w=r[0],b=r[1],v=r[2],_=s,E=a,k=c,A=l,T=d,x=u,S=p,R=f,I=h,O=m,U=y,N=g,P=o,D=w,$=b,z=v;for(let e=0;e<i;e+=2)I=I+(P=oZ(P^(_=_+T|0),16))|0,_=_+(T=oZ(T^I,12))|0,I=I+(P=oZ(P^_,8))|0,T=oZ(T^I,7),O=O+(D=oZ(D^(E=E+x|0),16))|0,E=E+(x=oZ(x^O,12))|0,O=O+(D=oZ(D^E,8))|0,x=oZ(x^O,7),U=U+($=oZ($^(k=k+S|0),16))|0,k=k+(S=oZ(S^U,12))|0,U=U+($=oZ($^k,8))|0,S=oZ(S^U,7),N=N+(z=oZ(z^(A=A+R|0),16))|0,A=A+(R=oZ(R^N,12))|0,N=N+(z=oZ(z^A,8))|0,R=oZ(R^N,7),U=U+(z=oZ(z^(_=_+x|0),16))|0,_=_+(x=oZ(x^U,12))|0,U=U+(z=oZ(z^_,8))|0,x=oZ(x^U,7),N=N+(P=oZ(P^(E=E+S|0),16))|0,E=E+(S=oZ(S^N,12))|0,N=N+(P=oZ(P^E,8))|0,S=oZ(S^N,7),I=I+(D=oZ(D^(k=k+R|0),16))|0,k=k+(R=oZ(R^I,12))|0,I=I+(D=oZ(D^k,8))|0,R=oZ(R^I,7),O=O+($=oZ($^(A=A+T|0),16))|0,A=A+(T=oZ(T^O,12))|0,O=O+($=oZ($^A,8))|0,T=oZ(T^O,7);let j=0;n[j++]=s+_|0,n[j++]=a+E|0,n[j++]=c+k|0,n[j++]=l+A|0,n[j++]=d+T|0,n[j++]=u+x|0,n[j++]=p+S|0,n[j++]=f+R|0,n[j++]=h+I|0,n[j++]=m+O|0,n[j++]=y+U|0,n[j++]=g+N|0,n[j++]=o+P|0,n[j++]=w+D|0,n[j++]=b+$|0,n[j++]=v+z|0}let oY=oW(oQ,{counterRight:!1,counterLength:4,allowShortKeys:!1}),oX=oW(oQ,{counterRight:!1,counterLength:8,extendNonceFn:function(e,t,r,n){let o=e[0],i=e[1],s=e[2],a=e[3],c=t[0],l=t[1],d=t[2],u=t[3],p=t[4],f=t[5],h=t[6],m=t[7],y=r[0],g=r[1],w=r[2],b=r[3];for(let e=0;e<20;e+=2)p=p+(y=oZ(y^(o=o+c|0),16))|0,o=o+(c=oZ(c^p,12))|0,p=p+(y=oZ(y^o,8))|0,c=oZ(c^p,7),f=f+(g=oZ(g^(i=i+l|0),16))|0,i=i+(l=oZ(l^f,12))|0,f=f+(g=oZ(g^i,8))|0,l=oZ(l^f,7),h=h+(w=oZ(w^(s=s+d|0),16))|0,s=s+(d=oZ(d^h,12))|0,h=h+(w=oZ(w^s,8))|0,d=oZ(d^h,7),m=m+(b=oZ(b^(a=a+u|0),16))|0,a=a+(u=oZ(u^m,12))|0,m=m+(b=oZ(b^a,8))|0,u=oZ(u^m,7),h=h+(b=oZ(b^(o=o+l|0),16))|0,o=o+(l=oZ(l^h,12))|0,h=h+(b=oZ(b^o,8))|0,l=oZ(l^h,7),m=m+(y=oZ(y^(i=i+d|0),16))|0,i=i+(d=oZ(d^m,12))|0,m=m+(y=oZ(y^i,8))|0,d=oZ(d^m,7),p=p+(g=oZ(g^(s=s+u|0),16))|0,s=s+(u=oZ(u^p,12))|0,p=p+(g=oZ(g^s,8))|0,u=oZ(u^p,7),f=f+(w=oZ(w^(a=a+c|0),16))|0,a=a+(c=oZ(c^f,12))|0,f=f+(w=oZ(w^a,8))|0,c=oZ(c^f,7);let v=0;n[v++]=o,n[v++]=i,n[v++]=s,n[v++]=a,n[v++]=y,n[v++]=g,n[v++]=w,n[v++]=b},allowShortKeys:!1}),o0=new Uint8Array(16),o1=(e,t)=>{e.update(t);let r=t.length%16;r&&e.update(o0.subarray(r))},o2=new Uint8Array(32);function o5(e,t,r,n,o){let i=e(t,r,o2),s=oG.create(i);o&&o1(s,o),o1(s,n);let a=new Uint8Array(16),c=oI(a);o$(c,0,BigInt(o?o.length:0),!0),o$(c,8,BigInt(n.length),!0),s.update(a);let l=s.digest();return oj(i,a),l}let o6=e=>(t,r,n)=>(ox(t,32),ox(r),{encrypt(o,i){let s=o.length,a=s+16;i?ox(i,a):i=new Uint8Array(a),e(t,r,o,i,1);let c=o5(e,t,r,i.subarray(0,-16),n);return i.set(c,s),oj(c),i},decrypt(o,i){let s=o.length,a=s-16;if(s<16)throw Error("encrypted data must be at least 16 bytes");i?ox(i,a):i=new Uint8Array(a);let c=o.subarray(0,-16),l=o.subarray(-16),d=o5(e,t,r,c,n);if(!function(e,t){if(e.length!==t.length)return!1;let r=0;for(let n=0;n<e.length;n++)r|=e[n]^t[n];return 0===r}(l,d))throw Error("invalid tag");return e(t,r,c,i,1),oj(d),i}});o6(oY);let o4=((e,t)=>(Object.assign(t,e),t))({blockSize:64,nonceLength:24,tagLength:16},o6(oX)),o8=y&&"object"==typeof y&&"webcrypto"in y?f.webcrypto:void 0;function o3(){if(o8&&"object"==typeof o8.subtle&&null!=o8.subtle)return o8.subtle;throw Error("crypto.subtle must be defined")}function o9(e){return ok(e.nonceLength),(t,...r)=>({encrypt(n,...o){let{nonceLength:i}=e,s=function(e=32){if(o8&&"function"==typeof o8.getRandomValues)return o8.getRandomValues(new Uint8Array(e));throw Error("crypto.getRandomValues must be defined")}(i),a=e(t,s,...r).encrypt(n,...o),c=function(...e){let t=0;for(let r=0;r<e.length;r++){let n=e[r];ox(n),t+=n.length}let r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){let o=e[t];r.set(o,n),n+=o.length}return r}(s,a);return a.fill(0),c},decrypt(n,...o){let{nonceLength:i}=e,s=n.subarray(0,i),a=n.subarray(i);return e(t,s,...r).decrypt(a,...o)}})}let o7={async encrypt(e,t,r,n){let o=o3(),i=await o.importKey("raw",e,t,!0,["encrypt"]);return new Uint8Array(await o.encrypt(r,i,n))},async decrypt(e,t,r,n){let o=o3(),i=await o.importKey("raw",e,t,!0,["decrypt"]);return new Uint8Array(await o.decrypt(r,i,n))}},ie={CBC:"AES-CBC",CTR:"AES-CTR",GCM:"AES-GCM"};function it(e){return(t,r,n)=>{ox(t),ox(r);let o={name:e,length:8*t.length},i=function(e,t,r){if(e===ie.CBC)return{name:ie.CBC,iv:t};if(e===ie.CTR)return{name:ie.CTR,counter:t,length:64};if(e===ie.GCM)if(r)return{name:ie.GCM,iv:t,additionalData:r};else return{name:ie.GCM,iv:t};throw Error("unknown aes block mode")}(e,r,n);return{encrypt:e=>(ox(e),o7.encrypt(t,o,i,e)),decrypt:e=>(ox(e),o7.decrypt(t,o,i,e))}}}it(ie.CBC),it(ie.CTR),it(ie.GCM);let ir=require("node:buffer"),io=new TextEncoder,ii=new TextDecoder;function is(...e){let t=new Uint8Array(e.reduce((e,{length:t})=>e+t,0)),r=0;for(let n of e)t.set(n,r),r+=n.length;return t}let ia=e=>ir.Buffer.from(e).toString("base64url"),ic=e=>new Uint8Array(ir.Buffer.from(function(e){let t=e;return t instanceof Uint8Array&&(t=ii.decode(t)),t}(e),"base64url")),il=require("node:util");class id extends Error{static code="ERR_JOSE_GENERIC";code="ERR_JOSE_GENERIC";constructor(e,t){super(e,t),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}class iu extends id{static code="ERR_JWT_CLAIM_VALIDATION_FAILED";code="ERR_JWT_CLAIM_VALIDATION_FAILED";claim;reason;payload;constructor(e,t,r="unspecified",n="unspecified"){super(e,{cause:{claim:r,reason:n,payload:t}}),this.claim=r,this.reason=n,this.payload=t}}class ip extends id{static code="ERR_JWT_EXPIRED";code="ERR_JWT_EXPIRED";claim;reason;payload;constructor(e,t,r="unspecified",n="unspecified"){super(e,{cause:{claim:r,reason:n,payload:t}}),this.claim=r,this.reason=n,this.payload=t}}class ih extends id{static code="ERR_JOSE_ALG_NOT_ALLOWED";code="ERR_JOSE_ALG_NOT_ALLOWED"}class im extends id{static code="ERR_JOSE_NOT_SUPPORTED";code="ERR_JOSE_NOT_SUPPORTED"}class iy extends id{static code="ERR_JWS_INVALID";code="ERR_JWS_INVALID"}class ig extends id{static code="ERR_JWT_INVALID";code="ERR_JWT_INVALID"}class iw extends id{static code="ERR_JWKS_INVALID";code="ERR_JWKS_INVALID"}class ib extends id{static code="ERR_JWKS_NO_MATCHING_KEY";code="ERR_JWKS_NO_MATCHING_KEY";constructor(e="no applicable key found in the JSON Web Key Set",t){super(e,t)}}class iv extends id{[Symbol.asyncIterator];static code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";constructor(e="multiple matching keys found in the JSON Web Key Set",t){super(e,t)}}class i_ extends id{static code="ERR_JWKS_TIMEOUT";code="ERR_JWKS_TIMEOUT";constructor(e="request timed out",t){super(e,t)}}class iE extends id{static code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";constructor(e="signature verification failed",t){super(e,t)}}function ik(e){switch(e){case"PS256":case"RS256":case"ES256":case"ES256K":return"sha256";case"PS384":case"RS384":case"ES384":return"sha384";case"PS512":case"RS512":case"ES512":return"sha512";case"Ed25519":case"EdDSA":return;default:throw new im(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}let iA=f.webcrypto,iT=e=>il.types.isCryptoKey(e),ix=e=>il.types.isKeyObject(e);function iS(e,t,...r){if((r=r.filter(Boolean)).length>2){let t=r.pop();e+=`one of type ${r.join(", ")}, or ${t}.`}else 2===r.length?e+=`one of type ${r[0]} or ${r[1]}.`:e+=`of type ${r[0]}.`;return null==t?e+=` Received ${t}`:"function"==typeof t&&t.name?e+=` Received function ${t.name}`:"object"==typeof t&&null!=t&&t.constructor?.name&&(e+=` Received an instance of ${t.constructor.name}`),e}let iR=(e,...t)=>iS("Key must be ",e,...t);function iI(e,t,...r){return iS(`Key for the ${e} algorithm must be `,t,...r)}let iO=e=>ix(e)||iT(e),iU=["KeyObject"];function iN(e){if("object"!=typeof e||null===e||"[object Object]"!==Object.prototype.toString.call(e))return!1;if(null===Object.getPrototypeOf(e))return!0;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function iP(e){return iN(e)&&"string"==typeof e.kty}(globalThis.CryptoKey||iA?.CryptoKey)&&iU.push("CryptoKey"),new WeakMap;let iD=e=>{switch(e){case"prime256v1":return"P-256";case"secp384r1":return"P-384";case"secp521r1":return"P-521";case"secp256k1":return"secp256k1";default:throw new im("Unsupported key curve for this operation")}},i$=(e,t)=>{let r;if(iT(e))r=f.KeyObject.from(e);else if(ix(e))r=e;else if(iP(e))return e.crv;else throw TypeError(iR(e,...iU));if("secret"===r.type)throw TypeError('only "private" or "public" type keys can be used for this operation');switch(r.asymmetricKeyType){case"ed25519":case"ed448":return`Ed${r.asymmetricKeyType.slice(2)}`;case"x25519":case"x448":return`X${r.asymmetricKeyType.slice(1)}`;case"ec":{let e=r.asymmetricKeyDetails.namedCurve;if(t)return e;return iD(e)}default:throw TypeError("Invalid asymmetric key type for this operation")}},iz=(e,t)=>{let r;try{r=e instanceof f.KeyObject?e.asymmetricKeyDetails?.modulusLength:Buffer.from(e.n,"base64url").byteLength<<3}catch{}if("number"!=typeof r||r<2048)throw TypeError(`${t} requires key modulusLength to be 2048 bits or larger`)},ij=new Map([["ES256","P-256"],["ES256K","secp256k1"],["ES384","P-384"],["ES512","P-521"]]);function iL(e,t){let r,n,o,i;if(t instanceof f.KeyObject)r=t.asymmetricKeyType,n=t.asymmetricKeyDetails;else switch(o=!0,t.kty){case"RSA":r="rsa";break;case"EC":r="ec";break;case"OKP":if("Ed25519"===t.crv){r="ed25519";break}if("Ed448"===t.crv){r="ed448";break}throw TypeError("Invalid key for this operation, its crv must be Ed25519 or Ed448");default:throw TypeError("Invalid key for this operation, its kty must be RSA, OKP, or EC")}switch(e){case"Ed25519":if("ed25519"!==r)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ed25519");break;case"EdDSA":if(!["ed25519","ed448"].includes(r))throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ed25519 or ed448");break;case"RS256":case"RS384":case"RS512":if("rsa"!==r)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa");iz(t,e);break;case"PS256":case"PS384":case"PS512":if("rsa-pss"===r){let{hashAlgorithm:t,mgf1HashAlgorithm:r,saltLength:o}=n,i=parseInt(e.slice(-3),10);if(void 0!==t&&(t!==`sha${i}`||r!==t))throw TypeError(`Invalid key for this operation, its RSA-PSS parameters do not meet the requirements of "alg" ${e}`);if(void 0!==o&&o>i>>3)throw TypeError(`Invalid key for this operation, its RSA-PSS parameter saltLength does not meet the requirements of "alg" ${e}`)}else if("rsa"!==r)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa or rsa-pss");iz(t,e),i={padding:f.constants.RSA_PKCS1_PSS_PADDING,saltLength:f.constants.RSA_PSS_SALTLEN_DIGEST};break;case"ES256":case"ES256K":case"ES384":case"ES512":{if("ec"!==r)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ec");let n=i$(t),o=ij.get(e);if(n!==o)throw TypeError(`Invalid key curve for the algorithm, its curve must be ${o}, got ${n}`);i={dsaEncoding:"ieee-p1363"};break}default:throw new im(`alg ${e} is not supported either by JOSE or your javascript runtime`)}return o?{format:"jwk",key:t,...i}:i?{...i,key:t}:t}function iC(e,t="algorithm.name"){return TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`)}function iV(e,t){return e.name===t}function iq(e){return parseInt(e.name.slice(4),10)}function iM(e,t,r){if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw TypeError(iR(t,...iU));return(0,f.createSecretKey)(t)}if(t instanceof f.KeyObject)return t;if(iT(t))return!function(e,t,...r){switch(t){case"HS256":case"HS384":case"HS512":{if(!iV(e.algorithm,"HMAC"))throw iC("HMAC");let r=parseInt(t.slice(2),10);if(iq(e.algorithm.hash)!==r)throw iC(`SHA-${r}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!iV(e.algorithm,"RSASSA-PKCS1-v1_5"))throw iC("RSASSA-PKCS1-v1_5");let r=parseInt(t.slice(2),10);if(iq(e.algorithm.hash)!==r)throw iC(`SHA-${r}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!iV(e.algorithm,"RSA-PSS"))throw iC("RSA-PSS");let r=parseInt(t.slice(2),10);if(iq(e.algorithm.hash)!==r)throw iC(`SHA-${r}`,"algorithm.hash");break}case"EdDSA":if("Ed25519"!==e.algorithm.name&&"Ed448"!==e.algorithm.name)throw iC("Ed25519 or Ed448");break;case"Ed25519":if(!iV(e.algorithm,"Ed25519"))throw iC("Ed25519");break;case"ES256":case"ES384":case"ES512":{if(!iV(e.algorithm,"ECDSA"))throw iC("ECDSA");let r=function(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw Error("unreachable")}}(t);if(e.algorithm.namedCurve!==r)throw iC(r,"algorithm.namedCurve");break}default:throw TypeError("CryptoKey does not support this operation")}var n=e,o=r;if(o.length&&!o.some(e=>n.usages.includes(e))){let e="CryptoKey does not support this operation, its usages must include ";if(o.length>2){let t=o.pop();e+=`one of ${o.join(", ")}, or ${t}.`}else 2===o.length?e+=`one of ${o[0]} or ${o[1]}.`:e+=`${o[0]}.`;throw TypeError(e)}}(t,e,r),f.KeyObject.from(t);if(iP(t))return e.startsWith("HS")?(0,f.createSecretKey)(Buffer.from(t.k,"base64url")):t;throw TypeError(iR(t,...iU,"Uint8Array","JSON Web Key"))}let iZ=(0,il.promisify)(f.sign),iH=async(e,t,r)=>{let n=iM(e,t,"sign");if(e.startsWith("HS")){let t=f.createHmac(function(e){switch(e){case"HS256":return"sha256";case"HS384":return"sha384";case"HS512":return"sha512";default:throw new im(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}(e),n);return t.update(r),t.digest()}return iZ(ik(e),r,iL(e,n))},iF=(...e)=>{let t,r=e.filter(Boolean);if(0===r.length||1===r.length)return!0;for(let e of r){let r=Object.keys(e);if(!t||0===t.size){t=new Set(r);continue}for(let e of r){if(t.has(e))return!1;t.add(e)}}return!0},iK=e=>e?.[Symbol.toStringTag],iW=(e,t,r)=>{if(void 0!==t.use&&"sig"!==t.use)throw TypeError("Invalid key for this operation, when present its use must be sig");if(void 0!==t.key_ops&&t.key_ops.includes?.(r)!==!0)throw TypeError(`Invalid key for this operation, when present its key_ops must include ${r}`);if(void 0!==t.alg&&t.alg!==e)throw TypeError(`Invalid key for this operation, when present its alg must be ${e}`);return!0},iB=(e,t,r,n)=>{if(!(t instanceof Uint8Array)){if(n&&iP(t)){if(function(e){return iP(e)&&"oct"===e.kty&&"string"==typeof e.k}(t)&&iW(e,t,r))return;throw TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!iO(t))throw TypeError(iI(e,t,...iU,"Uint8Array",n?"JSON Web Key":null));if("secret"!==t.type)throw TypeError(`${iK(t)} instances for symmetric algorithms must be of type "secret"`)}},iJ=(e,t,r,n)=>{if(n&&iP(t))switch(r){case"sign":if(function(e){return"oct"!==e.kty&&"string"==typeof e.d}(t)&&iW(e,t,r))return;throw TypeError("JSON Web Key for this operation be a private JWK");case"verify":if(function(e){return"oct"!==e.kty&&void 0===e.d}(t)&&iW(e,t,r))return;throw TypeError("JSON Web Key for this operation be a public JWK")}if(!iO(t))throw TypeError(iI(e,t,...iU,n?"JSON Web Key":null));if("secret"===t.type)throw TypeError(`${iK(t)} instances for asymmetric algorithms must not be of type "secret"`);if("sign"===r&&"public"===t.type)throw TypeError(`${iK(t)} instances for asymmetric algorithm signing must be of type "private"`);if("decrypt"===r&&"public"===t.type)throw TypeError(`${iK(t)} instances for asymmetric algorithm decryption must be of type "private"`);if(t.algorithm&&"verify"===r&&"private"===t.type)throw TypeError(`${iK(t)} instances for asymmetric algorithm verifying must be of type "public"`);if(t.algorithm&&"encrypt"===r&&"private"===t.type)throw TypeError(`${iK(t)} instances for asymmetric algorithm encryption must be of type "public"`)};function iG(e,t,r,n){t.startsWith("HS")||"dir"===t||t.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(t)?iB(t,r,n,e):iJ(t,r,n,e)}iG.bind(void 0,!1);let iQ=iG.bind(void 0,!0),iY=function(e,t,r,n,o){let i;if(void 0!==o.crit&&n?.crit===void 0)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!n||void 0===n.crit)return new Set;if(!Array.isArray(n.crit)||0===n.crit.length||n.crit.some(e=>"string"!=typeof e||0===e.length))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let s of(i=void 0!==r?new Map([...Object.entries(r),...t.entries()]):t,n.crit)){if(!i.has(s))throw new im(`Extension Header Parameter "${s}" is not recognized`);if(void 0===o[s])throw new e(`Extension Header Parameter "${s}" is missing`);if(i.get(s)&&void 0===n[s])throw new e(`Extension Header Parameter "${s}" MUST be integrity protected`)}return new Set(n.crit)};class iX{_payload;_protectedHeader;_unprotectedHeader;constructor(e){if(!(e instanceof Uint8Array))throw TypeError("payload must be an instance of Uint8Array");this._payload=e}setProtectedHeader(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}async sign(e,t){let r;if(!this._protectedHeader&&!this._unprotectedHeader)throw new iy("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!iF(this._protectedHeader,this._unprotectedHeader))throw new iy("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let n={...this._protectedHeader,...this._unprotectedHeader},o=iY(iy,new Map([["b64",!0]]),t?.crit,this._protectedHeader,n),i=!0;if(o.has("b64")&&"boolean"!=typeof(i=this._protectedHeader.b64))throw new iy('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:s}=n;if("string"!=typeof s||!s)throw new iy('JWS "alg" (Algorithm) Header Parameter missing or invalid');iQ(s,e,"sign");let a=this._payload;i&&(a=io.encode(ia(a)));let c=is(r=this._protectedHeader?io.encode(ia(JSON.stringify(this._protectedHeader))):io.encode(""),io.encode("."),a),l={signature:ia(await iH(s,e,c)),payload:""};return i&&(l.payload=ii.decode(a)),this._unprotectedHeader&&(l.header=this._unprotectedHeader),this._protectedHeader&&(l.protected=ii.decode(r)),l}}class i0{_flattened;constructor(e){this._flattened=new iX(e)}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}async sign(e,t){let r=await this._flattened.sign(e,t);if(void 0===r.payload)throw TypeError("use the flattened module for creating JWS with b64: false");return`${r.protected}.${r.payload}.${r.signature}`}}let i1=e=>Math.floor(e.getTime()/1e3),i2=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,i5=e=>{let t,r=i2.exec(e);if(!r||r[4]&&r[1])throw TypeError("Invalid time period format");let n=parseFloat(r[2]);switch(r[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":t=Math.round(n);break;case"minute":case"minutes":case"min":case"mins":case"m":t=Math.round(60*n);break;case"hour":case"hours":case"hr":case"hrs":case"h":t=Math.round(3600*n);break;case"day":case"days":case"d":t=Math.round(86400*n);break;case"week":case"weeks":case"w":t=Math.round(604800*n);break;default:t=Math.round(0x1e187e0*n)}return"-"===r[1]||"ago"===r[4]?-t:t};function i6(e,t){if(!Number.isFinite(t))throw TypeError(`Invalid ${e} input`);return t}class i4{_payload;constructor(e={}){if(!iN(e))throw TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return"number"==typeof e?this._payload={...this._payload,nbf:i6("setNotBefore",e)}:e instanceof Date?this._payload={...this._payload,nbf:i6("setNotBefore",i1(e))}:this._payload={...this._payload,nbf:i1(new Date)+i5(e)},this}setExpirationTime(e){return"number"==typeof e?this._payload={...this._payload,exp:i6("setExpirationTime",e)}:e instanceof Date?this._payload={...this._payload,exp:i6("setExpirationTime",i1(e))}:this._payload={...this._payload,exp:i1(new Date)+i5(e)},this}setIssuedAt(e){return void 0===e?this._payload={...this._payload,iat:i1(new Date)}:e instanceof Date?this._payload={...this._payload,iat:i6("setIssuedAt",i1(e))}:"string"==typeof e?this._payload={...this._payload,iat:i6("setIssuedAt",i1(new Date)+i5(e))}:this._payload={...this._payload,iat:i6("setIssuedAt",e)},this}}class i8 extends i4{_protectedHeader;setProtectedHeader(e){return this._protectedHeader=e,this}async sign(e,t){let r=new i0(io.encode(JSON.stringify(this._payload)));if(r.setProtectedHeader(this._protectedHeader),Array.isArray(this._protectedHeader?.crit)&&this._protectedHeader.crit.includes("b64")&&!1===this._protectedHeader.b64)throw new ig("JWTs MUST NOT use unencoded payload");return r.sign(e,t)}}function i3(e){switch(e){case"a-z":return"abcdefghijklmnopqrstuvwxyz";case"A-Z":return"ABCDEFGHIJKLMNOPQRSTUVWXYZ";case"0-9":return"0123456789";case"-_":return"-_";default:throw Error(`Unsupported alphabet: ${e}`)}}function i9(...e){let t=e.map(i3).join("");if(0===t.length)throw Error("No valid characters provided for random string generation.");let r=t.length;return(e,...n)=>{let o;if(e<=0)throw Error("Length must be a positive integer.");let i=t,s=r;n.length>0&&(s=(i=n.map(i3).join("")).length);let a=Math.floor(256/s)*s,c=new Uint8Array(2*e),l=c.length,d="",u=l;for(;d.length<e;)u>=l&&(w(c),u=0),(o=c[u++])<a&&(d+=i[o%s]);return d}}let i7=i9("a-z","0-9","A-Z","-_");async function se(e,t,r=3600){return await new i8(e).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime(Math.floor(Date.now()/1e3)+r).sign(new TextEncoder().encode(t))}let st=async({key:e,data:t})=>{let r=await oE("SHA-256").digest(e),n=oP(t);return function(e){ox(e);let t="";for(let r=0;r<e.length;r++)t+=oO[e[r]];return t}(o9(o4)(new Uint8Array(r)).encrypt(n))},sr=async({key:e,data:t})=>{let r=await oE("SHA-256").digest(e),n=function(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);let t=e.length,r=t/2;if(t%2)throw Error("padded hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(r);for(let t=0,o=0;t<r;t++,o+=2){let r=oN(e.charCodeAt(o)),i=oN(e.charCodeAt(o+1));if(void 0===r||void 0===i)throw Error('hex string expected, got non-hex character "'+(e[o]+e[o+1])+'" at index '+o);n[t]=16*r+i}return n}(t),o=o9(o4)(new Uint8Array(r));return new TextDecoder().decode(o.decrypt(n))};var sn=Object.defineProperty,so=Object.defineProperties,si=Object.getOwnPropertyDescriptors,ss=Object.getOwnPropertySymbols,sa=Object.prototype.hasOwnProperty,sc=Object.prototype.propertyIsEnumerable,sl=(e,t,r)=>t in e?sn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,sd=(e,t)=>{for(var r in t||(t={}))sa.call(t,r)&&sl(e,r,t[r]);if(ss)for(var r of ss(t))sc.call(t,r)&&sl(e,r,t[r]);return e},su=(e,t)=>so(e,si(t)),sp=class extends Error{constructor(e,t,r){super(t||e.toString(),{cause:r}),this.status=e,this.statusText=t,this.error=r}},sf=async(e,t)=>{var r,n,o,i,s,a;let c=t||{},l={onRequest:[null==t?void 0:t.onRequest],onResponse:[null==t?void 0:t.onResponse],onSuccess:[null==t?void 0:t.onSuccess],onError:[null==t?void 0:t.onError],onRetry:[null==t?void 0:t.onRetry]};if(!t||!(null==t?void 0:t.plugins))return{url:e,options:c,hooks:l};for(let d of(null==t?void 0:t.plugins)||[]){if(d.init){let n=await (null==(r=d.init)?void 0:r.call(d,e.toString(),t));c=n.options||c,e=n.url}l.onRequest.push(null==(n=d.hooks)?void 0:n.onRequest),l.onResponse.push(null==(o=d.hooks)?void 0:o.onResponse),l.onSuccess.push(null==(i=d.hooks)?void 0:i.onSuccess),l.onError.push(null==(s=d.hooks)?void 0:s.onError),l.onRetry.push(null==(a=d.hooks)?void 0:a.onRetry)}return{url:e,options:c,hooks:l}},sh=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(){return this.options.delay}},sm=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(e){return Math.min(this.options.maxDelay,this.options.baseDelay*2**e)}},sy=async e=>{let t={},r=async e=>"function"==typeof e?await e():e;if(null==e?void 0:e.auth){if("Bearer"===e.auth.type){let n=await r(e.auth.token);if(!n)return t;t.authorization=`Bearer ${n}`}else if("Basic"===e.auth.type){let n=r(e.auth.username),o=r(e.auth.password);if(!n||!o)return t;t.authorization=`Basic ${btoa(`${n}:${o}`)}`}else if("Custom"===e.auth.type){let n=r(e.auth.value);if(!n)return t;t.authorization=`${r(e.auth.prefix)} ${n}`}}return t},sg=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function sw(e){if(void 0===e)return!1;let t=typeof e;return"string"===t||"number"===t||"boolean"===t||null===t||"object"===t&&(!!Array.isArray(e)||!e.buffer&&(e.constructor&&"Object"===e.constructor.name||"function"==typeof e.toJSON))}function sb(e){try{return JSON.parse(e)}catch(t){return e}}function sv(e){return"function"==typeof e}async function s_(e){let t=new Headers(null==e?void 0:e.headers);for(let[r,n]of Object.entries(await sy(e)||{}))t.set(r,n);if(!t.has("content-type")){let r=sw(null==e?void 0:e.body)?"application/json":null;r&&t.set("content-type",r)}return t}var sE=class e extends Error{constructor(t,r){super(r||JSON.stringify(t,null,2)),this.issues=t,Object.setPrototypeOf(this,e.prototype)}};async function sk(e,t){let r=await e["~standard"].validate(t);if(r.issues)throw new sE(r.issues);return r.value}var sA=["get","post","put","patch","delete"],sT=async(e,t)=>{var r,n,o,i,s,a,c,l;let{hooks:d,url:u,options:p}=await sf(e,t),f=function(e){if(null==e?void 0:e.customFetchImpl)return e.customFetchImpl;if("undefined"!=typeof globalThis&&sv(globalThis.fetch))return globalThis.fetch;if("undefined"!=typeof window&&sv(window.fetch))return window.fetch;throw Error("No fetch implementation found")}(p),h=new AbortController,m=null!=(r=p.signal)?r:h.signal,y=function(e,t){let{baseURL:r,params:n,query:o}=t||{query:{},params:{},baseURL:""},i=e.startsWith("http")?e.split("/").slice(0,3).join("/"):r||"";if(e.startsWith("@")){let t=e.toString().split("@")[1].split("/")[0];sA.includes(t)&&(e=e.replace(`@${t}/`,"/"))}i.endsWith("/")||(i+="/");let[s,a]=e.replace(i,"").split("?"),c=new URLSearchParams(a);for(let[e,t]of Object.entries(o||{}))null!=t&&c.set(e,String(t));if(n)if(Array.isArray(n))for(let[e,t]of s.split("/").filter(e=>e.startsWith(":")).entries()){let r=n[e];s=s.replace(t,r)}else for(let[e,t]of Object.entries(n))s=s.replace(`:${e}`,String(t));(s=s.split("/").map(encodeURIComponent).join("/")).startsWith("/")&&(s=s.slice(1));let l=c.toString();return(l=l.length>0?`?${l}`.replace(/\+/g,"%20"):"",i.startsWith("http"))?new URL(`${s}${l}`,i):`${i}${s}${l}`}(u,p),g=function(e){if(!(null==e?void 0:e.body))return null;let t=new Headers(null==e?void 0:e.headers);if(sw(e.body)&&!t.has("content-type")){for(let[t,r]of Object.entries(null==e?void 0:e.body))r instanceof Date&&(e.body[t]=r.toISOString());return JSON.stringify(e.body)}return e.body}(p),w=await s_(p),b=function(e,t){var r;if(null==t?void 0:t.method)return t.method.toUpperCase();if(e.startsWith("@")){let n=null==(r=e.split("@")[1])?void 0:r.split("/")[0];return sA.includes(n)?n.toUpperCase():(null==t?void 0:t.body)?"POST":"GET"}return(null==t?void 0:t.body)?"POST":"GET"}(u,p),v=su(sd({},p),{url:y,headers:w,body:g,method:b,signal:m});for(let e of d.onRequest)if(e){let t=await e(v);t instanceof Object&&(v=t)}("pipeTo"in v&&"function"==typeof v.pipeTo||"function"==typeof(null==(n=null==t?void 0:t.body)?void 0:n.pipe))&&!("duplex"in v)&&(v.duplex="half");let{clearTimeout:_}=function(e,t){let r;return!(null==e?void 0:e.signal)&&(null==e?void 0:e.timeout)&&(r=setTimeout(()=>null==t?void 0:t.abort(),null==e?void 0:e.timeout)),{abortTimeout:r,clearTimeout:()=>{r&&clearTimeout(r)}}}(p,h),E=await f(v.url,v);_();let k={response:E,request:v};for(let e of d.onResponse)if(e){let r=await e(su(sd({},k),{response:(null==(o=null==t?void 0:t.hookOptions)?void 0:o.cloneResponse)?E.clone():E}));r instanceof Response?E=r:r instanceof Object&&(E=r.response)}if(E.ok){if("HEAD"===v.method)return{data:"",error:null};let e=function(e){let t=e.headers.get("content-type"),r=new Set(["image/svg","application/xml","application/xhtml","application/html"]);if(!t)return"json";let n=t.split(";").shift()||"";return sg.test(n)?"json":r.has(n)||n.startsWith("text/")?"text":"blob"}(E),r={data:"",response:E,request:v};if("json"===e||"text"===e){let e=await E.text(),t=null!=(i=v.jsonParser)?i:sb;r.data=await t(e)}else r.data=await E[e]();for(let e of((null==v?void 0:v.output)&&v.output&&!v.disableValidation&&(r.data=await sk(v.output,r.data)),d.onSuccess))e&&await e(su(sd({},r),{response:(null==(s=null==t?void 0:t.hookOptions)?void 0:s.cloneResponse)?E.clone():E}));return(null==t?void 0:t.throw)?r.data:{data:r.data,error:null}}let A=null!=(a=null==t?void 0:t.jsonParser)?a:sb,T=await E.text(),x=function(e){try{return JSON.parse(e),!0}catch(e){return!1}}(T),S=x?await A(T):null,R={response:E,responseText:T,request:v,error:su(sd({},S),{status:E.status,statusText:E.statusText})};for(let e of d.onError)e&&await e(su(sd({},R),{response:(null==(c=null==t?void 0:t.hookOptions)?void 0:c.cloneResponse)?E.clone():E}));if(null==t?void 0:t.retry){let r=function(e){if("number"==typeof e)return new sh({type:"linear",attempts:e,delay:1e3});switch(e.type){case"linear":return new sh(e);case"exponential":return new sm(e);default:throw Error("Invalid retry strategy")}}(t.retry),n=null!=(l=t.retryAttempt)?l:0;if(await r.shouldAttemptRetry(n,E)){for(let e of d.onRetry)e&&await e(k);let o=r.getDelay(n);return await new Promise(e=>setTimeout(e,o)),await sT(e,su(sd({},t),{retryAttempt:n+1}))}}if(null==t?void 0:t.throw)throw new sp(E.status,E.statusText,x?S:T);return{data:null,error:su(sd({},S),{status:E.status,statusText:E.statusText})}};let sx=(0,il.promisify)(f.verify),sS=async(e,t,r,n)=>{let o=iM(e,t,"verify");if(e.startsWith("HS")){let t=await iH(e,o,n);try{return f.timingSafeEqual(r,t)}catch{return!1}}let i=ik(e),s=iL(e,o);try{return await sx(i,n,s,r)}catch{return!1}},sR=(e,t)=>{if(void 0!==t&&(!Array.isArray(t)||t.some(e=>"string"!=typeof e)))throw TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)},sI=e=>e.d?(0,f.createPrivateKey)({format:"jwk",key:e}):(0,f.createPublicKey)({format:"jwk",key:e});async function sO(e,t){if(!iN(e))throw TypeError("JWK must be an object");switch(t||=e.alg,e.kty){case"oct":if("string"!=typeof e.k||!e.k)throw TypeError('missing "k" (Key Value) Parameter value');return ic(e.k);case"RSA":if("oth"in e&&void 0!==e.oth)throw new im('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return sI({...e,alg:t});default:throw new im('Unsupported "kty" (Key Type) Parameter value')}}async function sU(e,t,r){let n,o;if(!iN(e))throw new iy("Flattened JWS must be an object");if(void 0===e.protected&&void 0===e.header)throw new iy('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==e.protected&&"string"!=typeof e.protected)throw new iy("JWS Protected Header incorrect type");if(void 0===e.payload)throw new iy("JWS Payload missing");if("string"!=typeof e.signature)throw new iy("JWS Signature missing or incorrect type");if(void 0!==e.header&&!iN(e.header))throw new iy("JWS Unprotected Header incorrect type");let i={};if(e.protected)try{let t=ic(e.protected);i=JSON.parse(ii.decode(t))}catch{throw new iy("JWS Protected Header is invalid")}if(!iF(i,e.header))throw new iy("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let s={...i,...e.header},a=iY(iy,new Map([["b64",!0]]),r?.crit,i,s),c=!0;if(a.has("b64")&&"boolean"!=typeof(c=i.b64))throw new iy('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:l}=s;if("string"!=typeof l||!l)throw new iy('JWS "alg" (Algorithm) Header Parameter missing or invalid');let d=r&&sR("algorithms",r.algorithms);if(d&&!d.has(l))throw new ih('"alg" (Algorithm) Header Parameter value not allowed');if(c){if("string"!=typeof e.payload)throw new iy("JWS Payload must be a string")}else if("string"!=typeof e.payload&&!(e.payload instanceof Uint8Array))throw new iy("JWS Payload must be a string or an Uint8Array instance");let u=!1;"function"==typeof t?(t=await t(i,e),u=!0,iQ(l,t,"verify"),iP(t)&&(t=await sO(t,l))):iQ(l,t,"verify");let p=is(io.encode(e.protected??""),io.encode("."),"string"==typeof e.payload?io.encode(e.payload):e.payload);try{n=ic(e.signature)}catch{throw new iy("Failed to base64url decode the signature")}if(!await sS(l,t,n,p))throw new iE;if(c)try{o=ic(e.payload)}catch{throw new iy("Failed to base64url decode the payload")}else o="string"==typeof e.payload?io.encode(e.payload):e.payload;let f={payload:o};return(void 0!==e.protected&&(f.protectedHeader=i),void 0!==e.header&&(f.unprotectedHeader=e.header),u)?{...f,key:t}:f}async function sN(e,t,r){if(e instanceof Uint8Array&&(e=ii.decode(e)),"string"!=typeof e)throw new iy("Compact JWS must be a string or Uint8Array");let{0:n,1:o,2:i,length:s}=e.split(".");if(3!==s)throw new iy("Invalid Compact JWS");let a=await sU({payload:o,protected:n,signature:i},t,r),c={payload:a.payload,protectedHeader:a.protectedHeader};return"function"==typeof t?{...c,key:a.key}:c}let sP=e=>e.toLowerCase().replace(/^application\//,""),sD=(e,t)=>"string"==typeof e?t.includes(e):!!Array.isArray(e)&&t.some(Set.prototype.has.bind(new Set(e))),s$=(e,t,r={})=>{let n,o;try{n=JSON.parse(ii.decode(t))}catch{}if(!iN(n))throw new ig("JWT Claims Set must be a top-level JSON object");let{typ:i}=r;if(i&&("string"!=typeof e.typ||sP(e.typ)!==sP(i)))throw new iu('unexpected "typ" JWT header value',n,"typ","check_failed");let{requiredClaims:s=[],issuer:a,subject:c,audience:l,maxTokenAge:d}=r,u=[...s];for(let e of(void 0!==d&&u.push("iat"),void 0!==l&&u.push("aud"),void 0!==c&&u.push("sub"),void 0!==a&&u.push("iss"),new Set(u.reverse())))if(!(e in n))throw new iu(`missing required "${e}" claim`,n,e,"missing");if(a&&!(Array.isArray(a)?a:[a]).includes(n.iss))throw new iu('unexpected "iss" claim value',n,"iss","check_failed");if(c&&n.sub!==c)throw new iu('unexpected "sub" claim value',n,"sub","check_failed");if(l&&!sD(n.aud,"string"==typeof l?[l]:l))throw new iu('unexpected "aud" claim value',n,"aud","check_failed");switch(typeof r.clockTolerance){case"string":o=i5(r.clockTolerance);break;case"number":o=r.clockTolerance;break;case"undefined":o=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:p}=r,f=i1(p||new Date);if((void 0!==n.iat||d)&&"number"!=typeof n.iat)throw new iu('"iat" claim must be a number',n,"iat","invalid");if(void 0!==n.nbf){if("number"!=typeof n.nbf)throw new iu('"nbf" claim must be a number',n,"nbf","invalid");if(n.nbf>f+o)throw new iu('"nbf" claim timestamp check failed',n,"nbf","check_failed")}if(void 0!==n.exp){if("number"!=typeof n.exp)throw new iu('"exp" claim must be a number',n,"exp","invalid");if(n.exp<=f-o)throw new ip('"exp" claim timestamp check failed',n,"exp","check_failed")}if(d){let e=f-n.iat;if(e-o>("number"==typeof d?d:i5(d)))throw new ip('"iat" claim timestamp check failed (too far in the past)',n,"iat","check_failed");if(e<0-o)throw new iu('"iat" claim timestamp check failed (it should be in the past)',n,"iat","check_failed")}return n};async function sz(e,t,r){let n=await sN(e,t,r);if(n.protectedHeader.crit?.includes("b64")&&!1===n.protectedHeader.b64)throw new ig("JWTs MUST NOT use unencoded payload");let o={payload:s$(n.protectedHeader,n.payload,r),protectedHeader:n.protectedHeader};return"function"==typeof t?{...o,key:n.key}:o}let sj=require("node:http"),sL=require("node:https"),sC=require("node:events"),sV=async(e,t,r)=>{let n;switch(e.protocol){case"https:":n=sL.get;break;case"http:":n=sj.get;break;default:throw TypeError("Unsupported URL protocol.")}let{agent:o,headers:i}=r,s=n(e.href,{agent:o,timeout:t,headers:i}),[a]=await Promise.race([(0,sC.once)(s,"response"),(0,sC.once)(s,"timeout")]);if(!a)throw s.destroy(),new i_;if(200!==a.statusCode)throw new id("Expected 200 OK from the JSON Web Key Set HTTP response");let c=[];for await(let e of a)c.push(e);try{return JSON.parse(ii.decode(is(...c)))}catch{throw new id("Failed to parse the JSON Web Key Set HTTP response as JSON")}};function sq(e){return iN(e)}function sM(e){return"function"==typeof structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e))}class sZ{_jwks;_cached=new WeakMap;constructor(e){if(!function(e){return e&&"object"==typeof e&&Array.isArray(e.keys)&&e.keys.every(sq)}(e))throw new iw("JSON Web Key Set malformed");this._jwks=sM(e)}async getKey(e,t){let{alg:r,kid:n}={...e,...t?.header},o=function(e){switch("string"==typeof e&&e.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new im('Unsupported "alg" value for a JSON Web Key Set')}}(r),i=this._jwks.keys.filter(e=>{let t=o===e.kty;if(t&&"string"==typeof n&&(t=n===e.kid),t&&"string"==typeof e.alg&&(t=r===e.alg),t&&"string"==typeof e.use&&(t="sig"===e.use),t&&Array.isArray(e.key_ops)&&(t=e.key_ops.includes("verify")),t)switch(r){case"ES256":t="P-256"===e.crv;break;case"ES256K":t="secp256k1"===e.crv;break;case"ES384":t="P-384"===e.crv;break;case"ES512":t="P-521"===e.crv;break;case"Ed25519":t="Ed25519"===e.crv;break;case"EdDSA":t="Ed25519"===e.crv||"Ed448"===e.crv}return t}),{0:s,length:a}=i;if(0===a)throw new ib;if(1!==a){let e=new iv,{_cached:t}=this;throw e[Symbol.asyncIterator]=async function*(){for(let e of i)try{yield await sH(t,e,r)}catch{}},e}return sH(this._cached,s,r)}}async function sH(e,t,r){let n=e.get(t)||e.set(t,{}).get(t);if(void 0===n[r]){let e=await sO({...t,ext:!0},r);if(e instanceof Uint8Array||"public"!==e.type)throw new iw("JSON Web Key Set members must be public keys");n[r]=e}return n[r]}function sF(e){let t=new sZ(e),r=async(e,r)=>t.getKey(e,r);return Object.defineProperties(r,{jwks:{value:()=>sM(t._jwks),enumerable:!0,configurable:!1,writable:!1}}),r}"undefined"!=typeof navigator&&navigator.userAgent?.startsWith?.("Mozilla/5.0 ")||(n="jose/v5.10.0");let sK=Symbol();function sW(e){try{return JSON.parse(e,function(e,t){if("string"==typeof t&&/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d+)?Z$/.test(t)){let e=new Date(t);if(!isNaN(e.getTime()))return e}return t})}catch{return null}}let sB=e=>i9("a-z","A-Z","0-9")(e||32),sJ=["info","success","warn","error","debug"],sG={reset:"\x1b[0m",bright:"\x1b[1m",dim:"\x1b[2m",fg:{red:"\x1b[31m",green:"\x1b[32m",yellow:"\x1b[33m",blue:"\x1b[34m",magenta:"\x1b[35m"}},sQ={info:sG.fg.blue,success:sG.fg.green,warn:sG.fg.yellow,error:sG.fg.red,debug:sG.fg.magenta},sY=(e,t)=>{let r=new Date().toISOString();return`${sG.dim}${r}${sG.reset} ${sQ[e]}${e.toUpperCase()}${sG.reset} ${sG.bright}[Better Auth]:${sG.reset} ${t}`},sX=(e=>{let t=e?.disabled!==!0,r=e?.level??"error",n=(n,o,i=[])=>{if(!t||!(sJ.indexOf(n)<=sJ.indexOf(r)))return;let s=sY(n,o);if(!e||"function"!=typeof e.log)return void("error"===n?console.error(s,...i):"warn"===n?console.warn(s,...i):console.log(s,...i));e.log("success"===n?"info":n,o,...i)};return Object.fromEntries(sJ.map(e=>[e,(...[t,...r])=>n(e,t,r)]))})();oe({id:nI(),providerId:nI(),accountId:nI(),userId:ov(),accessToken:nI().nullish(),refreshToken:nI().nullish(),idToken:nI().nullish(),accessTokenExpiresAt:n8().nullish(),refreshTokenExpiresAt:n8().nullish(),scope:nI().nullish(),password:nI().nullish(),createdAt:n8().default(()=>new Date),updatedAt:n8().default(()=>new Date)}),oe({id:nI(),email:nI().transform(e=>e.toLowerCase()),emailVerified:n1().default(!1),name:nI(),image:nI().nullish(),createdAt:n8().default(()=>new Date),updatedAt:n8().default(()=>new Date)}),oe({id:nI(),userId:ov(),expiresAt:n8(),createdAt:n8().default(()=>new Date),updatedAt:n8().default(()=>new Date),token:nI(),ipAddress:nI().nullish(),userAgent:nI().nullish()}),oe({id:nI(),value:nI(),createdAt:n8().default(()=>new Date),updatedAt:n8().default(()=>new Date),expiresAt:n8(),identifier:nI()});function s0(e){if(null===e||"object"!=typeof e)return!1;let t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.iterator in e)&&(!(Symbol.toStringTag in e)||"[object Module]"===Object.prototype.toString.call(e))}function s1(e){return(...t)=>t.reduce((t,r)=>(function e(t,r,n=".",o){if(!s0(r))return e(t,{},n,o);let i=Object.assign({},r);for(let r in t){if("__proto__"===r||"constructor"===r)continue;let s=t[r];null!=s&&(o&&o(i,r,s,n)||(Array.isArray(s)&&Array.isArray(i[r])?i[r]=[...s,...i[r]]:s0(s)&&s0(i[r])?i[r]=e(s,i[r],(n?`${n}.`:"")+r.toString(),o):i[r]=s))}return i})(t,r,"",e),{})}s1(),s1((e,t,r)=>{if(void 0!==e[t]&&"function"==typeof r)return e[t]=r(e[t]),!0}),s1((e,t,r)=>{if(Array.isArray(e[t])&&"function"==typeof r)return e[t]=r(e[t]),!0});let s2=J(async()=>({})),s5=J.create({use:[s2,J(async()=>({}))]}),s6=G.create({use:[s2]});function s4(e){return"-"===e||"^"===e||"$"===e||"+"===e||"."===e||"("===e||")"===e||"|"===e||"["===e||"]"===e||"{"===e||"}"===e||"*"===e||"?"===e||"\\"===e?`\\${e}`:e}function s8(e,t){if("string"!=typeof t)throw TypeError(`Sample must be a string, but ${typeof t} given`);return e.test(t)}function s3(e,t){if("string"!=typeof e&&!Array.isArray(e))throw TypeError(`The first argument must be a single pattern string or an array of patterns, but ${typeof e} given`);if(("string"==typeof t||"boolean"==typeof t)&&(t={separator:t}),2==arguments.length&&!(void 0===t||"object"==typeof t&&null!==t&&!Array.isArray(t)))throw TypeError(`The second argument must be an options object or a string/boolean separator, but ${typeof t} given`);if("\\"===(t=t||{}).separator)throw Error("\\ is not a valid separator because it is used for escaping. Try setting the separator to `true` instead");let r=function e(t,r=!0){if(Array.isArray(t)){let n=t.map(t=>`^${e(t,r)}$`);return`(?:${n.join("|")})`}let n="",o="",i=".";!0===r?(n="/",o="[/\\\\]",i="[^/\\\\]"):r&&((o=function(e){let t="";for(let r=0;r<e.length;r++)t+=s4(e[r]);return t}(n=r)).length>1?(o=`(?:${o})`,i=`((?!${o}).)`):i=`[^${o}]`);let s=r?`${o}+?`:"",a=r?`${o}*?`:"",c=r?t.split(n):[t],l="";for(let e=0;e<c.length;e++){let t=c[e],n=c[e+1],o="";if(t||!(e>0)){if(r&&(o=e===c.length-1?a:"**"!==n?s:""),r&&"**"===t){o&&(l+=0===e?"":o,l+=`(?:${i}*?${o})*?`);continue}for(let e=0;e<t.length;e++){let r=t[e];"\\"===r?e<t.length-1&&(l+=s4(t[e+1]),e++):"?"===r?l+=i:"*"===r?l+=`${i}*?`:l+=s4(r)}l+=o}}return l}(e,t.separator),n=RegExp(`^${r}$`,t.flags),o=s8.bind(null,n);return o.options=t,o.pattern=e,o.regexp=n,o}s5(async e=>{if(e.request?.method!=="POST"||!e.request)return;let{body:t,query:r,context:n}=e,o=e.headers?.get("origin")||e.headers?.get("referer")||"",i=t?.callbackURL||r?.callbackURL,s=t?.redirectTo,a=t?.errorCallbackURL,c=t?.newUserCallbackURL,l=Array.isArray(n.options.trustedOrigins)?n.trustedOrigins:[...n.trustedOrigins,...await n.options.trustedOrigins?.(e.request)||[]],d=e.headers?.has("cookie"),u=(e,t)=>{if(e.startsWith("/"))return!1;if(t.includes("*"))return t.includes("://")?s3(t)(T(e)||e):s3(t)(S(e));let r=x(e);return"http:"!==r&&"https:"!==r&&r?e.startsWith(t):t===T(e)},p=(t,r)=>{if(t&&!l.some(e=>u(t,e)||t?.startsWith("/")&&"origin"!==r&&/^\/(?!\/|\\|%2f|%5c)[\w\-.\+/@]*(?:\?[\w\-.\+/=&%@]*)?$/.test(t)))throw e.context.logger.error(`Invalid ${r}: ${t}`),e.context.logger.info(`If it's a valid URL, please add ${t} to trustedOrigins in your auth config
`,`Current list of trustedOrigins: ${l}`),new $("FORBIDDEN",{message:`Invalid ${r}`})};d&&!e.context.options.advanced?.disableCSRFCheck&&p(o,"origin"),i&&p(i,"callbackURL"),s&&p(s,"redirectURL"),a&&p(a,"errorCallbackURL"),c&&p(c,"newUserCallbackURL")});let s9=e=>s5(async t=>{if(!t.request)return;let{context:r}=t,n=e(t),o=Array.isArray(r.options.trustedOrigins)?r.trustedOrigins:[...r.trustedOrigins,...await r.options.trustedOrigins?.(t.request)||[]],i=(e,t)=>{if(e.startsWith("/"))return!1;if(t.includes("*"))return t.includes("://")?s3(t)(T(e)||e):s3(t)(S(e));let r=x(e);return"http:"!==r&&"https:"!==r&&r?e.startsWith(t):t===T(e)},s=(e,r)=>{if(e&&!o.some(t=>i(e,t)||e?.startsWith("/")&&"origin"!==r&&/^\/(?!\/|\\|%2f|%5c)[\w\-.\+/@]*(?:\?[\w\-.\+/=&%@]*)?$/.test(e)))throw t.context.logger.error(`Invalid ${r}: ${e}`),t.context.logger.info(`If it's a valid URL, please add ${e} to trustedOrigins in your auth config
`,`Current list of trustedOrigins: ${o}`),new $("FORBIDDEN",{message:`Invalid ${r}`})};for(let e of Array.isArray(n)?n:[n])s(e,"callbackURL")}),s7={FAILED_TO_CREATE_SESSION:"Failed to create session",FAILED_TO_GET_SESSION:"Failed to get session",INVALID_PASSWORD:"Invalid password",INVALID_EMAIL:"Invalid email",INVALID_EMAIL_OR_PASSWORD:"Invalid email or password",PROVIDER_NOT_FOUND:"Provider not found",INVALID_TOKEN:"invalid token",ID_TOKEN_NOT_SUPPORTED:"id_token not supported",FAILED_TO_GET_USER_INFO:"Failed to get user info",USER_EMAIL_NOT_FOUND:"User email not found",EMAIL_NOT_VERIFIED:"Email not verified",PASSWORD_TOO_SHORT:"Password too short",PASSWORD_TOO_LONG:"Password too long",USER_ALREADY_EXISTS:"User already exists",CREDENTIAL_ACCOUNT_NOT_FOUND:"Credential account not found",SESSION_EXPIRED:"Session expired. Re-authenticate to perform this action.",FAILED_TO_UNLINK_LAST_ACCOUNT:"You can't unlink your last account",ACCOUNT_NOT_FOUND:"Account not found"},ae=()=>s6("/get-session",{method:"GET",query:ol(oe({disableCookieCache:o_().meta({description:"Disable cookie cache and fetch session from database"}).optional(),disableRefresh:o_().meta({description:"Disable session refresh. Useful for checking session status, without updating the session"}).optional()})),requireHeaders:!0,metadata:{openapi:{description:"Get the current session",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{session:{$ref:"#/components/schemas/Session"},user:{$ref:"#/components/schemas/User"}},required:["session","user"]}}}}}}}},async e=>{try{let t=await e.getSignedCookie(e.context.authCookies.sessionToken.name,e.context.secret);if(!t)return null;let r=e.getCookie(e.context.authCookies.sessionData.name),n=r?sW(E.decode(p.decode(r))):null;if(n&&!await v("SHA-256","base64urlnopad").verify(e.context.secret,JSON.stringify({...n.session,expiresAt:n.expiresAt}),n.signature)){let t=e.context.authCookies.sessionData.name;return e.setCookie(t,"",{maxAge:0}),e.json(null)}let o=await e.getSignedCookie(e.context.authCookies.dontRememberToken.name,e.context.secret);if(n?.session&&e.context.options.session?.cookieCache?.enabled&&!e.query?.disableCookieCache){let t=n.session;if(!(n.expiresAt<Date.now()||t.session.expiresAt<new Date))return e.context.session=t,e.json(t);{let t=e.context.authCookies.sessionData.name;e.setCookie(t,"",{maxAge:0})}}let i=await e.context.internalAdapter.findSession(t);if(e.context.session=i,!i||i.session.expiresAt<new Date)return N(e),i&&await e.context.internalAdapter.deleteSession(i.session.token),e.json(null);if(o||e.query?.disableRefresh)return e.json(i);let s=e.context.sessionConfig.expiresIn,a=e.context.sessionConfig.updateAge;if(i.session.expiresAt.valueOf()-1e3*s+1e3*a<=Date.now()&&(!e.query?.disableRefresh||!e.context.options.session?.disableSessionRefresh)){let t=await e.context.internalAdapter.updateSession(i.session.token,{expiresAt:A(e.context.sessionConfig.expiresIn,"sec"),updatedAt:new Date});if(!t)return N(e),e.json(null,{status:401});let r=(t.expiresAt.valueOf()-Date.now())/1e3;return await U(e,{session:t,user:i.user},!1,{maxAge:r}),e.json({session:t,user:i.user})}return await O(e,i),e.json(i)}catch(t){throw e.context.logger.error("INTERNAL_SERVER_ERROR",t),new $("INTERNAL_SERVER_ERROR",{message:s7.FAILED_TO_GET_SESSION})}}),at=async(e,t)=>{if(e.context.session)return e.context.session;let r=await ae()({...e,asResponse:!1,headers:e.headers,returnHeaders:!1,query:{...t,...e.query}}).catch(e=>null);return e.context.session=r,r},ar=s5(async e=>{let t=await at(e);if(!t?.session)throw new $("UNAUTHORIZED");return{session:t}});s5(async e=>{let t=await at(e);if(!t?.session&&(e.request||e.headers))throw new $("UNAUTHORIZED");return{session:t}});let an=s5(async e=>{let t=await at(e);if(!t?.session)throw new $("UNAUTHORIZED");if(0===e.context.sessionConfig.freshAge)return{session:t};let r=e.context.sessionConfig.freshAge,n=t.session.updatedAt?.valueOf()||t.session.createdAt.valueOf();if(!(Date.now()-n<1e3*r))throw new $("FORBIDDEN",{message:"Session is not fresh"});return{session:t}});async function ao(e,t,r,n=3600){return await se({email:t.toLowerCase(),updateTo:r},e,n)}async function ai(e,t){if(!e.context.options.emailVerification?.sendVerificationEmail)throw e.context.logger.error("Verification email isn't enabled."),new $("BAD_REQUEST",{message:"Verification email isn't enabled"});let r=await ao(e.context.secret,t.email,void 0,e.context.options.emailVerification?.expiresIn),n=`${e.context.baseURL}/verify-email?token=${r}&callbackURL=${e.body.callbackURL||"/"}`;await e.context.options.emailVerification.sendVerificationEmail({user:t,url:n,token:r},e.request)}s6("/revoke-session",{method:"POST",body:oe({token:nI().meta({description:"The token to revoke"})}),use:[ar],requireHeaders:!0,metadata:{openapi:{description:"Revoke a single session",requestBody:{content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",description:"The token to revoke"}},required:["token"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the session was revoked successfully"}},required:["status"]}}}}}}}},async e=>{let t=e.body.token,r=await e.context.internalAdapter.findSession(t);if(!r)throw new $("BAD_REQUEST",{message:"Session not found"});if(r.session.userId!==e.context.session.user.id)throw new $("UNAUTHORIZED");try{await e.context.internalAdapter.deleteSession(t)}catch(t){throw e.context.logger.error(t&&"object"==typeof t&&"name"in t?t.name:"",t),new $("INTERNAL_SERVER_ERROR")}return e.json({status:!0})}),s6("/revoke-sessions",{method:"POST",use:[ar],requireHeaders:!0,metadata:{openapi:{description:"Revoke all sessions for the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if all sessions were revoked successfully"}},required:["status"]}}}}}}}},async e=>{try{await e.context.internalAdapter.deleteSessions(e.context.session.user.id)}catch(t){throw e.context.logger.error(t&&"object"==typeof t&&"name"in t?t.name:"",t),new $("INTERNAL_SERVER_ERROR")}return e.json({status:!0})}),s6("/revoke-other-sessions",{method:"POST",requireHeaders:!0,use:[ar],metadata:{openapi:{description:"Revoke all other sessions for the user except the current one",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if all other sessions were revoked successfully"}},required:["status"]}}}}}}}},async e=>{let t=e.context.session;if(!t.user)throw new $("UNAUTHORIZED");let r=(await e.context.internalAdapter.listSessions(t.user.id)).filter(e=>e.expiresAt>new Date).filter(t=>t.token!==e.context.session.session.token);return await Promise.all(r.map(t=>e.context.internalAdapter.deleteSession(t.token))),e.json({status:!0})}),s6("/send-verification-email",{method:"POST",body:oe({email:ni(nU,void 0).meta({description:"The email to send the verification email to"}),callbackURL:nI().meta({description:"The URL to use for email verification callback"}).optional()}),metadata:{openapi:{description:"Send a verification email to the user",requestBody:{content:{"application/json":{schema:{type:"object",properties:{email:{type:"string",description:"The email to send the verification email to",example:"user@example.com"},callbackURL:{type:"string",description:"The URL to use for email verification callback",example:"https://example.com/callback",nullable:!0}},required:["email"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the email was sent successfully",example:!0}}}}}},400:{description:"Bad Request",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string",description:"Error message",example:"Verification email isn't enabled"}}}}}}}}}},async e=>{if(!e.context.options.emailVerification?.sendVerificationEmail)throw e.context.logger.error("Verification email isn't enabled."),new $("BAD_REQUEST",{message:"Verification email isn't enabled"});let{email:t}=e.body,r=await at(e);if(!r){let r=await e.context.internalAdapter.findUserByEmail(t);return r&&await ai(e,r.user),e.json({status:!0})}if(r?.user.emailVerified)throw new $("BAD_REQUEST",{message:"You can only send a verification email to an unverified email"});if(r?.user.email!==t)throw new $("BAD_REQUEST",{message:"You can only send a verification email to your own email"});return await ai(e,r.user),e.json({status:!0})}),s6("/verify-email",{method:"GET",query:oe({token:nI().meta({description:"The token to verify the email"}),callbackURL:nI().meta({description:"The URL to redirect to after email verification"}).optional()}),use:[s9(e=>e.query.callbackURL)],metadata:{openapi:{description:"Verify the email of the user",parameters:[{name:"token",in:"query",description:"The token to verify the email",required:!0,schema:{type:"string"}},{name:"callbackURL",in:"query",description:"The URL to redirect to after email verification",required:!1,schema:{type:"string"}}],responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",properties:{id:{type:"string",description:"User ID"},email:{type:"string",description:"User email"},name:{type:"string",description:"User name"},image:{type:"string",description:"User image URL"},emailVerified:{type:"boolean",description:"Indicates if the user email is verified"},createdAt:{type:"string",description:"User creation date"},updatedAt:{type:"string",description:"User update date"}},required:["id","email","name","image","emailVerified","createdAt","updatedAt"]},status:{type:"boolean",description:"Indicates if the email was verified successfully"}},required:["user","status"]}}}}}}}},async e=>{let t;function r(t){if(e.query.callbackURL){if(e.query.callbackURL.includes("?"))throw e.redirect(`${e.query.callbackURL}&error=${t}`);throw e.redirect(`${e.query.callbackURL}?error=${t}`)}throw new $("UNAUTHORIZED",{message:t})}let{token:n}=e.query;try{t=await sz(n,new TextEncoder().encode(e.context.secret),{algorithms:["HS256"]})}catch(e){if(e instanceof ip)return r("token_expired");return r("invalid_token")}let o=oe({email:nI().email(),updateTo:nI().optional()}).parse(t.payload),i=await e.context.internalAdapter.findUserByEmail(o.email);if(!i)return r("user_not_found");if(o.updateTo){let t=await at(e);if(!t||t.user.email!==o.email){if(e.query.callbackURL)throw e.redirect(`${e.query.callbackURL}?error=unauthorized`);return r("unauthorized")}let n=await e.context.internalAdapter.updateUserByEmail(o.email,{email:o.updateTo,emailVerified:!1},e),i=await ao(e.context.secret,o.updateTo);if(await e.context.options.emailVerification?.sendVerificationEmail?.({user:n,url:`${e.context.baseURL}/verify-email?token=${i}&callbackURL=${e.query.callbackURL||"/"}`,token:i},e.request),await U(e,{session:t.session,user:{...t.user,email:o.updateTo,emailVerified:!1}}),e.query.callbackURL)throw e.redirect(e.query.callbackURL);return e.json({status:!0,user:{id:n.id,email:n.email,name:n.name,image:n.image,emailVerified:n.emailVerified,createdAt:n.createdAt,updatedAt:n.updatedAt}})}e.context.options.emailVerification?.onEmailVerification&&await e.context.options.emailVerification.onEmailVerification(i.user,e.request);let s=await e.context.internalAdapter.updateUserByEmail(o.email,{emailVerified:!0},e);if(e.context.options.emailVerification?.afterEmailVerification&&await e.context.options.emailVerification.afterEmailVerification(s,e.request),e.context.options.emailVerification?.autoSignInAfterVerification){let t=await at(e);if(t&&t.user.email===o.email)await U(e,{session:t.session,user:{...t.user,emailVerified:!0}});else{let t=await e.context.internalAdapter.createSession(i.user.id,e);if(!t)throw new $("INTERNAL_SERVER_ERROR",{message:"Failed to create session"});await U(e,{session:t,user:{...i.user,emailVerified:!0}})}}if(e.query.callbackURL)throw e.redirect(e.query.callbackURL);return e.json({status:!0,user:null})});let as={isAction:!1};async function aa(e,t){let r=e.body?.callbackURL||e.context.options.baseURL;if(!r)throw new $("BAD_REQUEST",{message:"callbackURL is required"});let n=i7(128),o=i7(32),i=JSON.stringify({callbackURL:r,codeVerifier:n,errorURL:e.body?.errorCallbackURL,newUserURL:e.body?.newUserCallbackURL,link:t,expiresAt:Date.now()+6e5,requestSignUp:e.body?.requestSignUp}),s=new Date;s.setMinutes(s.getMinutes()+10);let a=await e.context.internalAdapter.createVerificationValue({value:i,identifier:o,expiresAt:s},e);if(!a)throw e.context.logger.error("Unable to create verification. Make sure the database adapter is properly working and there is a verification table in the database"),new $("INTERNAL_SERVER_ERROR",{message:"Unable to create verification"});return{state:a.identifier,codeVerifier:n}}async function ac(e){let t=e.query.state||e.body.state,r=await e.context.internalAdapter.findVerificationValue(t);if(!r){e.context.logger.error("State Mismatch. Verification not found",{state:t});let r=e.context.options.onAPIError?.errorURL||`${e.context.baseURL}/error`;throw e.redirect(`${r}?error=please_restart_the_process`)}let n=oe({callbackURL:nI(),codeVerifier:nI(),errorURL:nI().optional(),newUserURL:nI().optional(),expiresAt:nQ(),link:oe({email:nI(),userId:ov()}).optional(),requestSignUp:n1().optional()}).parse(JSON.parse(r.value));if(n.errorURL||(n.errorURL=`${e.context.baseURL}/error`),n.expiresAt<Date.now()){await e.context.internalAdapter.deleteVerificationValue(r.id);let t=e.context.options.onAPIError?.errorURL||`${e.context.baseURL}/error`;throw e.redirect(`${t}?error=please_restart_the_process`)}return await e.context.internalAdapter.deleteVerificationValue(r.id),n}async function al(e){let t=await oE("SHA-256").digest(e);return p.encode(new Uint8Array(t),{padding:!1})}function ad(e,t){return t.options.account?.encryptOAuthTokens&&e?st({key:t.secret,data:e}):e}async function au(e,{userInfo:t,account:r,callbackURL:n,disableSignUp:o,overrideUserInfo:i}){let s=await e.context.internalAdapter.findOAuthUser(t.email.toLowerCase(),r.accountId,r.providerId).catch(t=>{sX.error("Better auth was unable to query your database.\nError: ",t);let r=e.context.options.onAPIError?.errorURL||`${e.context.baseURL}/error`;throw e.redirect(`${r}?error=internal_server_error`)}),c=s?.user,l=!c;if(s){let n=s.accounts.find(e=>e.providerId===r.providerId&&e.accountId===r.accountId);if(n){if(e.context.options.account?.updateAccountOnSignIn!==!1){let t=Object.fromEntries(Object.entries({idToken:r.idToken,accessToken:await ad(r.accessToken,e.context),refreshToken:await ad(r.refreshToken,e.context),accessTokenExpiresAt:r.accessTokenExpiresAt,refreshTokenExpiresAt:r.refreshTokenExpiresAt,scope:r.scope}).filter(([e,t])=>void 0!==t));Object.keys(t).length>0&&await e.context.internalAdapter.updateAccount(n.id,t,e)}}else{let n=e.context.options.account?.accountLinking?.trustedProviders;if(!n?.includes(r.providerId)&&!t.emailVerified||e.context.options.account?.accountLinking?.enabled===!1)return a&&sX.warn(`User already exist but account isn't linked to ${r.providerId}. To read more about how account linking works in Better Auth see https://www.better-auth.com/docs/concepts/users-accounts#account-linking.`),{error:"account not linked",data:null};try{await e.context.internalAdapter.linkAccount({providerId:r.providerId,accountId:t.id.toString(),userId:s.user.id,accessToken:await ad(r.accessToken,e.context),refreshToken:await ad(r.refreshToken,e.context),idToken:r.idToken,accessTokenExpiresAt:r.accessTokenExpiresAt,refreshTokenExpiresAt:r.refreshTokenExpiresAt,scope:r.scope},e)}catch(e){return sX.error("Unable to link account",e),{error:"unable to link account",data:null}}}if(i){let{id:r,...n}=t;await e.context.internalAdapter.updateUser(s.user.id,{...n,email:t.email.toLowerCase(),emailVerified:t.email.toLowerCase()===s.user.email&&s.user.emailVerified||t.emailVerified})}}else{if(o)return{error:"signup disabled",data:null,isRegister:!1};try{let{id:o,...i}=t;if(c=await e.context.internalAdapter.createOAuthUser({...i,email:t.email.toLowerCase()},{accessToken:await ad(r.accessToken,e.context),refreshToken:await ad(r.refreshToken,e.context),idToken:r.idToken,accessTokenExpiresAt:r.accessTokenExpiresAt,refreshTokenExpiresAt:r.refreshTokenExpiresAt,scope:r.scope,providerId:r.providerId,accountId:t.id.toString()},e).then(e=>e?.user),!t.emailVerified&&c&&e.context.options.emailVerification?.sendOnSignUp){let t=await ao(e.context.secret,c.email,void 0,e.context.options.emailVerification?.expiresIn),r=`${e.context.baseURL}/verify-email?token=${t}&callbackURL=${n}`;await e.context.options.emailVerification?.sendVerificationEmail?.({user:c,url:r,token:t},e.request)}}catch(e){if(sX.error(e),e instanceof $)return{error:e.message,data:null,isRegister:!1};return{error:"unable to create user",data:null,isRegister:!1}}}if(!c)return{error:"unable to create user",data:null,isRegister:!1};let d=await e.context.internalAdapter.createSession(c.id,e);return d?{data:{session:d,user:c},error:null,isRegister:l}:{error:"unable to create session",data:null,isRegister:!1}}let ap=(e="")=>e.split("://").map(e=>e.replace(/\/{2,}/g,"/")).join("://");var af=(e=>(e[e.RUS=0]="RUS",e[e.UKR=1]="UKR",e[e.ENG=3]="ENG",e[e.SPA=4]="SPA",e[e.GERMAN=6]="GERMAN",e[e.POL=15]="POL",e[e.FRA=16]="FRA",e[e.TURKEY=82]="TURKEY",e))(af||{});let ah=os(["apple","discord","facebook","github","microsoft","google","huggingface","slack","spotify","twitch","twitter","dropbox","kick","linear","linkedin","gitlab","tiktok","reddit","roblox","vk","zoom","notion"]).or(nI());s6("/sign-in/social",{method:"POST",body:oe({callbackURL:nI().meta({description:"Callback URL to redirect to after the user has signed in"}).optional(),newUserCallbackURL:nI().optional(),errorCallbackURL:nI().meta({description:"Callback URL to redirect to if an error happens"}).optional(),provider:ah,disableRedirect:n1().meta({description:"Disable automatic redirection to the provider. Useful for handling the redirection yourself"}).optional(),idToken:ol(oe({token:nI().meta({description:"ID token from the provider"}),nonce:nI().meta({description:"Nonce used to generate the token"}).optional(),accessToken:nI().meta({description:"Access token from the provider"}).optional(),refreshToken:nI().meta({description:"Refresh token from the provider"}).optional(),expiresAt:nQ().meta({description:"Expiry date of the token"}).optional()})),scopes:n9(nI()).meta({description:"Array of scopes to request from the provider. This will override the default scopes passed."}).optional(),requestSignUp:n1().meta({description:"Explicitly request sign-up. Useful when disableImplicitSignUp is true for this provider"}).optional(),loginHint:nI().meta({description:"The login hint to use for the authorization code request"}).optional()}),metadata:{openapi:{description:"Sign in with a social provider",operationId:"socialSignIn",responses:{200:{description:"Success - Returns either session details or redirect URL",content:{"application/json":{schema:{type:"object",description:"Session response when idToken is provided",properties:{redirect:{type:"boolean",enum:[!1]},token:{type:"string",description:"Session token",url:{type:"null",nullable:!0},user:{type:"object",properties:{id:{type:"string"},email:{type:"string"},name:{type:"string",nullable:!0},image:{type:"string",nullable:!0},emailVerified:{type:"boolean"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}},required:["id","email","emailVerified","createdAt","updatedAt"]}}},required:["redirect","token","user"]}}}}}}}},async e=>{let t=e.context.socialProviders.find(t=>t.id===e.body.provider);if(!t)throw e.context.logger.error("Provider not found. Make sure to add the provider in your auth config",{provider:e.body.provider}),new $("NOT_FOUND",{message:s7.PROVIDER_NOT_FOUND});if(e.body.idToken){if(!t.verifyIdToken)throw e.context.logger.error("Provider does not support id token verification",{provider:e.body.provider}),new $("NOT_FOUND",{message:s7.ID_TOKEN_NOT_SUPPORTED});let{token:r,nonce:n}=e.body.idToken;if(!await t.verifyIdToken(r,n))throw e.context.logger.error("Invalid id token",{provider:e.body.provider}),new $("UNAUTHORIZED",{message:s7.INVALID_TOKEN});let o=await t.getUserInfo({idToken:r,accessToken:e.body.idToken.accessToken,refreshToken:e.body.idToken.refreshToken});if(!o||!o?.user)throw e.context.logger.error("Failed to get user info",{provider:e.body.provider}),new $("UNAUTHORIZED",{message:s7.FAILED_TO_GET_USER_INFO});if(!o.user.email)throw e.context.logger.error("User email not found",{provider:e.body.provider}),new $("UNAUTHORIZED",{message:s7.USER_EMAIL_NOT_FOUND});let i=await au(e,{userInfo:{...o.user,email:o.user.email,id:String(o.user.id),name:o.user.name||"",image:o.user.image,emailVerified:o.user.emailVerified||!1},account:{providerId:t.id,accountId:String(o.user.id),accessToken:e.body.idToken.accessToken},callbackURL:e.body.callbackURL,disableSignUp:t.disableImplicitSignUp&&!e.body.requestSignUp||t.disableSignUp});if(i.error)throw new $("UNAUTHORIZED",{message:i.error});return await U(e,i.data),e.json({redirect:!1,token:i.data.session.token,url:void 0,user:{id:i.data.user.id,email:i.data.user.email,name:i.data.user.name,image:i.data.user.image,emailVerified:i.data.user.emailVerified,createdAt:i.data.user.createdAt,updatedAt:i.data.user.updatedAt}})}let{codeVerifier:r,state:n}=await aa(e),o=await t.createAuthorizationURL({state:n,codeVerifier:r,redirectURI:`${e.context.baseURL}/callback/${t.id}`,scopes:e.body.scopes,loginHint:e.body.loginHint});return e.json({url:o.toString(),redirect:!e.body.disableRedirect})}),s6("/sign-in/email",{method:"POST",body:oe({email:nI().meta({description:"Email of the user"}),password:nI().meta({description:"Password of the user"}),callbackURL:nI().meta({description:"Callback URL to use as a redirect for email verification"}).optional(),rememberMe:n1().meta({description:"If this is false, the session will not be remembered. Default is `true`."}).default(!0).optional()}),metadata:{openapi:{description:"Sign in with email and password",responses:{200:{description:"Success - Returns either session details or redirect URL",content:{"application/json":{schema:{type:"object",description:"Session response when idToken is provided",properties:{redirect:{type:"boolean",enum:[!1]},token:{type:"string",description:"Session token"},url:{type:"null",nullable:!0},user:{type:"object",properties:{id:{type:"string"},email:{type:"string"},name:{type:"string",nullable:!0},image:{type:"string",nullable:!0},emailVerified:{type:"boolean"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}},required:["id","email","emailVerified","createdAt","updatedAt"]}},required:["redirect","token","user"]}}}}}}}},async e=>{if(!e.context.options?.emailAndPassword?.enabled)throw e.context.logger.error("Email and password is not enabled. Make sure to enable it in the options on you `auth.ts` file. Check `https://better-auth.com/docs/authentication/email-password` for more!"),new $("BAD_REQUEST",{message:"Email and password is not enabled"});let{email:t,password:r}=e.body;if(!nI().email().safeParse(t).success)throw new $("BAD_REQUEST",{message:s7.INVALID_EMAIL});let n=await e.context.internalAdapter.findUserByEmail(t,{includeAccounts:!0});if(!n)throw await e.context.password.hash(r),e.context.logger.error("User not found",{email:t}),new $("UNAUTHORIZED",{message:s7.INVALID_EMAIL_OR_PASSWORD});let o=n.accounts.find(e=>"credential"===e.providerId);if(!o)throw e.context.logger.error("Credential account not found",{email:t}),new $("UNAUTHORIZED",{message:s7.INVALID_EMAIL_OR_PASSWORD});let i=o?.password;if(!i)throw e.context.logger.error("Password not found",{email:t}),new $("UNAUTHORIZED",{message:s7.INVALID_EMAIL_OR_PASSWORD});if(!await e.context.password.verify({hash:i,password:r}))throw e.context.logger.error("Invalid password"),new $("UNAUTHORIZED",{message:s7.INVALID_EMAIL_OR_PASSWORD});if(e.context.options?.emailAndPassword?.requireEmailVerification&&!n.user.emailVerified){if(!e.context.options?.emailVerification?.sendVerificationEmail)throw new $("FORBIDDEN",{message:s7.EMAIL_NOT_VERIFIED});if(e.context.options?.emailVerification?.sendOnSignIn){let t=await ao(e.context.secret,n.user.email,void 0,e.context.options.emailVerification?.expiresIn),r=`${e.context.baseURL}/verify-email?token=${t}&callbackURL=${e.body.callbackURL||"/"}`;await e.context.options.emailVerification.sendVerificationEmail({user:n.user,url:r,token:t},e.request)}throw new $("FORBIDDEN",{message:s7.EMAIL_NOT_VERIFIED})}let s=await e.context.internalAdapter.createSession(n.user.id,e,!1===e.body.rememberMe);if(!s)throw e.context.logger.error("Failed to create session"),new $("UNAUTHORIZED",{message:s7.FAILED_TO_CREATE_SESSION});return await U(e,{session:s,user:n.user},!1===e.body.rememberMe),e.json({redirect:!!e.body.callbackURL,token:s.token,url:e.body.callbackURL,user:{id:n.user.id,email:n.user.email,name:n.user.name,image:n.user.image,emailVerified:n.user.emailVerified,createdAt:n.user.createdAt,updatedAt:n.user.updatedAt}})});let am=oe({code:nI().optional(),error:nI().optional(),device_id:nI().optional(),error_description:nI().optional(),state:nI().optional(),user:nI().optional()});function ay(e,t,r){let n=t?new URL(t,e.baseURL):new URL(`${e.baseURL}/error`);return r&&Object.entries(r).forEach(([e,t])=>n.searchParams.set(e,t)),n.href}s6("/callback/:id",{method:["GET","POST"],body:am.optional(),query:am.optional(),metadata:as},async e=>{let t,r,n,o=e.context.options.onAPIError?.errorURL||`${e.context.baseURL}/error`;try{if("GET"===e.method)t=am.parse(e.query);else if("POST"===e.method)t=am.parse(e.body);else throw Error("Unsupported method")}catch(t){throw e.context.logger.error("INVALID_CALLBACK_REQUEST",t),e.redirect(`${o}?error=invalid_callback_request`)}let{code:i,error:s,state:a,error_description:c,device_id:l}=t;if(s)throw e.redirect(`${o}?error=${s}&error_description=${c}`);if(!a)throw e.context.logger.error("State not found",s),e.redirect(`${o}?error=state_not_found`);let{codeVerifier:d,callbackURL:u,link:p,errorURL:f,newUserURL:h,requestSignUp:m}=await ac(e);function y(t){let r=f||o;throw r=r.includes("?")?`${r}&error=${t}`:`${r}?error=${t}`,e.redirect(r)}if(!i)throw e.context.logger.error("Code not found"),y("no_code");let g=e.context.socialProviders.find(t=>t.id===e.params.id);if(!g)throw e.context.logger.error("Oauth provider with id",e.params.id,"not found"),y("oauth_provider_not_found");try{r=await g.validateAuthorizationCode({code:i,codeVerifier:d,deviceId:l,redirectURI:`${e.context.baseURL}/callback/${g.id}`})}catch(t){throw e.context.logger.error("",t),y("invalid_code")}let w=await g.getUserInfo({...r,user:e.body?.user?sW(e.body.user):void 0}).then(e=>e?.user);if(!w)return e.context.logger.error("Unable to get user info"),y("unable_to_get_user_info");if(!u)throw e.context.logger.error("No callback URL found"),y("no_callback_url");if(p){let t,n=e.context.options.account?.accountLinking?.trustedProviders;if(!n?.includes(g.id)&&!w.emailVerified||e.context.options.account?.accountLinking?.enabled===!1)return e.context.logger.error("Unable to link account - untrusted provider"),y("unable_to_link_account");let o=await e.context.internalAdapter.findAccount(String(w.id));if(o){if(o.userId.toString()!==p.userId.toString())return y("account_already_linked_to_different_user");let t=Object.fromEntries(Object.entries({accessToken:await ad(r.accessToken,e.context),refreshToken:await ad(r.refreshToken,e.context),idToken:r.idToken,accessTokenExpiresAt:r.accessTokenExpiresAt,refreshTokenExpiresAt:r.refreshTokenExpiresAt,scope:r.scopes?.join(",")}).filter(([e,t])=>void 0!==t));await e.context.internalAdapter.updateAccount(o.id,t)}else if(!await e.context.internalAdapter.createAccount({userId:p.userId,providerId:g.id,accountId:String(w.id),...r,accessToken:await ad(r.accessToken,e.context),refreshToken:await ad(r.refreshToken,e.context),scope:r.scopes?.join(",")},e))return y("unable_to_link_account");try{t=u.toString()}catch{t=u}throw e.redirect(t)}if(!w.email)return e.context.logger.error("Provider did not return email. This could be due to misconfiguration in the provider settings."),y("email_not_found");let b=await au(e,{userInfo:{...w,id:String(w.id),email:w.email,name:w.name||w.email},account:{providerId:g.id,accountId:String(w.id),...r,scope:r.scopes?.join(",")},callbackURL:u,disableSignUp:g.disableImplicitSignUp&&!m||g.options?.disableSignUp,overrideUserInfo:g.options?.overrideUserInfoOnSignIn});if(b.error)return e.context.logger.error(b.error.split(" ").join("_")),y(b.error.split(" ").join("_"));let{session:v,user:_}=b.data;await U(e,{session:v,user:_});try{n=(b.isRegister&&h||u).toString()}catch{n=b.isRegister&&h||u}throw e.redirect(n)}),s6("/sign-out",{method:"POST",requireHeaders:!0,metadata:{openapi:{description:"Sign out the current user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},async e=>{let t=await e.getSignedCookie(e.context.authCookies.sessionToken.name,e.context.secret);if(!t)throw N(e),new $("BAD_REQUEST",{message:s7.FAILED_TO_GET_SESSION});return await e.context.internalAdapter.deleteSession(t),N(e),e.json({success:!0})}),s6("/request-password-reset",{method:"POST",body:oe({email:ni(nU,void 0).meta({description:"The email address of the user to send a password reset email to"}),redirectTo:nI().meta({description:"The URL to redirect the user to reset their password. If the token isn't valid or expired, it'll be redirected with a query parameter `?error=INVALID_TOKEN`. If the token is valid, it'll be redirected with a query parameter `?token=VALID_TOKEN"}).optional()}),metadata:{openapi:{description:"Send a password reset email to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"},message:{type:"string"}}}}}}}}}},async e=>{if(!e.context.options.emailAndPassword?.sendResetPassword)throw e.context.logger.error("Reset password isn't enabled.Please pass an emailAndPassword.sendResetPassword function in your auth config!"),new $("BAD_REQUEST",{message:"Reset password isn't enabled"});let{email:t,redirectTo:r}=e.body,n=await e.context.internalAdapter.findUserByEmail(t,{includeAccounts:!0});if(!n)return e.context.logger.error("Reset Password: User not found",{email:t}),e.json({status:!0,message:"If this email exists in our system, check your email for the reset link"});let o=A(e.context.options.emailAndPassword.resetPasswordTokenExpiresIn||3600,"sec"),i=sB(24);await e.context.internalAdapter.createVerificationValue({value:n.user.id,identifier:`reset-password:${i}`,expiresAt:o},e);let s=r?encodeURIComponent(r):"",a=`${e.context.baseURL}/reset-password/${i}?callbackURL=${s}`;return await e.context.options.emailAndPassword.sendResetPassword({user:n.user,url:a,token:i},e.request),e.json({status:!0})}),s6("/forget-password",{method:"POST",body:oe({email:nI().email().meta({description:"The email address of the user to send a password reset email to"}),redirectTo:nI().meta({description:"The URL to redirect the user to reset their password. If the token isn't valid or expired, it'll be redirected with a query parameter `?error=INVALID_TOKEN`. If the token is valid, it'll be redirected with a query parameter `?token=VALID_TOKEN"}).optional()}),metadata:{openapi:{description:"Send a password reset email to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"},message:{type:"string"}}}}}}}}}},async e=>{if(!e.context.options.emailAndPassword?.sendResetPassword)throw e.context.logger.error("Reset password isn't enabled.Please pass an emailAndPassword.sendResetPassword function in your auth config!"),new $("BAD_REQUEST",{message:"Reset password isn't enabled"});let{email:t,redirectTo:r}=e.body,n=await e.context.internalAdapter.findUserByEmail(t,{includeAccounts:!0});if(!n)return e.context.logger.error("Reset Password: User not found",{email:t}),e.json({status:!0,message:"If this email exists in our system, check your email for the reset link"});let o=A(e.context.options.emailAndPassword.resetPasswordTokenExpiresIn||3600,"sec"),i=sB(24);await e.context.internalAdapter.createVerificationValue({value:n.user.id,identifier:`reset-password:${i}`,expiresAt:o},e);let s=r?encodeURIComponent(r):"",a=`${e.context.baseURL}/reset-password/${i}?callbackURL=${s}`;return await e.context.options.emailAndPassword.sendResetPassword({user:n.user,url:a,token:i},e.request),e.json({status:!0})}),s6("/reset-password/:token",{method:"GET",query:oe({callbackURL:nI().meta({description:"The URL to redirect the user to reset their password"})}),use:[s9(e=>e.query.callbackURL)],metadata:{openapi:{description:"Redirects the user to the callback URL with the token",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string"}}}}}}}}}},async e=>{let{token:t}=e.params,{callbackURL:r}=e.query;if(!t||!r)throw e.redirect(ay(e.context,r,{error:"INVALID_TOKEN"}));let n=await e.context.internalAdapter.findVerificationValue(`reset-password:${t}`);if(!n||n.expiresAt<new Date)throw e.redirect(ay(e.context,r,{error:"INVALID_TOKEN"}));throw e.redirect(function(e,t,r){let n=new URL(t,e.baseURL);return r&&Object.entries(r).forEach(([e,t])=>n.searchParams.set(e,t)),n.href}(e.context,r,{token:t}))}),s6("/reset-password",{method:"POST",query:oe({token:nI().optional()}).optional(),body:oe({newPassword:nI().meta({description:"The new password to set"}),token:nI().meta({description:"The token to reset the password"}).optional()}),metadata:{openapi:{description:"Reset the password for a user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async e=>{let t=e.body.token||e.query?.token;if(!t)throw new $("BAD_REQUEST",{message:s7.INVALID_TOKEN});let{newPassword:r}=e.body,n=e.context.password?.config.minPasswordLength,o=e.context.password?.config.maxPasswordLength;if(r.length<n)throw new $("BAD_REQUEST",{message:s7.PASSWORD_TOO_SHORT});if(r.length>o)throw new $("BAD_REQUEST",{message:s7.PASSWORD_TOO_LONG});let i=`reset-password:${t}`,s=await e.context.internalAdapter.findVerificationValue(i);if(!s||s.expiresAt<new Date)throw new $("BAD_REQUEST",{message:s7.INVALID_TOKEN});let a=s.value,c=await e.context.password.hash(r);if((await e.context.internalAdapter.findAccounts(a)).find(e=>"credential"===e.providerId)?await e.context.internalAdapter.updatePassword(a,c,e):await e.context.internalAdapter.createAccount({userId:a,providerId:"credential",password:c,accountId:a},e),await e.context.internalAdapter.deleteVerificationValue(s.id),e.context.options.emailAndPassword?.onPasswordReset){let t=await e.context.internalAdapter.findUserById(a);t&&await e.context.options.emailAndPassword.onPasswordReset({user:t},e.request)}return e.context.options.emailAndPassword?.revokeSessionsOnPasswordReset&&await e.context.internalAdapter.deleteSessions(a),e.json({status:!0})}),s6("/change-password",{method:"POST",body:oe({newPassword:nI().meta({description:"The new password to set"}),currentPassword:nI().meta({description:"The current password is required"}),revokeOtherSessions:n1().meta({description:"Must be a boolean value"}).optional()}),use:[ar],metadata:{openapi:{description:"Change the password of the user",responses:{200:{description:"Password successfully changed",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",nullable:!0,description:"New session token if other sessions were revoked"},user:{type:"object",properties:{id:{type:"string",description:"The unique identifier of the user"},email:{type:"string",format:"email",description:"The email address of the user"},name:{type:"string",description:"The name of the user"},image:{type:"string",format:"uri",nullable:!0,description:"The profile image URL of the user"},emailVerified:{type:"boolean",description:"Whether the email has been verified"},createdAt:{type:"string",format:"date-time",description:"When the user was created"},updatedAt:{type:"string",format:"date-time",description:"When the user was last updated"}},required:["id","email","name","emailVerified","createdAt","updatedAt"]}},required:["user"]}}}}}}}},async e=>{let{newPassword:t,currentPassword:r,revokeOtherSessions:n}=e.body,o=e.context.session,i=e.context.password.config.minPasswordLength;if(t.length<i)throw e.context.logger.error("Password is too short"),new $("BAD_REQUEST",{message:s7.PASSWORD_TOO_SHORT});let s=e.context.password.config.maxPasswordLength;if(t.length>s)throw e.context.logger.error("Password is too long"),new $("BAD_REQUEST",{message:s7.PASSWORD_TOO_LONG});let a=(await e.context.internalAdapter.findAccounts(o.user.id)).find(e=>"credential"===e.providerId&&e.password);if(!a||!a.password)throw new $("BAD_REQUEST",{message:s7.CREDENTIAL_ACCOUNT_NOT_FOUND});let c=await e.context.password.hash(t);if(!await e.context.password.verify({hash:a.password,password:r}))throw new $("BAD_REQUEST",{message:s7.INVALID_PASSWORD});await e.context.internalAdapter.updateAccount(a.id,{password:c});let l=null;if(n){await e.context.internalAdapter.deleteSessions(o.user.id);let t=await e.context.internalAdapter.createSession(o.user.id,e);if(!t)throw new $("INTERNAL_SERVER_ERROR",{message:s7.FAILED_TO_GET_SESSION});await U(e,{session:t,user:o.user}),l=t.token}return e.json({token:l,user:{id:o.user.id,email:o.user.email,name:o.user.name,image:o.user.image,emailVerified:o.user.emailVerified,createdAt:o.user.createdAt,updatedAt:o.user.updatedAt}})}),s6("/set-password",{method:"POST",body:oe({newPassword:nI().meta({description:"The new password to set is required"})}),metadata:{SERVER_ONLY:!0},use:[ar]},async e=>{let{newPassword:t}=e.body,r=e.context.session,n=e.context.password.config.minPasswordLength;if(t.length<n)throw e.context.logger.error("Password is too short"),new $("BAD_REQUEST",{message:s7.PASSWORD_TOO_SHORT});let o=e.context.password.config.maxPasswordLength;if(t.length>o)throw e.context.logger.error("Password is too long"),new $("BAD_REQUEST",{message:s7.PASSWORD_TOO_LONG});let i=(await e.context.internalAdapter.findAccounts(r.user.id)).find(e=>"credential"===e.providerId&&e.password),s=await e.context.password.hash(t);if(!i)return await e.context.internalAdapter.linkAccount({userId:r.user.id,providerId:"credential",accountId:r.user.id,password:s},e),e.json({status:!0});throw new $("BAD_REQUEST",{message:"user already has a password"})}),s6("/delete-user",{method:"POST",use:[ar],body:oe({callbackURL:nI().meta({description:"The callback URL to redirect to after the user is deleted"}).optional(),password:nI().meta({description:"The password of the user is required to delete the user"}).optional(),token:nI().meta({description:"The token to delete the user is required"}).optional()}),metadata:{openapi:{description:"Delete the user",responses:{200:{description:"User deletion processed successfully",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean",description:"Indicates if the operation was successful"},message:{type:"string",enum:["User deleted","Verification email sent"],description:"Status message of the deletion process"}},required:["success","message"]}}}}}}}},async e=>{if(!e.context.options.user?.deleteUser?.enabled)throw e.context.logger.error("Delete user is disabled. Enable it in the options",{session:e.context.session}),new $("NOT_FOUND");let t=e.context.session;if(e.body.password){let r=(await e.context.internalAdapter.findAccounts(t.user.id)).find(e=>"credential"===e.providerId&&e.password);if(!r||!r.password)throw new $("BAD_REQUEST",{message:s7.CREDENTIAL_ACCOUNT_NOT_FOUND});if(!await e.context.password.verify({hash:r.password,password:e.body.password}))throw new $("BAD_REQUEST",{message:s7.INVALID_PASSWORD})}if(e.body.token)return await ag({...e,query:{token:e.body.token}}),e.json({success:!0,message:"User deleted"});if(e.context.options.user.deleteUser?.sendDeleteAccountVerification){let r=i7(32,"0-9","a-z");await e.context.internalAdapter.createVerificationValue({value:t.user.id,identifier:`delete-account-${r}`,expiresAt:new Date(Date.now()+1e3*(e.context.options.user.deleteUser?.deleteTokenExpiresIn||86400))},e);let n=`${e.context.baseURL}/delete-user/callback?token=${r}&callbackURL=${e.body.callbackURL||"/"}`;return await e.context.options.user.deleteUser.sendDeleteAccountVerification({user:t.user,url:n,token:r},e.request),e.json({success:!0,message:"Verification email sent"})}if(!e.body.password&&0!==e.context.sessionConfig.freshAge){let r=new Date(t.session.createdAt).getTime(),n=1e3*e.context.sessionConfig.freshAge;if(Date.now()-r>1e3*n)throw new $("BAD_REQUEST",{message:s7.SESSION_EXPIRED})}let r=e.context.options.user.deleteUser?.beforeDelete;r&&await r(t.user,e.request),await e.context.internalAdapter.deleteUser(t.user.id),await e.context.internalAdapter.deleteSessions(t.user.id),await e.context.internalAdapter.deleteAccounts(t.user.id),N(e);let n=e.context.options.user.deleteUser?.afterDelete;return n&&await n(t.user,e.request),e.json({success:!0,message:"User deleted"})});let ag=s6("/delete-user/callback",{method:"GET",query:oe({token:nI().meta({description:"The token to verify the deletion request"}),callbackURL:nI().meta({description:"The URL to redirect to after deletion"}).optional()}),use:[s9(e=>e.query.callbackURL)],metadata:{openapi:{description:"Callback to complete user deletion with verification token",responses:{200:{description:"User successfully deleted",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean",description:"Indicates if the deletion was successful"},message:{type:"string",enum:["User deleted"],description:"Confirmation message"}},required:["success","message"]}}}}}}}},async e=>{if(!e.context.options.user?.deleteUser?.enabled)throw e.context.logger.error("Delete user is disabled. Enable it in the options"),new $("NOT_FOUND");let t=await at(e);if(!t)throw new $("NOT_FOUND",{message:s7.FAILED_TO_GET_USER_INFO});let r=await e.context.internalAdapter.findVerificationValue(`delete-account-${e.query.token}`);if(!r||r.expiresAt<new Date||r.value!==t.user.id)throw new $("NOT_FOUND",{message:s7.INVALID_TOKEN});let n=e.context.options.user.deleteUser?.beforeDelete;n&&await n(t.user,e.request),await e.context.internalAdapter.deleteUser(t.user.id),await e.context.internalAdapter.deleteSessions(t.user.id),await e.context.internalAdapter.deleteAccounts(t.user.id),await e.context.internalAdapter.deleteVerificationValue(r.id),N(e);let o=e.context.options.user.deleteUser?.afterDelete;if(o&&await o(t.user,e.request),e.query.callbackURL)throw e.redirect(e.query.callbackURL||"/");return e.json({success:!0,message:"User deleted"})});s6("/change-email",{method:"POST",body:oe({newEmail:ni(nU,void 0).meta({description:"The new email address to set must be a valid email address"}),callbackURL:nI().meta({description:"The URL to redirect to after email verification"}).optional()}),use:[ar],metadata:{openapi:{responses:{200:{description:"Email change request processed successfully",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the request was successful"},message:{type:"string",enum:["Email updated","Verification email sent"],description:"Status message of the email change process",nullable:!0}},required:["status"]}}}}}}}},async e=>{if(!e.context.options.user?.changeEmail?.enabled)throw e.context.logger.error("Change email is disabled."),new $("BAD_REQUEST",{message:"Change email is disabled"});let t=e.body.newEmail.toLowerCase();if(t===e.context.session.user.email)throw e.context.logger.error("Email is the same"),new $("BAD_REQUEST",{message:"Email is the same"});if(await e.context.internalAdapter.findUserByEmail(t))throw e.context.logger.error("Email already exists"),new $("BAD_REQUEST",{message:"Couldn't update your email"});if(!0!==e.context.session.user.emailVerified){if(await e.context.internalAdapter.findUserByEmail(t))throw new $("UNPROCESSABLE_ENTITY",{message:s7.USER_ALREADY_EXISTS});if(await e.context.internalAdapter.updateUserByEmail(e.context.session.user.email,{email:t},e),await U(e,{session:e.context.session.session,user:{...e.context.session.user,email:t}}),e.context.options.emailVerification?.sendVerificationEmail){let r=await ao(e.context.secret,t,void 0,e.context.options.emailVerification?.expiresIn),n=`${e.context.baseURL}/verify-email?token=${r}&callbackURL=${e.body.callbackURL||"/"}`;await e.context.options.emailVerification.sendVerificationEmail({user:{...e.context.session.user,email:t},url:n,token:r},e.request)}return e.json({status:!0})}if(!e.context.options.user.changeEmail.sendChangeEmailVerification)throw e.context.logger.error("Verification email isn't enabled."),new $("BAD_REQUEST",{message:"Verification email isn't enabled"});let r=await ao(e.context.secret,e.context.session.user.email,t,e.context.options.emailVerification?.expiresIn),n=`${e.context.baseURL}/verify-email?token=${r}&callbackURL=${e.body.callbackURL||"/"}`;return await e.context.options.user.changeEmail.sendChangeEmailVerification({user:e.context.session.user,newEmail:t,url:n,token:r},e.request),e.json({status:!0})});let aw=(e="Unknown")=>`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentication Error</title>
    <style>
        :root {
            --bg-color: #f8f9fa;
            --text-color: #212529;
            --accent-color: #000000;
            --error-color: #dc3545;
            --border-color: #e9ecef;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            line-height: 1.5;
        }
        .error-container {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            padding: 2.5rem;
            text-align: center;
            max-width: 90%;
            width: 400px;
        }
        h1 {
            color: var(--error-color);
            font-size: 1.75rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }
        p {
            margin-bottom: 1.5rem;
            color: #495057;
        }
        .btn {
            background-color: var(--accent-color);
            color: #ffffff;
            text-decoration: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            transition: all 0.3s ease;
            display: inline-block;
            font-weight: 500;
            border: 2px solid var(--accent-color);
        }
        .btn:hover {
            background-color: #131721;
        }
        .error-code {
            font-size: 0.875rem;
            color: #6c757d;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
        }
        .icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="error-container">
        <div class="icon">\u26A0\uFE0F</div>
        <h1>Better Auth Error</h1>
        <p>We encountered an issue while processing your request. Please try again or contact the application owner if the problem persists.</p>
        <a href="/" id="returnLink" class="btn">Return to Application</a>
        <div class="error-code">Error Code: <span id="errorCode">${e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}</span></div>
    </div>
</body>
</html>`;s6("/error",{method:"GET",metadata:{...as,openapi:{description:"Displays an error page",responses:{200:{description:"Success",content:{"text/html":{schema:{type:"string",description:"The HTML content of the error page"}}}}}}}},async e=>new Response(aw(new URL(e.request?.url||"").searchParams.get("error")||"Unknown"),{headers:{"Content-Type":"text/html"}})),s6("/ok",{method:"GET",metadata:{...as,openapi:{description:"Check if the API is working",responses:{200:{description:"API is working",content:{"application/json":{schema:{type:"object",properties:{ok:{type:"boolean",description:"Indicates if the API is working"}},required:["ok"]}}}}}}}},async e=>e.json({ok:!0})),s6("/list-accounts",{method:"GET",use:[ar],metadata:{openapi:{description:"List all accounts linked to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"array",items:{type:"object",properties:{id:{type:"string"},provider:{type:"string"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}},accountId:{type:"string"},scopes:{type:"array",items:{type:"string"}}},required:["id","provider","createdAt","updatedAt","accountId","scopes"]}}}}}}}},async e=>{let t=e.context.session,r=await e.context.internalAdapter.findAccounts(t.user.id);return e.json(r.map(e=>({id:e.id,provider:e.providerId,createdAt:e.createdAt,updatedAt:e.updatedAt,accountId:e.accountId,scopes:e.scope?.split(",")||[]})))}),s6("/link-social",{method:"POST",requireHeaders:!0,body:oe({callbackURL:nI().meta({description:"The URL to redirect to after the user has signed in"}).optional(),provider:ah,idToken:oe({token:nI(),nonce:nI().optional(),accessToken:nI().optional(),refreshToken:nI().optional(),scopes:n9(nI()).optional()}).optional(),requestSignUp:n1().optional(),scopes:n9(nI()).meta({description:"Additional scopes to request from the provider"}).optional(),errorCallbackURL:nI().meta({description:"The URL to redirect to if there is an error during the link process"}).optional()}),use:[ar],metadata:{openapi:{description:"Link a social account to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{url:{type:"string",description:"The authorization URL to redirect the user to"},redirect:{type:"boolean",description:"Indicates if the user should be redirected to the authorization URL"},status:{type:"boolean"}},required:["redirect"]}}}}}}}},async e=>{let t=e.context.session,r=e.context.socialProviders.find(t=>t.id===e.body.provider);if(!r)throw e.context.logger.error("Provider not found. Make sure to add the provider in your auth config",{provider:e.body.provider}),new $("NOT_FOUND",{message:s7.PROVIDER_NOT_FOUND});if(e.body.idToken){if(!r.verifyIdToken)throw e.context.logger.error("Provider does not support id token verification",{provider:e.body.provider}),new $("NOT_FOUND",{message:s7.ID_TOKEN_NOT_SUPPORTED});let{token:n,nonce:o}=e.body.idToken;if(!await r.verifyIdToken(n,o))throw e.context.logger.error("Invalid id token",{provider:e.body.provider}),new $("UNAUTHORIZED",{message:s7.INVALID_TOKEN});let i=await r.getUserInfo({idToken:n,accessToken:e.body.idToken.accessToken,refreshToken:e.body.idToken.refreshToken});if(!i||!i?.user)throw e.context.logger.error("Failed to get user info",{provider:e.body.provider}),new $("UNAUTHORIZED",{message:s7.FAILED_TO_GET_USER_INFO});let s=String(i.user.id);if(!i.user.email)throw e.context.logger.error("User email not found",{provider:e.body.provider}),new $("UNAUTHORIZED",{message:s7.USER_EMAIL_NOT_FOUND});if((await e.context.internalAdapter.findAccounts(t.user.id)).find(e=>e.providerId===r.id&&e.accountId===s))return e.json({redirect:!1,url:"",status:!0});let a=e.context.options.account?.accountLinking?.trustedProviders;if(!a?.includes(r.id)&&!i.user.emailVerified||e.context.options.account?.accountLinking?.enabled===!1)throw new $("UNAUTHORIZED",{message:"Account not linked - linking not allowed"});if(i.user.email!==t.user.email&&e.context.options.account?.accountLinking?.allowDifferentEmails!==!0)throw new $("UNAUTHORIZED",{message:"Account not linked - different emails not allowed"});try{await e.context.internalAdapter.createAccount({userId:t.user.id,providerId:r.id,accountId:s,accessToken:e.body.idToken.accessToken,idToken:n,refreshToken:e.body.idToken.refreshToken,scope:e.body.idToken.scopes?.join(",")},e)}catch(e){throw new $("EXPECTATION_FAILED",{message:"Account not linked - unable to create account"})}if(e.context.options.account?.accountLinking?.updateUserInfoOnLink===!0)try{await e.context.internalAdapter.updateUser(t.user.id,{name:i.user?.name,image:i.user?.image})}catch(e){console.warn("Could not update user - "+e.toString())}return e.json({redirect:!1,url:"",status:!0})}let n=await aa(e,{userId:t.user.id,email:t.user.email}),o=await r.createAuthorizationURL({state:n.state,codeVerifier:n.codeVerifier,redirectURI:`${e.context.baseURL}/callback/${r.id}`,scopes:e.body.scopes});return e.json({url:o.toString(),redirect:!0})}),s6("/unlink-account",{method:"POST",body:oe({providerId:nI(),accountId:nI().optional()}),use:[an],metadata:{openapi:{description:"Unlink an account",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async e=>{let{providerId:t,accountId:r}=e.body,n=await e.context.internalAdapter.findAccounts(e.context.session.user.id);if(1===n.length&&!e.context.options.account?.accountLinking?.allowUnlinkingAll)throw new $("BAD_REQUEST",{message:s7.FAILED_TO_UNLINK_LAST_ACCOUNT});let o=n.find(e=>r?e.accountId===r&&e.providerId===t:e.providerId===t);if(!o)throw new $("BAD_REQUEST",{message:s7.ACCOUNT_NOT_FOUND});return await e.context.internalAdapter.deleteAccount(o.id),e.json({status:!0})});let ab=s6("/get-access-token",{method:"POST",body:oe({providerId:nI().meta({description:"The provider ID for the OAuth provider"}),accountId:nI().meta({description:"The account ID associated with the refresh token"}).optional(),userId:nI().meta({description:"The user ID associated with the account"}).optional()}),metadata:{openapi:{description:"Get a valid access token, doing a refresh if needed",responses:{200:{description:"A Valid access token",content:{"application/json":{schema:{type:"object",properties:{tokenType:{type:"string"},idToken:{type:"string"},accessToken:{type:"string"},refreshToken:{type:"string"},accessTokenExpiresAt:{type:"string",format:"date-time"},refreshTokenExpiresAt:{type:"string",format:"date-time"}}}}}},400:{description:"Invalid refresh token or provider configuration"}}}}},async e=>{let{providerId:t,accountId:r,userId:n}=e.body,o=e.request,i=await at(e);if(o&&!i)throw e.error("UNAUTHORIZED");let s=i?.user?.id||n;if(!s)throw new $("BAD_REQUEST",{message:"Either userId or session is required"});if(!e.context.socialProviders.find(e=>e.id===t))throw new $("BAD_REQUEST",{message:`Provider ${t} is not supported.`});let a=(await e.context.internalAdapter.findAccounts(s)).find(e=>r?e.id===r&&e.providerId===t:e.providerId===t);if(!a)throw new $("BAD_REQUEST",{message:"Account not found"});let c=e.context.socialProviders.find(e=>e.id===t);if(!c)throw new $("BAD_REQUEST",{message:`Provider ${t} not found.`});try{let t=null,r=a.accessTokenExpiresAt&&new Date(a.accessTokenExpiresAt).getTime()-Date.now()<5e3;a.refreshToken&&r&&c.refreshAccessToken&&(t=await c.refreshAccessToken(a.refreshToken),await e.context.internalAdapter.updateAccount(a.id,{accessToken:await ad(t.accessToken,e.context),accessTokenExpiresAt:t.accessTokenExpiresAt,refreshToken:await ad(t.refreshToken,e.context),refreshTokenExpiresAt:t.refreshTokenExpiresAt}));let n={accessToken:await function(e,t){return e&&t.options.account?.encryptOAuthTokens?sr({key:t.secret,data:e}):e}(t?.accessToken??a.accessToken??"",e.context),accessTokenExpiresAt:t?.accessTokenExpiresAt??a.accessTokenExpiresAt??void 0,scopes:a.scope?.split(",")??[],idToken:t?.idToken??a.idToken??void 0};return e.json(n)}catch(e){throw new $("BAD_REQUEST",{message:"Failed to get a valid access token",cause:e})}});s6("/refresh-token",{method:"POST",body:oe({providerId:nI().meta({description:"The provider ID for the OAuth provider"}),accountId:nI().meta({description:"The account ID associated with the refresh token"}).optional(),userId:nI().meta({description:"The user ID associated with the account"}).optional()}),metadata:{openapi:{description:"Refresh the access token using a refresh token",responses:{200:{description:"Access token refreshed successfully",content:{"application/json":{schema:{type:"object",properties:{tokenType:{type:"string"},idToken:{type:"string"},accessToken:{type:"string"},refreshToken:{type:"string"},accessTokenExpiresAt:{type:"string",format:"date-time"},refreshTokenExpiresAt:{type:"string",format:"date-time"}}}}}},400:{description:"Invalid refresh token or provider configuration"}}}}},async e=>{let{providerId:t,accountId:r,userId:n}=e.body,o=e.request,i=await at(e);if(o&&!i)throw e.error("UNAUTHORIZED");let s=i?.user?.id||n;if(!s)throw new $("BAD_REQUEST",{message:"Either userId or session is required"});let a=(await e.context.internalAdapter.findAccounts(s)).find(e=>r?e.id===r&&e.providerId===t:e.providerId===t);if(!a)throw new $("BAD_REQUEST",{message:"Account not found"});let c=e.context.socialProviders.find(e=>e.id===t);if(!c)throw new $("BAD_REQUEST",{message:`Provider ${t} not found.`});if(!c.refreshAccessToken)throw new $("BAD_REQUEST",{message:`Provider ${t} does not support token refreshing.`});try{let t=await c.refreshAccessToken(a.refreshToken);return await e.context.internalAdapter.updateAccount(a.id,{accessToken:await ad(t.accessToken,e.context),refreshToken:await ad(t.refreshToken,e.context),accessTokenExpiresAt:t.accessTokenExpiresAt,refreshTokenExpiresAt:t.refreshTokenExpiresAt}),e.json(t)}catch(e){throw new $("BAD_REQUEST",{message:"Failed to refresh access token",cause:e})}}),s6("/account-info",{method:"POST",use:[ar],metadata:{openapi:{description:"Get the account info provided by the provider",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",properties:{id:{type:"string"},name:{type:"string"},email:{type:"string"},image:{type:"string"},emailVerified:{type:"boolean"}},required:["id","emailVerified"]},data:{type:"object",properties:{},additionalProperties:!0}},required:["user","data"],additionalProperties:!1}}}}}}},body:oe({accountId:nI().meta({description:"The provider given account id for which to get the account info"})})},async e=>{let t=await e.context.internalAdapter.findAccount(e.body.accountId);if(!t||t.userId!==e.context.session.user.id)throw new $("BAD_REQUEST",{message:"Account not found"});let r=e.context.socialProviders.find(e=>e.id===t.providerId);if(!r)throw new $("INTERNAL_SERVER_ERROR",{message:`Provider account provider is ${t.providerId} but it is not configured`});let n=await ab({...e,body:{accountId:t.id,providerId:t.providerId},returnHeaders:!1});if(!n.accessToken)throw new $("BAD_REQUEST",{message:"Access token not found"});let o=await r.getUserInfo({...n,accessToken:n.accessToken});return e.json(o)});let av=s1((e,t,r)=>{if(Array.isArray(e[t])&&Array.isArray(r))return e[t]=r,!0});s5(async()=>({})),s5({use:[ar]},async e=>({session:e.context.session}));let a_=nI(),aE=os(["pending","accepted","rejected","canceled"]).default("pending");oe({id:nI().default(sB),name:nI(),slug:nI(),logo:nI().nullish().optional(),metadata:(h=nI(),new oo({type:"record",keyType:h,valueType:n5(),...tL(void 0)})).or(nI().transform(e=>JSON.parse(e))).optional(),createdAt:n8()}),oe({id:nI().default(sB),organizationId:nI(),userId:ov(),role:a_,createdAt:n8().default(()=>new Date)}),oe({id:nI().default(sB),organizationId:nI(),email:nI(),role:a_,status:aE,teamId:nI().optional(),inviterId:nI(),expiresAt:n8()}),oe({id:nI().default(sB),name:nI().min(1),organizationId:nI(),createdAt:n8(),updatedAt:n8().optional()}),oe({id:nI().default(sB),teamId:nI(),userId:nI(),createdAt:n8().default(()=>new Date)});let ak=["admin","member","owner"];function aA(e){return{newRole:e=>{var t;return{authorize(e,r="AND"){let n=!1;for(let[o,i]of Object.entries(e)){let e=t[o];if(!e)return{success:!1,error:`You are not allowed to access resource: ${o}`};if(Array.isArray(i))n=i.every(t=>e.includes(t));else if("object"==typeof i)n="OR"===i.connector?i.actions.some(t=>e.includes(t)):i.actions.every(t=>e.includes(t));else throw new k("Invalid access control request");if(n&&"OR"===r)return{success:n};if(!n&&"AND"===r)return{success:!1,error:`unauthorized to access resource "${o}"`}}return n?{success:n}:{success:!1,error:"Not authorized"}},statements:t=e}},statements:e}}or([os(ak),n9(os(ak))]);let aT=aA({organization:["update","delete"],member:["create","update","delete"],invitation:["create","cancel"],team:["create","update","delete"]});aT.newRole({organization:["update"],invitation:["create","cancel"],member:["create","update","delete"],team:["create","update","delete"]}),aT.newRole({organization:["update","delete"],member:["create","update","delete"],invitation:["create","cancel"],team:["create","update","delete"]}),aT.newRole({organization:[],member:[],invitation:[],team:[]});let ax=aA({user:["create","list","set-role","ban","impersonate","delete","set-password","update"],session:["list","revoke","delete"]});function aS(e){let t=async t=>"handler"in e?e.handler(t):e(t);return{GET:t,POST:t}}ax.newRole({user:["create","list","set-role","ban","impersonate","delete","set-password","update"],session:["list","revoke","delete"]}),ax.newRole({user:[],session:[]}),oe({id:nI(),publicKey:nI(),privateKey:nI(),createdAt:n8()})},6487:()=>{},6559:(e,t,r)=>{"use strict";e.exports=r(4870)},7867:(e,t,r)=>{"use strict";r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{GET:()=>a,POST:()=>c});var o=r(1098),i=r(5877),s=e([o]);o=(s.then?(await s)():s)[0];let{GET:a,POST:c}=(0,i.O)(o.j.handler);n()}catch(e){n(e)}})},8335:()=>{},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[719],()=>r(5395));module.exports=n})();